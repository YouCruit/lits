var Lispish=function(e){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])},n(e,t)};function t(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var r=function(){return r=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var a in n=arguments[t])Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a]);return e},r.apply(this,arguments)};function a(e,n){for(var t=0,r=n.length,a=e.length;t<r;t++,a++)e[a]=n[t];return e}var u=function(e){function n(t){var r=e.call(this,"recur, params: "+t)||this;return Object.setPrototypeOf(r,n.prototype),r.name="RecurSignal",r.params=t,r}return t(n,e),n}(Error),i=function(e){function n(t){var r=e.call(this,t)||this;return Object.setPrototypeOf(r,n.prototype),r.name="UserDefinedError",r}return t(n,e),n}(Error),o=function(e){function n(t){var r=e.call(this,"Assertion error: "+t)||this;return Object.setPrototypeOf(r,n.prototype),r.name="AssertionError",r}return t(n,e),n}(Error),f=function(e){function n(t,r){var a=e.call(this,'Expected a "'+t+'" token, got Token['+r.type+':"'+r.value+'"]')||this;return Object.setPrototypeOf(a,n.prototype),a.name="UnexpectedTokenError",a}return t(n,e),n}(Error),c=function(e){function n(t,r){var a=e.call(this,"Expected a "+t+" node, got "+(r?"a "+r.type+" node":"undefined"))||this;return Object.setPrototypeOf(a,n.prototype),a.name="UnexpectedNodeTypeError",a}return t(n,e),n}(Error),l=Symbol("function");function v(e){if(void 0===e)throw Error("Expected an AST node, got undefined");return e}function s(e){if(void 0===e||"Name"!==e.type)throw new c("Name",e)}function p(e,n){if(void 0===n&&(n="Unexpected end of input"),void 0===e)throw Error(n);return e}function d(e,n){if(void 0===n&&(n="Unexpected end of input"),void 0===e)throw Error(n)}function m(e){if("number"!=typeof e||!isFinite(e))throw TypeError("Expected number, got: "+e+' type="'+typeof e+'"')}function h(e){!function(e){if(m(e),e<0)throw TypeError("Expected non negative number, got "+e)}(e),g(e)}function g(e){if(m(e),!Number.isInteger(e))throw TypeError("Expected integer, got "+e)}function y(e,n){if(m(e),e<n)throw TypeError("Expected parameter ("+e+") to be a number equal or grater than "+n)}function b(e){if("string"!=typeof e)throw TypeError("Expected string, got: "+e+' type="'+typeof e+'"')}function x(e){if(b(e),1!==e.length)throw TypeError("Expected char, got: "+e+' type="'+typeof e+'"')}function E(e){if("string"!=typeof e&&"number"!=typeof e)throw TypeError("Expected string or number, got: "+e+' type="'+typeof e+'"')}function w(e){if(!(e instanceof RegExp))throw TypeError("Expected RegExp, got: "+e+' type="'+typeof e+'"')}function A(e,n){var t=n.params.length;if("number"==typeof e){if(t!==e)throw Error('Wrong number of arguments to "'+n.name+'", expected '+e+", got "+t)}else{var r=e.min,a=e.max;if(void 0===r&&void 0===a)throw Error("Min or max must be specified");if("number"==typeof r&&t<r)throw Error('Wrong number of arguments to "'+n.name+'", expected at least '+r+", got "+t);if("number"==typeof a&&t>a)throw Error('Wrong number of arguments to "'+n.name+'", expected at most '+a+", got "+t)}}function N(e){var n=e.params.length;if(n%2!=0)throw Error("Wrong number of arguments, expected an even number, got "+n)}function M(e){return null!==e&&"object"==typeof e&&!!e[l]}function j(e){if(!M(e))throw Error("Expected lispish function, got "+JSON.stringify(e))}function O(e){if(!Array.isArray(e)||e.some((function(e){return"string"!=typeof e})))throw Error("Expected an array of strings, got "+e)}function k(e){if(!Array.isArray(e)||e.some((function(e){return"string"!=typeof e||1!==e.length})))throw Error("Expected an array of chars, got "+e)}function S(e){if(!U(e))throw TypeError("Expected a number, got: "+e+' type="'+typeof e+'"')}function T(e){if(!_(e))throw TypeError("Expected Arr, got: "+e+' type="'+typeof e+'"')}function I(e){if(!V(e))throw TypeError("Expected collection, got: "+e+' type="'+typeof e+'"')}function F(e){if(!C(e))throw TypeError("Expected string or array, got: "+e+' type="'+typeof e+'"')}function P(e){if(!R(e))throw TypeError("Expected object, got: "+e+' type="'+typeof e+'"')}function R(e){return!(null===e||"object"!=typeof e||Array.isArray(e)||e instanceof RegExp||M(e))}function _(e){return Array.isArray(e)}function C(e){return Array.isArray(e)||q(e)}function V(e){return C(e)||R(e)}function q(e){return"string"==typeof e}function U(e){return"number"==typeof e}function B(e){return Number.isInteger(e)}var D={boolean:0,number:1,string:2,array:3,object:4,regexp:5,unknown:6,null:7,undefined:8};function L(e){return void 0===e?"undefined":null===e?"null":"boolean"==typeof e?"boolean":"number"==typeof e?"number":"string"==typeof e?"string":_(e)?"array":R(e)?"object":function(e){return e instanceof RegExp}(e)?"regexp":"unknown"}function $(e,n){var t=L(e),r=L(n);if(t!==r)return Math.sign(D[t]-D[r]);switch(t){case"undefined":case"null":case"unknown":return 0;case"boolean":return e===n?0:!1===e?-1:1;case"number":return Math.sign(e-n);case"string":return(l=e)<(v=n)?-1:l>v?1:0;case"array":var a=e,u=n;if(a.length<u.length)return-1;if(a.length>u.length)return 1;for(var i=0;i<a.length;i+=1){var o=$(a[i],u[i]);if(0!==o)return o}return 0;case"object":var f=e,c=n;return Math.sign(Object.keys(f).length-Object.keys(c).length);case"regexp":var l,v;return(l=e.source)<(v=n.source)?-1:l>v?1:0}}function z(e,n){if(e===n)return!0;if("number"==typeof e&&"number"==typeof n)return Math.abs(e-n)<Number.EPSILON;if(_(e)&&_(n)){if(e.length!==n.length)return!1;for(var t=0;t<e.length;t+=1)if(!z(e[t],n[t]))return!1;return!0}if(e instanceof RegExp&&n instanceof RegExp)return e.toString()===n.toString();if("object"==typeof e&&null!==e&&"object"==typeof n&&null!==n){var r=e,a=n,u=Object.keys(r),i=Object.keys(a);if(u.length!==i.length)return!1;for(t=0;t<u.length;t+=1){var o=p(u[t]);if(!z(r[o],a[o]))return!1}return!0}return!1}var G={parse:function(e,n,t){var r;return r=function(e,n,t){for(var r,a,u=[],i=p(e[n]);"paren"!==i.type||")"!==i.value;){var o,f;n=(r=t(e,n))[0],o=r[1],n=(a=t(e,n))[0],f=a[1],u.push({test:o,form:f}),i=p(e[n])}return[n,u]}(e,n,t.parseToken),[(n=r[0])+1,{type:"SpecialExpression",name:"cond",conditions:r[1],params:[]}]},evaluate:function(e,n,t){for(var r=t.evaluateAstNode,a=0,u=e.conditions;a<u.length;a++){var i=u[a];if(r(i.test,n))return r(i.form,n)}}},Y={true:{value:!0},false:{value:!1},null:{value:null},undefined:{value:void 0}},J=Object.keys(Y);function W(e,n,t){if("string"==typeof e){if(t.specialExpressions[e])throw Error("Cannot define variable "+e+", it's a special expression");if(t.normalExpressions[e])throw Error("Cannot define variable "+e+", it's a builtin function");if(Y[e])throw Error("Cannot define variable "+e+", it's a reserved name");if(p(n[n.length-2])[e])throw Error('Name already defined "'+e+'"')}}function X(e){return function(n,t,r){var a,u=r.parseToken,i=r.parseArgument,o=r.parseBindings,l=void 0;if(("defn"===e||"defns"===e)&&(t=(a=u(n,t))[0],l=a[1],"defn"===e&&"Name"!==l.type))throw new c("Name",l);for(var v=function(e,n,t,r){var a,u=[],i=void 0,o=[],c=[],l={},v="mandatory",s=p(e[n]);if("paren"!==s.type||"["!==s.value)throw new f("[",s);for(s=p(e[n+=1]);"paren"!==s.type||"]"!==s.value;){if("bind"===v){n=(a=r(e,n))[0],u=a[1];break}var d=t(e,n),m=d[0],h=d[1];if(s=p(e[n=m]),"Modifier"===h.type)switch(h.value){case"&opt":if("rest"===v)throw Error("&opt cannot appear after &rest");if("optional"===v)throw Error("&opt can only appear once");v="optional";break;case"&rest":if("rest"===v)throw Error("&rest can only appear once");if("optional"===v&&0===c.length)throw Error("No optional arguments where spcified");v="rest";break;case"&bind":if("optional"===v&&0===c.length)throw Error("No optional arguments where spcified");if("rest"===v&&!i)throw Error("No rest argument was spcified");v="bind"}else{if(l[h.name])throw Error('Duplicate argument "'+h.name+'"');if(l[h.name]=!0,Object.getOwnPropertyDescriptor(h,"defaultValue")){if("optional"!==v)throw Error("Cannot specify default value if not an optional argument");c.push({name:h.name,defaultValue:h.defaultValue})}else switch(v){case"mandatory":o.push(h.name);break;case"optional":c.push({name:h.name,defaultValue:void 0});break;case"rest":if(void 0!==i)throw Error("Can only specify one rest argument");i=h.name}}}if("rest"===v&&void 0===i)throw Error("Missing rest argument name");if("optional"===v&&0===c.length)throw Error("No optional arguments where spcified");return[n+=1,{mandatoryArguments:o,optionalArguments:c,restArgument:i,bindings:u}]}(n,t,i,o),s=v[0],d=v[1],m=p(n[t=s]),h=[];"paren"!==m.type||")"!==m.value;){var g=u(n,t),y=g[0],b=g[1];h.push(b),m=p(n[t=y])}if(0===h.length)throw Error('Missing body in special expression "defn"');return t+=1,"defn"===e||"defns"===e?[t,{type:"SpecialExpression",name:e,functionName:l,params:[],arguments:d,body:h}]:[t,{type:"SpecialExpression",name:e,params:[],arguments:d,body:h}]}}function H(e){return function(n,t,r){var a,u=r.evaluateAstNode,i=r.builtin,o=function(e,n,t,r){if("defn"===e){var a=n.functionName.value;return b(a),a}if("defns"===e){var u=r(n.functionName,t);return b(u),u}}(e,n,t,u);W(o,t,i);for(var f={},c=0,v=n.arguments.bindings;c<v.length;c++){var s=v[c],d=s.value,m=u(d,t);f[s.name]={value:m}}var h=n.arguments.optionalArguments.map((function(e){var n=e.name,r=e.defaultValue;return r?{name:n,defaultValue:u(r,t)}:{name:n}})),g=((a={})[l]=!0,a.type="user-defined",a.name=o,a.arguments={mandatoryArguments:n.arguments.mandatoryArguments,restArgument:n.arguments.restArgument,optionalArguments:h},a.body=n.body,a.functionContext=f,a);if("fn"===e)return g;p(t[t.length-2],"Could not find global scope")[o]={value:g}}}var K={parse:X("defn"),evaluate:H("defn")},Z={parse:X("defns"),evaluate:H("defns")},Q={parse:X("fn"),evaluate:H("fn")},ee={parse:function(e,n,t){var r=(0,t.parseTokens)(e,n);return[r[0]+1,{type:"SpecialExpression",name:"if",params:r[1]}]},evaluate:function(e,n,t){var r=t.evaluateAstNode,a=e.params,u=a[0],i=a[1],o=a[2];return r(v(u),n)?r(v(i),n):3===e.params.length?r(v(o),n):void 0},validate:function(e){return A({min:2,max:3},e)}},ne={parse:function(e,n,t){var r=(0,t.parseTokens)(e,n);return[r[0]+1,{type:"SpecialExpression",name:"if-not",params:r[1]}]},evaluate:function(e,n,t){var r=t.evaluateAstNode,a=e.params,u=a[0],i=a[1],o=a[2];return r(v(u),n)?3===e.params.length?r(v(o),n):void 0:r(v(i),n)},validate:function(e){return A({min:2,max:3},e)}},te={parse:function(e,n,t){var r,a,u,i,o=t.parseBindings,f=t.parseTokens;if(n=(r=o(e,n))[0],1!==(u=r[1]).length)throw Error("Expected exactly one binding, got "+u.length);return n=(a=f(e,n))[0],i=a[1],[n+1,{type:"SpecialExpression",name:"if-let",binding:p(u[0]),params:i}]},evaluate:function(e,n,t){var r=t.evaluateAstNode,u={},i=r(e.binding.value,n);if(i){u[e.binding.name]={value:i};var o=a([u],n);return r(p(e.params[0]),o)}if(2===e.params.length)return r(p(e.params[1]),n)},validate:function(e){return A({min:1,max:2},e)}},re={parse:function(e,n,t){var r,a,u,i,o=t.parseBindings,f=t.parseTokens;if(n=(r=o(e,n))[0],1!==(u=r[1]).length)throw Error("Expected exactly one binding, got "+u.length);return n=(a=f(e,n))[0],i=a[1],[n+1,{type:"SpecialExpression",name:"when-let",binding:p(u[0]),params:i}]},evaluate:function(e,n,t){var r=t.evaluateAstNode,u={},i=r(e.binding.value,n);if(i){u[e.binding.name]={value:i};for(var o=a([u],n),f=void 0,c=0,l=e.params;c<l.length;c++){f=r(l[c],o)}return f}},validate:function(e){return A({min:0},e)}},ae={parse:function(e,n,t){var r=(0,t.parseTokens)(e,n);return[r[0]+1,{type:"SpecialExpression",name:"when-not",params:r[1]}]},evaluate:function(e,n,t){var r=t.evaluateAstNode,a=e.params,u=a[0],i=a.slice(1);if(d(u),!r(u,n)){for(var o=void 0,f=0,c=i;f<c.length;f++){o=r(c[f],n)}return o}},validate:function(e){return A({min:1},e)}},ue={parse:function(e,n,t){var r,a,u,i,o=t.parseBindings,f=t.parseTokens;if(n=(r=o(e,n))[0],1!==(u=r[1]).length)throw Error("Expected exactly one binding, got "+u.length);return n=(a=f(e,n))[0],i=a[1],[n+1,{type:"SpecialExpression",name:"when-first",binding:p(u[0]),params:i}]},evaluate:function(e,n,t){var r=t.evaluateAstNode,u={},i=r(e.binding.value,n);if(!C(i))throw Error("Expected undefined or a sequence, got "+i);if(0!==i.length){var o=i[0];u[e.binding.name]={value:o};for(var f=a([u],n),c=void 0,l=0,v=e.params;l<v.length;l++){c=r(v[l],f)}return c}},validate:function(e){return A({min:0},e)}},ie={parse:function(e,n,t){var r,a,u,i=t.parseBindings,o=t.parseTokens;return n=(r=i(e,n))[0],u=r[1],[(n=(a=o(e,n))[0])+1,{type:"SpecialExpression",name:"let",params:a[1],bindings:u}]},evaluate:function(e,n,t){for(var r=t.evaluateAstNode,u={},i=0,o=e.bindings;i<o.length;i++){var f=o[i],c=r(f.value,n);u[f.name]={value:c}}for(var l,v=a([u],n),s=0,p=e.params;s<p.length;s++){l=r(p[s],v)}return l}},oe={parse:function(e,n,t){for(var r=t.parseToken,a={type:"SpecialExpression",name:"do",params:[]},u=p(e[n]);"paren"!==u.type||")"!==u.value;){var i=r(e,n),o=i[0],f=i[1];a.params.push(f),u=p(e[n=o])}return[n+1,a]},evaluate:function(e,n,t){for(var r,u=t.evaluateAstNode,i=a([{}],n),o=0,f=e.params;o<f.length;o++){r=u(f[o],i)}return r}},fe={parse:function(e,n,t){var r=(0,t.parseTokens)(e,n),a=r[0],u=r[1];return s(u[0]),[a+1,{type:"SpecialExpression",name:"def",params:u}]},evaluate:function(e,n,t){var r=t.evaluateAstNode,a=t.builtin,u=function(e){if(void 0===e||"Name"!==e.type)throw new c("Name",e);return e}(e.params[0]).value;W(u,n,a);var i=r(v(e.params[1]),n);return p(n[n.length-2])[u]={value:i},i},validate:function(e){return A(2,e)}},ce={parse:function(e,n,t){var r=(0,t.parseTokens)(e,n);return[r[0]+1,{type:"SpecialExpression",name:"defs",params:r[1]}]},evaluate:function(e,n,t){var r=t.evaluateAstNode,a=t.builtin,u=r(v(e.params[0]),n);b(u),W(u,n,a);var i=r(v(e.params[1]),n);return p(n[n.length-2])[u]={value:i},i},validate:function(e){return A(2,e)}},le={parse:function(e,n,t){var r=(0,t.parseToken)(e,n),a=r[0],u=r[1],i=p(e[n=a]);if("paren"!==i.type||")"!==i.value)throw new f(")",i);return[n+=1,{type:"SpecialExpression",name:"throw",params:[],messageNode:u}]},evaluate:function(e,n,t){var r=function(e){if("string"!=typeof e||0===e.length)throw TypeError("Expected non empty string, got: "+e+' type="'+typeof e+'"');return e}((0,t.evaluateAstNode)(e.messageNode,n));throw new i(r)}},ve={parse:function(e,n,t){var r,a,u,i,o=t.parseToken;n=(r=o(e,n))[0],i=r[1];var l,v,s=p(e[n]);if("paren"!==s.type||"("!==s.value)throw new f("(",s);if("paren"!==(s=p(e[n+=1])).type||"("!==s.value)throw new f("(",s);if(n=(a=o(e,n+=1))[0],"Name"!==(l=a[1]).type)throw new c("Name",l);if("paren"!==(s=p(e[n])).type||")"!==s.value)throw new f(")",s);if(n=(u=o(e,n+=1))[0],v=u[1],"paren"!==(s=p(e[n])).type||")"!==s.value)throw new f(")",s);if("paren"!==(s=p(e[n+=1])).type||")"!==s.value)throw new f(")",s);return[n+=1,{type:"SpecialExpression",name:"try",params:[],tryExpression:i,catchExpression:v,error:l}]},evaluate:function(e,n,t){var r,u=t.evaluateAstNode;try{return u(e.tryExpression,n)}catch(t){var i=((r={})[e.error.value]={value:t},r);return u(e.catchExpression,a([i],n))}}},se={parse:function(e,n,t){var r=(0,t.parseTokens)(e,n);return[r[0]+1,{type:"SpecialExpression",name:"when",params:r[1]}]},evaluate:function(e,n,t){var r=t.evaluateAstNode,a=e.params,u=a[0],i=a.slice(1);if(d(u),r(u,n)){for(var o=void 0,f=0,c=i;f<c.length;f++){o=r(c[f],n)}return o}},validate:function(e){return A({min:1},e)}},pe={parse:function(e,n,t){var r;return[(n=(r=(0,t.parseTokens)(e,n))[0])+1,{type:"SpecialExpression",name:"recur",params:r[1]}]},evaluate:function(e,n,t){var r=t.evaluateAstNode,a=e.params.map((function(e){return r(e,n)}));throw new u(a)}},de={parse:function(e,n,t){var r,a,u,i=t.parseTokens;return n=(r=(0,t.parseBindings)(e,n))[0],u=r[1],[(n=(a=i(e,n))[0])+1,{type:"SpecialExpression",name:"loop",params:a[1],bindings:u}]},evaluate:function(e,n,t){for(var r=t.evaluateAstNode,i=e.bindings.reduce((function(e,t){return e[t.name]={value:r(t.value,n)},e}),{}),o=a([i],n),f=function(){var n=void 0;try{for(var t=0,a=e.params;t<a.length;t++){var f=a[t];n=r(f,o)}}catch(n){if(n instanceof u){var c=n.params;if(c.length!==e.bindings.length)throw Error("recur expected "+e.bindings.length+" parameters, got "+c.length);return e.bindings.forEach((function(e,n){p(i[e.name]).value=c[n]})),"continue"}throw n}return{value:n}};;){var c=f();if("object"==typeof c)return c.value}}},me={parse:function(e,n,t){var r=(0,t.parseToken)(e,n);return[r[0]+1,{type:"SpecialExpression",name:"time!",params:[r[1]]}]},evaluate:function(e,n,t){var r=t.evaluateAstNode,a=e.params[0];d(a);var u=Date.now(),i=r(a,n),o=Date.now()-u;return console.log("Elapsed time: "+o+" ms"),i},validate:function(e){return A(1,e)}},he={get:{evaluate:function(e){var n=e[0],t=e[1],r=e[2],a=3===e.length;if(I(n),_(n)){if(g(t),t<n.length)return n[t]}else{if(!R(n))return g(t),n[t];if(b(t),Object.getOwnPropertyDescriptor(n,t))return n[t]}if(a)return r},validate:function(e){return A({min:2,max:3},e)}},count:{evaluate:function(e){var n=e[0];return"string"==typeof n?n.length:(I(n),Array.isArray(n)?n.length:Object.keys(n).length)},validate:function(e){return A(1,e)}},"contains?":{evaluate:function(e){var n=e[0],t=e[1];return I(n),E(t),C(n)?!!Number.isInteger(t)&&(g(t),t>=0&&t<n.length):!!Object.getOwnPropertyDescriptor(n,t)},validate:function(e){return A(2,e)}},"has?":{evaluate:function(e){var n=e[0],t=e[1];return I(n),_(n)?n.includes(t):q(n)?!!q(t)&&n.split("").includes(t):Object.values(n).includes(t)},validate:function(e){return A(2,e)}},assoc:{evaluate:function(e){var n=e[0],t=e[1],u=e[2];if(I(n),E(t),Array.isArray(n)||"string"==typeof n){if(g(t),y(t,0),function(e,n){if(m(e),e>n)throw TypeError("Expected parameter ("+e+") to be a number equal or less than "+n)}(t,n.length),"string"==typeof n)return x(u),""+n.slice(0,t)+u+n.slice(t+1);var i=a([],n);return i[t]=u,i}b(t);var o=r({},n);return o[t]=u,o},validate:function(e){return A(3,e)}},concat:{evaluate:function(e){return I(e[0]),_(e[0])?e.reduce((function(e,n){return T(n),e.concat(n)}),[]):q(e[0])?e.reduce((function(e,n){return b(n),""+e+n}),""):e.reduce((function(e,n){return P(n),Object.assign(e,n)}),{})},validate:function(e){return A({min:1},e)}},"empty?":{evaluate:function(e){var n=e[0];return I(n),q(n)||Array.isArray(n)?0===n.length:0===Object.keys(n).length},validate:function(e){return A(1,e)}},"every?":{evaluate:function(e,n,t){var r=e[0],a=e[1],u=t.executeFunction;return j(r),I(a),Array.isArray(a)?a.every((function(e){return u(r,[e],n)})):q(a)?a.split("").every((function(e){return u(r,[e],n)})):Object.entries(a).every((function(e){return u(r,[e],n)}))},validate:function(e){return A(2,e)}},"any?":{evaluate:function(e,n,t){var r=e[0],a=e[1],u=t.executeFunction;return j(r),I(a),Array.isArray(a)?a.some((function(e){return u(r,[e],n)})):q(a)?a.split("").some((function(e){return u(r,[e],n)})):Object.entries(a).some((function(e){return u(r,[e],n)}))},validate:function(e){return A(2,e)}},"not-any?":{evaluate:function(e,n,t){var r=e[0],a=e[1],u=t.executeFunction;return j(r),I(a),Array.isArray(a)?!a.some((function(e){return u(r,[e],n)})):q(a)?!a.split("").some((function(e){return u(r,[e],n)})):!Object.entries(a).some((function(e){return u(r,[e],n)}))},validate:function(e){return A(2,e)}},"not-every?":{evaluate:function(e,n,t){var r=e[0],a=e[1],u=t.executeFunction;return j(r),I(a),Array.isArray(a)?!a.every((function(e){return u(r,[e],n)})):q(a)?!a.split("").every((function(e){return u(r,[e],n)})):!Object.entries(a).every((function(e){return u(r,[e],n)}))},validate:function(e){return A(2,e)}}},ge=function(e,n,t){var r=t.executeFunction,a=e[0],u=e[1];j(a),F(u);var i=q(u),o=u.length;if(2===e.length)return _(u)?u.map((function(e){return r(a,[e],n)})):u.split("").map((function(e){var t=r(a,[e],n);return x(t),t})).join("");if(e.slice(2).forEach((function(e){if(i?b(e):T(e),o!==e.length)throw Error('All arguments to "map" must have the same length')})),i){for(var f="",c=function(t){var u=e.slice(1).map((function(e){return e[t]})),i=r(a,u,n);x(i),f+=i},l=0;l<o;l+=1)c(l);return f}f=[];var v=function(t){var u=e.slice(1).map((function(e){return e[t]}));f.push(r(a,u,n))};for(l=0;l<o;l+=1)v(l);return f},ye={cons:{evaluate:function(e){var n=e[0],t=e[1];return F(t),Array.isArray(t)?a([n],t):(x(n),""+n+t)},validate:function(e){return A(2,e)}},nth:{evaluate:function(e){var n=e[0],t=e[1];return F(n),g(t),n[t]},validate:function(e){return A(2,e)}},filter:{evaluate:function(e,n,t){var r=e[0],a=e[1],u=t.executeFunction;return j(r),F(a),Array.isArray(a)?a.filter((function(e){return u(r,[e],n)})):a.split("").filter((function(e){return u(r,[e],n)})).join("")},validate:function(e){return A(2,e)}},first:{evaluate:function(e){var n=e[0];return F(n),n[0]},validate:function(e){return A(1,e)}},last:{evaluate:function(e){var n=e[0];return F(n),n[n.length-1]},validate:function(e){return A(1,e)}},map:{evaluate:ge,validate:function(e){return A({min:2},e)}},pop:{evaluate:function(e){var n=e[0];if(F(n),q(n))return n.substr(0,n.length-1);var t=a([],n);return t.pop(),t},validate:function(e){return A(1,e)}},position:{evaluate:function(e,n,t){var r,a=e[0],u=e[1],i=t.executeFunction;return j(a),F(u),q(u)?-1!==(r=u.split("").findIndex((function(e){return i(a,[e],n)})))?r:void 0:-1!==(r=u.findIndex((function(e){return i(a,[e],n)})))?r:void 0},validate:function(e){return A(2,e)}},"index-of":{evaluate:function(e){var n,t=e[0],r=e[1];return F(t),q(t)?(b(r),-1!==(n=t.indexOf(r))?n:void 0):-1!==(n=t.indexOf(r))?n:void 0},validate:function(e){return A(2,e)}},push:{evaluate:function(e){var n=e[0],t=e.slice(1);return F(n),q(n)?(k(t),a([n],t).join("")):a(a([],n),t)},validate:function(e){return A({min:2},e)}},reduce:{evaluate:function(e,n,t){var r=t.executeFunction,a=e[0];if(j(a),2===e.length){var u=e[1];if(F(u),0===u.length)return r(a,[],n);if(1===u.length)return u[0];if(q(u)){var i=u.split("");return i.slice(1).reduce((function(e,t){return r(a,[e,t],n)}),i[0])}return u.slice(1).reduce((function(e,t){return r(a,[e,t],n)}),u[0])}var o=e[1],f=e[2];return F(f),q(f)?(b(o),0===f.length?o:f.split("").reduce((function(e,t){return r(a,[e,t],n)}),o)):0===f.length?o:f.reduce((function(e,t){return r(a,[e,t],n)}),o)},validate:function(e){return A({min:2,max:3},e)}},"reduce-right":{evaluate:function(e,n,t){var r=t.executeFunction,a=e[0];if(j(a),2===e.length){if(F(i=e[1]),0===i.length)return r(a,[],n);if(1===i.length)return i[0];if(q(i)){var u=i.split("");return u.slice(0,u.length-1).reduceRight((function(e,t){return r(a,[e,t],n)}),u[u.length-1])}return i.slice(0,i.length-1).reduceRight((function(e,t){return r(a,[e,t],n)}),i[i.length-1])}var i,o=e[1];return F(i=e[2]),q(i)?0===i.length?o:i.split("").reduceRight((function(e,t){return r(a,[e,t],n)}),o):0===i.length?o:i.reduceRight((function(e,t){return r(a,[e,t],n)}),o)},validate:function(e){return A({min:2,max:3},e)}},rest:{evaluate:function(e){var n=e[0];return F(n),Array.isArray(n)?n.length<=1?[]:n.slice(1):n.substr(1)},validate:function(e){return A(1,e)}},nthrest:{evaluate:function(e){var n=e[0],t=e[1];F(n),m(t);var r=Math.max(Math.ceil(t),0);return Array.isArray(n)?n.slice(r):n.substr(r)},validate:function(e){return A(2,e)}},next:{evaluate:function(e){var n=e[0];if(F(n),Array.isArray(n)){if(n.length<=1)return;return n.slice(1)}if(!(n.length<=1))return n.substr(1)},validate:function(e){return A(1,e)}},nthnext:{evaluate:function(e){var n=e[0],t=e[1];F(n),m(t);var r=Math.max(Math.ceil(t),0);if(!(n.length<=t))return Array.isArray(n)?n.slice(r):n.substr(r)},validate:function(e){return A(2,e)}},reverse:{evaluate:function(e){var n=e[0];return F(n),Array.isArray(n)?a([],n).reverse():n.split("").reverse().join("")},validate:function(e){return A(1,e)}},second:{evaluate:function(e){var n=e[0];return F(n),n[1]},validate:function(e){return A(1,e)}},shift:{evaluate:function(e){var n=e[0];if(F(n),q(n))return n.substr(1);var t=a([],n);return t.shift(),t},validate:function(e){return A(1,e)}},slice:{evaluate:function(e){var n=e[0],t=e[1],r=e[2];return F(n),1===e.length?n:(g(t),2===e.length?n.slice(t):(g(r),n.slice(t,r)))},validate:function(e){return A({min:1,max:3},e)}},some:{evaluate:function(e,n,t){var r=e[0],a=e[1],u=t.executeFunction;if(j(r),F(a),0!==a.length)return q(a)?a.split("").find((function(e){return u(r,[e],n)})):a.find((function(e){return u(r,[e],n)}))},validate:function(e){return A(2,e)}},sort:{evaluate:function(e,n,t){var r=t.executeFunction,u=1===e.length,i=u?e[0]:e[1],o=u?null:e[0];if(F(i),q(i)){var f=i.split("");return u?f.sort($):(j(o),f.sort((function(e,t){var a=r(o,[e,t],n);return m(a),a}))),f.join("")}var c=a([],i);return u?c.sort($):c.sort((function(e,t){j(o);var a=r(o,[e,t],n);return m(a),a})),c},validate:function(e){return A({min:1,max:2},e)}},take:{evaluate:function(e){var n=e[0],t=e[1];S(n),F(t);var r=Math.max(Math.ceil(n),0);return t.slice(0,r)},validate:function(e){return A(2,e)}},"take-last":{evaluate:function(e){var n=e[0],t=e[1];F(t),S(n);var r=Math.max(Math.ceil(n),0),a=t.length-r;return t.slice(a)},validate:function(e){return A(2,e)}},"take-while":{evaluate:function(e,n,t){var r=e[0],a=e[1],u=t.executeFunction;F(a),j(r);for(var i=[],o=0,f=a;o<f.length;o++){var c=f[o];if(!u(r,[c],n))break;i.push(c)}return q(a)?i.join(""):i},validate:function(e){return A(2,e)}},drop:{evaluate:function(e){var n=e[0],t=e[1];S(n);var r=Math.max(Math.ceil(n),0);return F(t),t.slice(r)},validate:function(e){return A(2,e)}},"drop-last":{evaluate:function(e){var n=e[0],t=e[1];F(t),S(n);var r=Math.max(Math.ceil(n),0),a=t.length-r;return t.slice(0,a)},validate:function(e){return A(2,e)}},"drop-while":{evaluate:function(e,n,t){var r=e[0],a=e[1],u=t.executeFunction;if(F(a),j(r),Array.isArray(a)){var i=a.findIndex((function(e){return!u(r,[e],n)}));return a.slice(i)}var o=a.split(""),f=o.findIndex((function(e){return!u(r,[e],n)}));return o.slice(f).join("")},validate:function(e){return A(2,e)}},unshift:{evaluate:function(e){var n=e[0],t=e.slice(1);if(F(n),q(n))return k(t),a(a([],t),[n]).join("");var r=a([],n);return r.unshift.apply(r,t),r},validate:function(e){return A({min:2},e)}},"random-sample":{evaluate:function(e){var n=e[0],t=e[1];return m(n),F(t),q(t)?t.split("").filter((function(){return Math.random()<n})).join(""):t.filter((function(){return Math.random()<n}))},validate:function(e){return A(2,e)}},"rand-nth":{evaluate:function(e){var n=e[0];if(F(n),0!==n.length){var t=Math.floor(Math.random()*n.length);return q(n)?n.split("")[t]:n[t]}},validate:function(e){return A(1,e)}},shuffle:{evaluate:function(e){var n=e[0];F(n);for(var t,r,u=q(n)?a([],n.split("")):a([],n),i=u.length;i;)i-=1,r=Math.floor(Math.random()*i),t=u[i],u[i]=u[r],u[r]=t;return q(n)?u.join(""):u},validate:function(e){return A(1,e)}},distinct:{evaluate:function(e){var n=e[0];return F(n),Array.isArray(n)?Array.from(new Set(n)):Array.from(new Set(n.split(""))).join("")},validate:function(e){return A(1,e)}},remove:{evaluate:function(e,n,t){var r=e[0],a=e[1],u=t.executeFunction;return j(r),F(a),Array.isArray(a)?a.filter((function(e){return!u(r,[e],n)})):a.split("").filter((function(e){return!u(r,[e],n)})).join("")},validate:function(e){return A(2,e)}},"split-at":{evaluate:function(e){var n=e[0],t=e[1];m(n);var r=Math.max(0,Math.ceil(n));return F(t),[t.slice(0,r),t.slice(r)]},validate:function(e){return A(2,e)}},"split-with":{evaluate:function(e,n,t){var r=e[0],a=e[1],u=t.executeFunction;j(r),F(a);var i=Array.isArray(a),o=(i?a:a.split("")).findIndex((function(e){return!u(r,[e],n)}));return-1===o?[a,i?[]:""]:[a.slice(0,o),a.slice(o)]},validate:function(e){return A(2,e)}}},be={array:{evaluate:function(e){return e}},range:{evaluate:function(e){var n,t,r,a=e[0],u=e[1],i=e[2];m(a),1===e.length?(n=0,r=(t=a)>=0?1:-1):2===e.length?(m(u),r=(t=u)>=(n=a)?1:-1):(m(u),m(i),r=i,(t=u)>(n=a)?function(e){if(m(e),e<=0)throw TypeError("Expected positive number, got "+e)}(r):t<n?function(e){if(m(e),e>=0)throw TypeError("Expected negative number, got "+e)}(r):function(e){if(m(e),0===e)throw TypeError("Expected non zero value")}(r));for(var o=[],f=n;r<0?f>t:f<t;f+=r)o.push(f);return o},validate:function(e){return A({min:1,max:3},e)}},repeat:{evaluate:function(e){var n=e[0],t=e[1];h(n);for(var r=[],a=0;a<n;a+=1)r.push(t);return r},validate:function(e){return A(2,e)}},flatten:{evaluate:function(e){var n=e[0];return _(n)?n.flat(Number.POSITIVE_INFINITY):[]},validate:function(e){return A(1,e)}},mapcat:{evaluate:function(e,n,t){e.slice(1).forEach((function(e){T(e)}));var r=ge(e,n,t);return T(r),r.flat(1)},validate:function(e){return A({min:2},e)}}},xe={inc:{evaluate:function(e){var n=e[0];return S(n),n+1},validate:function(e){return A(1,e)}},dec:{evaluate:function(e){var n=e[0];return S(n),n-1},validate:function(e){return A(1,e)}},"+":{evaluate:function(e){return e.reduce((function(e,n){return S(n),e+n}),0)}},"*":{evaluate:function(e){return e.reduce((function(e,n){return S(n),e*n}),1)}},"/":{evaluate:function(e){if(0===e.length)return 1;var n=e[0],t=e.slice(1);return S(n),0===t.length?(S(n),1/n):t.reduce((function(e,n){return S(n),e/n}),n)}},"-":{evaluate:function(e){var n=e[0],t=e.slice(1);return n?(S(n),0===t.length?-n:t.reduce((function(e,n){return S(n),e-n}),n)):0}},quot:{evaluate:function(e){var n=e[0],t=e[1];return S(n),S(t),Math.trunc(n/t)},validate:function(e){return A(2,e)}},mod:{evaluate:function(e){var n=e[0],t=e[1];return S(n),S(t),n-t*Math.floor(n/t)},validate:function(e){return A(2,e)}},rem:{evaluate:function(e){var n=e[0],t=e[1];return S(n),S(t),n-t*Math.trunc(n/t)},validate:function(e){return A(2,e)}},sqrt:{evaluate:function(e){var n=e[0];return S(n),Math.sqrt(n)},validate:function(e){return A(1,e)}},cbrt:{evaluate:function(e){var n=e[0];return S(n),Math.cbrt(n)},validate:function(e){return A(1,e)}},pow:{evaluate:function(e){var n=e[0],t=e[1];return S(n),S(t),Math.pow(n,t)},validate:function(e){return A(2,e)}},round:{evaluate:function(e){var n=e[0],t=e[1];if(S(n),1===e.length||0===t)return Math.round(n);h(t);var r=Math.pow(10,t);return Math.round(n*r)/r},validate:function(e){return A({min:1,max:2},e)}},trunc:{evaluate:function(e){var n=e[0];return S(n),Math.trunc(n)},validate:function(e){return A(1,e)}},floor:{evaluate:function(e){var n=e[0];return S(n),Math.floor(n)},validate:function(e){return A(1,e)}},ceil:{evaluate:function(e){var n=e[0];return S(n),Math.ceil(n)},validate:function(e){return A(1,e)}},rand:{evaluate:function(e){var n=1===e.length?e[0]:1;return S(n),Math.random()*n},validate:function(e){return A({min:0,max:1},e)}},"rand-int":{evaluate:function(e){var n=e[0];return S(n),Math.floor(Math.random()*Math.abs(n))*Math.sign(n)},validate:function(e){return A(1,e)}},min:{evaluate:function(e){var n=e[0],t=e.slice(1);return S(n),0===t.length?n:t.reduce((function(e,n){return S(n),Math.min(e,n)}),n)},validate:function(e){return A({min:1},e)}},max:{evaluate:function(e){var n=e[0],t=e.slice(1);return S(n),0===t.length?n:t.reduce((function(e,n){return S(n),Math.max(e,n)}),n)},validate:function(e){return A({min:1},e)}},abs:{evaluate:function(e){var n=e[0];return S(n),Math.abs(n)},validate:function(e){return A(1,e)}},sign:{evaluate:function(e){var n=e[0];return S(n),Math.sign(n)},validate:function(e){return A(1,e)}},"max-safe-integer":{evaluate:function(){return Number.MAX_SAFE_INTEGER},validate:function(e){return A(0,e)}},"min-safe-integer":{evaluate:function(){return Number.MIN_SAFE_INTEGER},validate:function(e){return A(0,e)}},"max-value":{evaluate:function(){return Number.MAX_VALUE},validate:function(e){return A(0,e)}},"min-value":{evaluate:function(){return Number.MIN_VALUE},validate:function(e){return A(0,e)}},epsilon:{evaluate:function(){return Number.EPSILON},validate:function(e){return A(0,e)}},infinity:{evaluate:function(){return Number.POSITIVE_INFINITY},validate:function(e){return A(0,e)}},"-infinity":{evaluate:function(){return Number.NEGATIVE_INFINITY},validate:function(e){return A(0,e)}},nan:{evaluate:function(){return Number.NaN},validate:function(e){return A(0,e)}},e:{evaluate:function(){return Math.E},validate:function(e){return A(0,e)}},pi:{evaluate:function(){return Math.PI},validate:function(e){return A(0,e)}},exp:{evaluate:function(e){var n=e[0];return S(n),Math.exp(n)},validate:function(e){return A(1,e)}},log:{evaluate:function(e){var n=e[0];return S(n),Math.log(n)},validate:function(e){return A(1,e)}},log2:{evaluate:function(e){var n=e[0];return S(n),Math.log2(n)},validate:function(e){return A(1,e)}},log10:{evaluate:function(e){var n=e[0];return S(n),Math.log10(n)},validate:function(e){return A(1,e)}},sin:{evaluate:function(e){var n=e[0];return S(n),Math.sin(n)},validate:function(e){return A(1,e)}},asin:{evaluate:function(e){var n=e[0];return S(n),Math.asin(n)},validate:function(e){return A(1,e)}},sinh:{evaluate:function(e){var n=e[0];return S(n),Math.sinh(n)},validate:function(e){return A(1,e)}},asinh:{evaluate:function(e){var n=e[0];return S(n),Math.asinh(n)},validate:function(e){return A(1,e)}},cos:{evaluate:function(e){var n=e[0];return S(n),Math.cos(n)},validate:function(e){return A(1,e)}},acos:{evaluate:function(e){var n=e[0];return S(n),Math.acos(n)},validate:function(e){return A(1,e)}},cosh:{evaluate:function(e){var n=e[0];return S(n),Math.cosh(n)},validate:function(e){return A(1,e)}},acosh:{evaluate:function(e){var n=e[0];return S(n),Math.acosh(n)},validate:function(e){return A(1,e)}},tan:{evaluate:function(e){var n=e[0];return S(n),Math.tan(n)},validate:function(e){return A(1,e)}},atan:{evaluate:function(e){var n=e[0];return S(n),Math.atan(n)},validate:function(e){return A(1,e)}},tanh:{evaluate:function(e){var n=e[0];return S(n),Math.tanh(n)},validate:function(e){return A(1,e)}},atanh:{evaluate:function(e){var n=e[0];return S(n),Math.atanh(n)},validate:function(e){return A(1,e)}}},Ee=/[[.]/;function we(e,n){for(var t=0,r=Ae(n);t<r.length;t++){var a=r[t];try{e=e[a]}catch(e){return}}return e}function Ae(e){if(!e)return[];var n=Ee.exec(e);if(!n)return[e];if(n.index>0)return a([e.substring(0,n.index)],Ae(e.substring(n.index)));if("."===e[0]){if(e.length<2)throw Error("Ill formed path: "+e);return Ae(e.substring(1))}var t=function(e){var n=Ne.exec(e)||Me.exec(e);if(n){return[n[0].length,n[1]]}var t=je.exec(e);if(t){return[t[0].length,Number(t[1])]}throw Error("Ill formed path: "+e)}(e),r=t[0],u=t[1];if(e.length>r&&"."!==e[r]&&"["!==e[r])throw Error("Ill formed path: "+e);return a([u],Ae(e.substring(r)))}var Ne=/^\[\s*'(.*)'\s*\]/,Me=/^\[\s*"(.*)"\s*\]/,je=/^\[\s*(\d+)\s*\]/;var Oe={"not=":{evaluate:function(e){for(var n=0;n<e.length-1;n+=1)for(var t=n+1;t<e.length;t+=1)if(e[n]===e[t])return!1;return!0},validate:function(e){return A({min:1},e)}},"=":{evaluate:function(e){for(var n=e[0],t=0,r=e.slice(1);t<r.length;t++){if(r[t]!==n)return!1}return!0},validate:function(e){return A({min:1},e)}},"equal?":{evaluate:function(e){return z(e[0],e[1])},validate:function(e){return A({min:1},e)}},">":{evaluate:function(e){for(var n=e[0],t=0,r=e.slice(1);t<r.length;t++){var a=r[t];if($(n,a)<=0)return!1;n=a}return!0},validate:function(e){return A({min:1},e)}},"<":{evaluate:function(e){for(var n=e[0],t=0,r=e.slice(1);t<r.length;t++){var a=r[t];if($(n,a)>=0)return!1;n=a}return!0},validate:function(e){return A({min:1},e)}},">=":{evaluate:function(e){for(var n=e[0],t=0,r=e.slice(1);t<r.length;t++){var a=r[t];if($(n,a)<0)return!1;n=a}return!0},validate:function(e){return A({min:1},e)}},"<=":{evaluate:function(e){for(var n=e[0],t=0,r=e.slice(1);t<r.length;t++){var a=r[t];if($(n,a)>0)return!1;n=a}return!0},validate:function(e){return A({min:1},e)}},"get-path":{evaluate:function(e){var n=e[0],t=e[1];return function(e){if((null===e||"object"!=typeof e||Array.isArray(e)||e instanceof RegExp||M(e))&&!Array.isArray(e))throw TypeError("Expected object or array, got: "+e+' type="'+typeof e+'"')}(n),b(t),we(n,t)},validate:function(e){return A(2,e)}},not:{evaluate:function(e){return!e[0]},validate:function(e){return A(1,e)}},"inst-ms":{evaluate:function(){return Date.now()},validate:function(e){return A(0,e)}},"write!":{evaluate:function(e){if(console.log.apply(console,e),e.length>0)return e[e.length-1]}},"debug!":{evaluate:function(e,n){0!==e.length?console.warn("*** LISPISH DEBUG ***\n\n"+JSON.stringify(e[0],null,2)):console.warn("*** LISPISH DEBUG ***\n\n"+function(e){return a([],e).reverse().reduce((function(e,n,t){return e+"Context "+t+(0===t?" - Import context":1===t?" - Global context":"")+"\n"+function(e){if(0===Object.keys(e).length)return"  <empty>\n";var n=Math.max.apply(Math,Object.keys(e).map((function(e){return e.length})));return Object.entries(e).reduce((function(e,t){return e+"  "+(""+t[0]).padEnd(n+2," ")+function(e){var n=e.value,t=n.name;if(M(n))return t?"<"+n.type+" function "+t+">":"<"+n.type+" function λ>";return JSON.stringify(e.value)}(t[1])+"\n"}),"")}(n)+"\n"}),"")}(n))},validate:function(e){return A({max:1},e)}},boolean:{evaluate:function(e){return!!e[0]},validate:function(e){return A(1,e)}},compare:{evaluate:function(e){return $(e[0],e[1])},validate:function(e){return A(2,e)}},assert:{evaluate:function(e){var n=e[0],t=2===e.length?e[1]:""+n;if(b(t),!n)throw new o(t);return n},validate:function(e){return A({min:1,max:2},e)}},"lispish-version":{evaluate:function(){return"0.1.50"},validate:function(e){return A(0,e)}}};var ke={object:{evaluate:function(e){for(var n={},t=0;t<e.length;t+=2){var r=e[t],a=e[t+1];b(r),n[r]=a}return n},validate:function(e){return N(e)}},keys:{evaluate:function(e){var n=e[0];return P(n),Object.keys(n)},validate:function(e){return A(1,e)}},vals:{evaluate:function(e){var n=e[0];return P(n),Object.values(n)},validate:function(e){return A(1,e)}},entries:{evaluate:function(e){var n=e[0];return P(n),Object.entries(n)},validate:function(e){return A(1,e)}},find:{evaluate:function(e){var n=e[0],t=e[1];if(P(n),b(t),function(e,n){return!!V(e)&&(q(e)||_(e)?!!B(n)&&n>=0&&n<e.length:!!Object.getOwnPropertyDescriptor(e,n))}(n,t))return[t,n[t]]},validate:function(e){return A(2,e)}},dissoc:{evaluate:function(e){var n=e[0],t=e[1];P(n),b(t);var r=n[t];return delete n[t],r},validate:function(e){return A(2,e)}},merge:{evaluate:function(e){var n=e[0],t=e.slice(1);return P(n),t.reduce((function(e,n){return P(n),r(r({},e),n)}),r({},n))},validate:function(e){return A({min:1},e)}},zipmap:{evaluate:function(e){var n=e[0],t=e[1];O(n),T(t);for(var r=Math.min(n.length,t.length),a={},u=0;u<r;u+=1){a[p(n[u])]=t[u]}return a},validate:function(e){return A(2,e)}}},Se={"function?":{evaluate:function(e){return M(e[0])},validate:function(e){return A(1,e)}},"string?":{evaluate:function(e){return"string"==typeof e[0]},validate:function(e){return A(1,e)}},"number?":{evaluate:function(e){return"number"==typeof e[0]},validate:function(e){return A(1,e)}},"integer?":{evaluate:function(e){var n=e[0];return"number"==typeof n&&Number.isInteger(n)},validate:function(e){return A(1,e)}},"boolean?":{evaluate:function(e){return"boolean"==typeof e[0]},validate:function(e){return A(1,e)}},"undefined?":{evaluate:function(e){return void 0===e[0]},validate:function(e){return A(1,e)}},"null?":{evaluate:function(e){return null===e[0]},validate:function(e){return A(1,e)}},"zero?":{evaluate:function(e){var n=e[0];return m(n),0===n},validate:function(e){return A(1,e)}},"pos?":{evaluate:function(e){var n=e[0];return m(n),n>0},validate:function(e){return A(1,e)}},"neg?":{evaluate:function(e){var n=e[0];return m(n),n<0},validate:function(e){return A(1,e)}},"even?":{evaluate:function(e){var n=e[0];return m(n),n%2==0},validate:function(e){return A(1,e)}},"odd?":{evaluate:function(e){var n=e[0];return m(n),Number.isInteger(n)&&n%2!=0},validate:function(e){return A(1,e)}},"array?":{evaluate:function(e){return _(e[0])},validate:function(e){return A(1,e)}},"coll?":{evaluate:function(e){return V(e[0])},validate:function(e){return A(1,e)}},"seq?":{evaluate:function(e){return C(e[0])},validate:function(e){return A(1,e)}},"object?":{evaluate:function(e){return R(e[0])},validate:function(e){return A(1,e)}},"regexp?":{evaluate:function(e){var n=e[0];return null!==n&&!Array.isArray(n)&&"object"==typeof n&&n instanceof RegExp},validate:function(e){return A(1,e)}},"finite?":{evaluate:function(e){var n=e[0];return S(n),Number.isFinite(n)},validate:function(e){return A(1,e)}},"nan?":{evaluate:function(e){var n=e[0];return S(n),Number.isNaN(n)},validate:function(e){return A(1,e)}},"positive-infinity?":{evaluate:function(e){var n=e[0];return S(n),n===Number.POSITIVE_INFINITY},validate:function(e){return A(1,e)}},"negative-infinity?":{evaluate:function(e){var n=e[0];return S(n),n===Number.NEGATIVE_INFINITY},validate:function(e){return A(1,e)}},"true?":{evaluate:function(e){return!0===e[0]},validate:function(e){return A(1,e)}},"false?":{evaluate:function(e){return!1===e[0]},validate:function(e){return A(1,e)}}},Te={regexp:{evaluate:function(e){var n=e[0],t=e[1];return b(n),1===e.length?new RegExp(n):(b(t),new RegExp(n,t))},validate:function(e){return A({min:1,max:2},e)}},match:{evaluate:function(e){var n=e[0],t=e[1];w(n),b(t);var r=n.exec(t);if(r)return a([],r)},validate:function(e){return A(2,e)}},replace:{evaluate:function(e){var n=e[0],t=e[1],r=e[2];return b(n),w(t),b(r),n.replace(t,r)},validate:function(e){return A(3,e)}}},Ie={subs:{evaluate:function(e){var n=e[0],t=e[1],r=e[2];return b(n),h(t),void 0===r?n.substring(t):(y(r,t),n.substring(t,r))},validate:function(e){return A({min:2,max:3},e)}},"string-repeat":{evaluate:function(e){var n=e[0],t=e[1];return b(n),h(t),n.repeat(t)},validate:function(e){return A(2,e)}},str:{evaluate:function(e){return e.reduce((function(e,n){return e+(void 0===n?"":null===n?"null":R(n)||Array.isArray(n)?JSON.stringify(n):""+n)}),"")}},"string-to-number":{evaluate:function(e){var n=e[0];b(n);var t=Number(n);if(Number.isNaN(t))throw Error("Could not convert '"+n+"' to a number");return t},validate:function(e){return A(1,e)}},"number-to-string":{evaluate:function(e){var n=e[0],t=e[1];if(m(n),1===e.length)return""+n;if(m(t),2!==t&&8!==t&&10!==t&&16!==t)throw Error('Expected "number-to-string" base argument to be 2, 8, 10 or 16, got: '+t);return 10===t?""+n:(h(n),Number(n).toString(t))},validate:function(e){return A({min:1,max:2},e)}},"from-char-code":{evaluate:function(e){var n=e[0];m(n);var t=Math.max(0,Math.ceil(n));return String.fromCodePoint(t)},validate:function(e){return A(1,e)}},"to-char-code":{evaluate:function(e){var n=e[0];return function(e){if(b(e),0===e.length)throw TypeError("Expected non empty string, got: "+e+' type="'+typeof e+'"')}(n),p(n.codePointAt(0))},validate:function(e){return A(1,e)}},"lower-case":{evaluate:function(e){var n=e[0];return b(n),n.toLowerCase()},validate:function(e){return A(1,e)}},"upper-case":{evaluate:function(e){var n=e[0];return b(n),n.toUpperCase()},validate:function(e){return A(1,e)}},trim:{evaluate:function(e){var n=e[0];return b(n),n.trim()},validate:function(e){return A(1,e)}},"trim-left":{evaluate:function(e){var n=e[0];return b(n),n.replace(/^\s+/,"")},validate:function(e){return A(1,e)}},"trim-right":{evaluate:function(e){var n=e[0];return b(n),n.replace(/\s+$/,"")},validate:function(e){return A(1,e)}},join:{evaluate:function(e){var n=e[0],t=e[1];return T(n),n.forEach((function(e){return b(e)})),b(t),n.join(t)},validate:function(e){return A(2,e)}},split:{evaluate:function(e){var n=e[0],t=e[1],r=e[2];return b(n),function(e){if(!(e instanceof RegExp||"string"==typeof e))throw TypeError("Expected RegExp or string, got: "+e+' type="'+typeof e+'"')}(t),void 0!==r&&h(r),n.split(t,r)},validate:function(e){return A({min:2,max:3},e)}},"pad-left":{evaluate:function(e){var n=e[0],t=e[1],r=e[2];return b(n),g(t),void 0!==r&&b(r),n.padStart(t,r)},validate:function(e){return A({min:2,max:3},e)}},"pad-right":{evaluate:function(e){var n=e[0],t=e[1],r=e[2];return b(n),g(t),void 0!==r&&b(r),n.padEnd(t,r)},validate:function(e){return A({min:2,max:3},e)}},template:{evaluate:function(e){var n=e[0],t=e.slice(1);b(n);var r=n.split("||||");if(1===r.length)return O(t),Pe(r[0],t);if(2===r.length){var u=t[0];h(u);var i=a([""+u],t.slice(1));return Pe(1===u?r[0]:r[1],i)}throw Error('Invalid template string, only one "||||" separator allowed')},validate:function(e){return A({min:1,max:10},e)}}},Fe=/\$\$/g;function Pe(e,n){for(var t=0;t<9;t+=1){var r=new RegExp("(?<=^|[^$]|\\$\\$)\\$"+(t+1),"g");if(r.test(e)){var a=n[t];b(a),e=e.replace(r,a)}}return e.replace(Fe,"$")}var Re={apply:{evaluate:function(e,n,t){var r=e[0],u=e.slice(1),i=t.executeFunction;j(r);var o=u[u.length-1];return T(o),i(r,a(a([],u.slice(0,-1)),o),n)},validate:function(e){return A({min:2},e)}},identity:{evaluate:function(e){return e[0]},validate:function(e){return A(1,e)}},partial:{evaluate:function(e){var n,t=e[0],r=e.slice(1);return(n={})[l]=!0,n.type="partial",n.fn=t,n.params=r,n},validate:function(e){return A({min:1},e)}},comp:{evaluate:function(e){var n;if(e.length>1){var t=e[e.length-1];_(t)&&(e=a(a([],e.slice(0,-1)),t))}return(n={})[l]=!0,n.type="comp",n.fns=e,n}},constantly:{evaluate:function(e){var n,t=e[0];return(n={})[l]=!0,n.type="constantly",n.value=t,n},validate:function(e){return A(1,e)}},juxt:{evaluate:function(e){var n;return(n={})[l]=!0,n.type="juxt",n.fns=e,n},validate:function(e){return A({min:1},e)}},complement:{evaluate:function(e){var n,t=e[0];return(n={})[l]=!0,n.type="complement",n.fn=t,n},validate:function(e){return A(1,e)}},"every-pred":{evaluate:function(e){var n;return(n={})[l]=!0,n.type="every-pred",n.fns=e,n},validate:function(e){return A({min:1},e)}},"some-pred":{evaluate:function(e){var n;return(n={})[l]=!0,n.type="some-pred",n.fns=e,n},validate:function(e){return A({min:1},e)}}},_e=r(r(r(r(r(r(r(r(r(r(r({},{"bit-shift-left":{evaluate:function(e){var n=e[0],t=e[1];return g(n),h(t),n<<t},validate:function(e){return A(2,e)}},"bit-shift-right":{evaluate:function(e){var n=e[0],t=e[1];return g(n),h(t),n>>t},validate:function(e){return A(2,e)}},"bit-not":{evaluate:function(e){var n=e[0];return g(n),~n},validate:function(e){return A(1,e)}},"bit-and":{evaluate:function(e){var n=e[0],t=e.slice(1);return g(n),t.reduce((function(e,n){return g(n),e&n}),n)},validate:function(e){return A({min:2},e)}},"bit-and-not":{evaluate:function(e){var n=e[0],t=e.slice(1);return g(n),t.reduce((function(e,n){return g(n),e&~n}),n)},validate:function(e){return A({min:2},e)}},"bit-or":{evaluate:function(e){var n=e[0],t=e.slice(1);return g(n),t.reduce((function(e,n){return g(n),e|n}),n)},validate:function(e){return A({min:2},e)}},"bit-xor":{evaluate:function(e){var n=e[0],t=e.slice(1);return g(n),t.reduce((function(e,n){return g(n),e^n}),n)},validate:function(e){return A({min:2},e)}},"bit-flip":{evaluate:function(e){var n=e[0],t=e[1];return g(n),h(t),n^1<<t},validate:function(e){return A(2,e)}},"bit-set":{evaluate:function(e){var n=e[0],t=e[1];return g(n),h(t),n|1<<t},validate:function(e){return A(2,e)}},"bit-clear":{evaluate:function(e){var n=e[0],t=e[1];return g(n),h(t),n&~(1<<t)},validate:function(e){return A(2,e)}},"bit-test":{evaluate:function(e){var n=e[0],t=e[1];return g(n),h(t),!!(n&1<<t)},validate:function(e){return A(2,e)}}}),he),be),ye),xe),Oe),ke),Se),Te),Ie),Re),Ce={def:fe,defs:ce,and:{parse:function(e,n,t){var r=(0,t.parseTokens)(e,n);return[r[0]+1,{type:"SpecialExpression",name:"and",params:r[1]}]},evaluate:function(e,n,t){for(var r=t.evaluateAstNode,a=!0,u=0,i=e.params;u<i.length;u++){if(!(a=r(i[u],n)))break}return a}},cond:G,defn:K,defns:Z,if:ee,"if-not":ne,"if-let":te,"when-let":re,"when-not":ae,"when-first":ue,fn:Q,let:ie,or:{parse:function(e,n,t){var r=(0,t.parseTokens)(e,n);return[r[0]+1,{type:"SpecialExpression",name:"or",params:r[1]}]},evaluate:function(e,n,t){for(var r=t.evaluateAstNode,a=!1,u=0,i=e.params;u<i.length;u++){if(a=r(i[u],n))break}return a}},do:oe,throw:le,try:ve,when:se,recur:pe,loop:de,"time!":me};Object.keys(Ce).forEach((function(e){if(_e[e])throw Error("Expression "+e+" is defined as both a normal expression and a special expression")}));var Ve={normalExpressions:_e,specialExpressions:Ce},qe=Object.keys(_e),Ue=Object.keys(Ce);function Be(e,n,t){for(var r,a=[n,t],u=0,i=e.body;u<i.length;u++){var o=i[u];r=De(o,a)}return r}var De=function(e,n){switch(e.type){case"Number":case"String":return function(e){return e.value}(e);case"Name":return function(e,n){for(var t,r=e.value,a=0,u=n;a<u.length;a++){var i=u[a][r];if(i)return i.value}if(Ve.normalExpressions[r]){return(t={})[l]=!0,t.type="builtin",t.builtin=r,t}throw Error("Undefined identifier "+r)}(e,n);case"ReservedName":return function(e){return p(Y[e.value],e.value+" is not a reserved name").value}(e);case"NormalExpression":return function(e,n){var t,r=e.params.map((function(e){return De(e,n)}));if(function(e){return"string"==typeof e.name}(e)){for(var a=0,u=n;a<u.length;a++){var i=null===(t=u[a][e.name])||void 0===t?void 0:t.value;try{return Le(i,r,n)}catch(e){continue}}return function(e,n,t){return(0,p(Ve.normalExpressions[e.name],e.name+" is not a function").evaluate)(n,t,{executeFunction:Le})}(e,r,n)}i=De(e.expression,n);return Le(i,r,n)}(e,n);case"SpecialExpression":return function(e,n){return(0,p(Ve.specialExpressions[e.name],e.name+" is not a built in special expression").evaluate)(e,n,{evaluateAstNode:De,builtin:Ve})}(e,n)}};var Le=function(e,n,t){if(M(e))return $e(e,n,t);if(Array.isArray(e))return function(e,n){if(1!==n.length)throw Error("Array as function requires one non negative integer parameter");var t=n[0];return h(t),e[t]}(e,n);if(R(e))return function(e,n){if(1!==n.length)throw Error("Object as function requires one string parameter");var t=n[0];return b(t),e[t]}(e,n);if(q(e))return function(e,n){if(1!==n.length)throw Error("String as function requires one Obj parameter");var t=n[0];if(R(t))return t[e];if(B(t))return e[t];throw Error("string as function expects Obj or integer parameter, got "+t)}(e,n);if(U(e))return function(e,n){if(g(e),1!==n.length)throw Error("String as function requires one Arr parameter");var t=n[0];return F(t),t[e]}(e,n);throw Error("Expected function, got "+e)},$e=function(e,n,t){var i,o;switch(e.type){case"user-defined":for(var f=e.arguments,c=f.mandatoryArguments.length,l=f.optionalArguments.length,v=f.restArgument?null:c+l;;){var s=r({},e.functionContext);if(n.length<f.mandatoryArguments.length)throw Error("Function "+(null!==(i=e.name)&&void 0!==i?i:"(fn)")+" requires at least "+f.mandatoryArguments.length+" arguments. Got "+n.length);if(null!==v&&n.length>v)throw Error('Function "'+(null!==(o=e.name)&&void 0!==o?o:"λ")+'" requires at most '+v+" arguments. Got "+n.length);for(var d=Math.max(n.length,f.mandatoryArguments.length+f.optionalArguments.length),m=[],h=0;h<d;h+=1)if(h<c){var g=n[h];s[p(f.mandatoryArguments[h],"")]={value:g}}else if(h<c+l){var y=p(f.optionalArguments[h-c],"");g=h<n.length?n[h]:void 0!==y.defaultValue?y.defaultValue:void 0;s[y.name]={value:g}}else m.push(n[h]);f.restArgument&&(s[f.restArgument]={value:m});try{for(var b=void 0,x=0,E=e.body;x<E.length;x++){var w=E[x];b=De(w,a([s],t))}return b}catch(e){if(e instanceof u){n=e.params;continue}throw e}}case"partial":return Le(e.fn,a(a([],e.params),n),t);case"comp":var A=e.fns;if(0===A.length){if(1!==n.length)throw Error("(comp) expects one argument, got "+n.length);return n[0]}return A.reduceRight((function(e,n){return[Le(n,e,t)]}),n)[0];case"constantly":return e.value;case"juxt":return e.fns.map((function(e){return Le(e,n,t)}));case"complement":return!Le(e.fn,n,t);case"every-pred":for(var N=0,M=e.fns;N<M.length;N++)for(var j=M[N],O=0,k=n;O<k.length;O++){g=k[O];if(!(b=Le(j,[g],t)))return!1}return!0;case"some-pred":for(var S=0,T=e.fns;S<T.length;S++){j=T[S];for(var I=0,F=n;I<F.length;I++){g=F[I];if(b=Le(j,[g],t))return!0}}return!1;default:return p(_e[e.builtin],e.builtin+" is not a function").evaluate(n,t,{executeFunction:Le})}};var ze=function(e,n){for(var t,r,a=p(e[n]),u=[];"paren"!==a.type||")"!==a.value&&"]"!==a.value;)n=(t=Ze(e,n))[0],r=t[1],u.push(r),a=p(e[n]);return[n,u]},Ge=function(e,n){var t=p(e[n+=1]);return"name"===t.type&&Ve.specialExpressions[t.value]?Ke(e,n):He(e,n)},Ye=/^%([1-9][0-9]?$)/,Je=function(e,n){var t=p(e[n]);if("name"===t.type)return[n+1,{type:"Argument",name:t.value}];if("paren"===t.type&&"("===t.value){if("name"!==(t=p(e[n+=1])).type)throw new f("name",t);var r=t.value,a=Ze(e,n+=1),u=a[0],i=a[1];if("paren"!==(t=p(e[u])).type||")"!==t.value)throw new f(")",t);return[u+1,{type:"Argument",name:r,defaultValue:i}]}if("modifier"===t.type)return[n+1,{type:"Modifier",value:t.value}];throw new f('"(", name or modifier',t)},We=function(e,n){var t,r=p(e[n]);if("paren"!==r.type||"["!==r.value)throw new f("[",r);r=p(e[n+=1]);for(var a,u=[];"paren"!==r.type||"]"!==r.value;)n=(t=Xe(e,n))[0],a=t[1],u.push(a),r=p(e[n]);return[n+=1,u]};function Xe(e,n){var t,r=p(e[n]);if("name"!==r.type)throw Error("Expected name node in binding, got "+r.type+" value="+r.value);var a=r.value;return r=p(e[n+=1]),[n=(t=Ze(e,n))[0],{type:"Binding",name:a,value:t[1]}]}var He=function(e,n){var t,r,a,u=Ze(e,n),i=u[0],o=u[1];if(n=(t=ze(e,i))[0],a=t[1],n+=1,function(e){return"NormalExpression"===e.type||"SpecialExpression"===e.type||"Number"===e.type||"String"===e.type}(o))return[n,{type:"NormalExpression",expression:o,params:a}];s(o);var f={type:"NormalExpression",name:o.value,params:a},c=Ve.normalExpressions[f.name];return c&&(null===(r=c.validate)||void 0===r||r.call(c,f)),[n,f]},Ke=function(e,n){var t=p(e[n]).value;n+=1;var r=p(Ve.specialExpressions[t],t+" is not a built in special expression"),a=r.parse,u=r.validate,i=a(e,n,{parseExpression:Ge,parseTokens:ze,parseToken:Ze,parseBindings:We,parseArgument:Je}),o=i[0],f=i[1];return null==u||u(f),[o,f]},Ze=function(e,n){var t=p(e[n]),r=void 0;switch(t.type){case"number":r=function(e,n){var t=p(e[n]);return[n+1,{type:"Number",value:Number(t.value)}]}(e,n);break;case"string":r=function(e,n){return[n+1,{type:"String",value:p(e[n]).value}]}(e,n);break;case"name":r=function(e,n){return[n+1,{type:"Name",value:p(e[n]).value}]}(e,n);break;case"reservedName":r=function(e,n){return[n+1,{type:"ReservedName",value:p(e[n]).value}]}(e,n);break;case"paren":"("===t.value?r=Ge(e,n):"["===t.value?r=function(e,n){for(var t,r,a=p(e[n+=1]),u=[];"paren"!==a.type||"]"!==a.value;)n=(t=Ze(e,n))[0],r=t[1],u.push(r),a=p(e[n]);return[n+=1,{type:"NormalExpression",name:"array",params:u}]}(e,n):"{"===t.value&&(r=function(e,n){for(var t,r,a=p(e[n+=1]),u=[];"paren"!==a.type||"}"!==a.value;)n=(t=Ze(e,n))[0],r=t[1],u.push(r),a=p(e[n]);n+=1;var i={type:"NormalExpression",name:"object",params:u};return N(i),[n,i]}(e,n));break;case"regexpShorthand":r=function(e,n){return[n+1,{type:"NormalExpression",name:"regexp",params:[{type:"String",value:p(e[n]).value}]}]}(e,n);break;case"fnShorthand":r=function(e,n){for(var t=He(e,n+=2),r=t[0],a=t[1],u=0,i=n+1;i<r-1;i+=1){var o=p(e[i]);if("name"===o.type){var f=Ye.exec(o.value);if(f&&(u=Math.max(u,Number(f[1])))>20)throw Error("Can't specify more than 20 arguments")}if("fnShorthand"===o.type)throw Error("Nested shortcut functions are not allowed")}for(var c=[],l=1;l<=u;l+=1)c.push("%"+l);return[r,{type:"SpecialExpression",name:"fn",params:[],arguments:{bindings:[],mandatoryArguments:c,optionalArguments:[]},body:[a]}]}(e,n)}if(!r)throw SyntaxError("Unrecognized token: "+t.type+" value="+t.value);return r};var Qe=/[%0-9a-zA-Z_^?=!$%<>.+*/-]/,en=/\s|,/,nn=function(e,n){if('"'!==e[n])return[0,void 0];for(var t="",r=1,a=e[n+r],u=!1;'"'!==a||u;){if(void 0===a)throw new SyntaxError("Unclosed string at position "+n);u?(u=!1,'"'===a||"\\"===a||(t+="\\"),t+=a):"\\"===a?u=!0:t+=a,a=e[n+(r+=1)]}return[r+1,{type:"string",value:t}]},tn=/\s|[)\]},]/,rn=/[0-9]/,an=/[0-7]/,un=/[0-9a-fA-F]/,on=/[0-1]/,fn=/[0-9.-]/;function cn(e,n,t,r){return n===t[r]?[1,{type:e,value:n}]:[0,void 0]}var ln=[function(e,n){if(";"===e[n]){for(var t=1;"\n"!==e[n+t]&&n+t<e.length;)t+=1;return"\n"===e[n+t]&&n+t<e.length&&(t+=1),[t,void 0]}return[0,void 0]},function(e,n){var t;return en.test(null!==(t=e[n])&&void 0!==t?t:"")?[1,void 0]:[0,void 0]},function(e,n){return cn("paren","(",e,n)},function(e,n){return cn("paren",")",e,n)},function(e,n){return cn("paren","[",e,n)},function(e,n){return cn("paren","]",e,n)},function(e,n){return cn("paren","{",e,n)},function(e,n){return cn("paren","}",e,n)},nn,function(e,n){var t="decimal",r=e[n];if(void 0===r)return[0,void 0];var a,u="."===r;if(!fn.test(r))return[0,void 0];for(a=n+1;a<e.length;a+=1){var i=p(e[a]);if(tn.test(i))break;if(a===n+1&&"0"===r){if("b"===i||"B"===i){t="binary";continue}if("o"===i||"O"===i){t="octal";continue}if("x"===i||"X"===i){t="hex";continue}}if("decimal"===t&&u){if(!rn.test(i))return[0,void 0]}else if("binary"===t){if(!on.test(i))return[0,void 0]}else if("octal"===t){if(!an.test(i))return[0,void 0]}else if("hex"===t){if(!un.test(i))return[0,void 0]}else{if("."===i){u=!0;continue}if(!rn.test(i))return[0,void 0]}}var o=a-n,f=e.substring(n,a);return"decimal"!==t&&o<=2||"."===f||"-"===f?[0,void 0]:[o,{type:"number",value:f}]},function(e,n){for(var t=0,r=Object.keys(Y);t<r.length;t++){var a=r[t],u=a.length,i=e[n+u];if((!i||!Qe.test(i))&&e.substr(n,u)===a)return[u,{type:"reservedName",value:a}]}return[0,void 0]},function(e,n){return function(e,n,t,r){var a=t[r],u=0,i="";if(!a||!n.test(a))return[0,void 0];for(;a&&n.test(a);)i+=a,a=t[r+(u+=1)];return[u,{type:e,value:i}]}("name",Qe,e,n)},function(e,n){return"&rest"===e.substr(n,5)?[5,{type:"modifier",value:"&rest"}]:"&opt"===e.substr(n,4)?[4,{type:"modifier",value:"&opt"}]:"&bind"===e.substr(n,5)?[5,{type:"modifier",value:"&bind"}]:[0,void 0]},function(e,n){if("#"!==e[n])return[0,void 0];var t=nn(e,n+1),r=t[0],a=t[1];return a?[r+1,{type:"regexpShorthand",value:a.value}]:[0,void 0]},function(e,n){return"#("!==e.slice(n,n+2)?[0,void 0]:[1,{type:"fnShorthand",value:"#"}]}];var vn=function(){function e(){this.importScope={}}return e.prototype.tokenize=function(e){return function(e){for(var n=[],t=0,r=!1;t<e.length;){r=!1;for(var a=0,u=ln;a<u.length;a++){var i=(0,u[a])(e,t),o=i[0],f=i[1];if(o>0&&(r=!0,t+=o,f)){n.push(f);break}}if(!r)throw new SyntaxError("Unrecognized character at position "+t+": '"+e[t]+"'")}return n}(e)},e.prototype.parse=function(e){return function(e){for(var n,t,r={type:"Program",body:[]},a=0;a<e.length;)a=(n=Ze(e,a))[0],t=n[1],r.body.push(t);return r}(e)},e.prototype.evaluate=function(e,n){void 0===n&&(n={});var t=n.globalContext||{};return n.vars&&Object.entries(n.vars).forEach((function(e){var n=e[0],r=e[1];t[n]={value:r}})),Be(e,t,this.importScope)},e.prototype.run=function(e,n){var t=this.tokenize(e),r=this.parse(t);return this.evaluate(r,n)},e.prototype.import=function(e){var n=this.tokenize(e),t={};Be(this.parse(n),t,{});for(var r=Object.keys(this.importScope),a=0,u=Object.keys(t);a<u.length;a++){var i=u[a];if(r.includes(i))throw Error('Import faild, imported function/variable already exists: "'+i+'"');W(i,[{},{}],Ve)}Object.assign(this.importScope,t)},e}();return e.Lispish=vn,e.isLispishFunction=M,e.normalExpressionKeys=qe,e.reservedNames=J,e.specialExpressionKeys=Ue,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
//# sourceMappingURL=lispish.iife.js.map
