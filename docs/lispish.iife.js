var Lispish=function(e){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var n=function(e,r){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])},n(e,r)};function r(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function t(){this.constructor=e}n(e,r),e.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t)}var t=function(){return t=Object.assign||function(e){for(var n,r=1,t=arguments.length;r<t;r++)for(var a in n=arguments[r])Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a]);return e},t.apply(this,arguments)};function a(e,n){for(var r=0,t=n.length,a=e.length;r<t;r++,a++)e[a]=n[r];return e}var u=function(e){function n(r){var t=e.call(this,"recur, params: "+r)||this;return Object.setPrototypeOf(t,n.prototype),t.name="RecurSignal",t.params=r,t}return r(n,e),n}(Error),i=function(e){function n(r){var t=e.call(this,r)||this;return Object.setPrototypeOf(t,n.prototype),t.name="UserDefinedError",t}return r(n,e),n}(Error),o=function(e){function n(r){var t=e.call(this,"Assertion error: "+r)||this;return Object.setPrototypeOf(t,n.prototype),t.name="AssertionError",t}return r(n,e),n}(Error),f=function(e){function n(r,t){var a=e.call(this,'Expected a "'+r+'" token, got Token['+t.type+':"'+t.value+'"]')||this;return Object.setPrototypeOf(a,n.prototype),a.name="UnexpectedTokenError",a}return r(n,e),n}(Error),c=function(e){function n(r,t){var a=e.call(this,"Expected a "+r+" node, got "+(t?"a "+t.type+" node":"undefined"))||this;return Object.setPrototypeOf(a,n.prototype),a.name="UnexpectedNodeTypeError",a}return r(n,e),n}(Error),l=Symbol("function");function v(e){if(void 0===e)throw Error("Expected an AST node, got undefined");return e}function s(e){if(void 0===e||"Name"!==e.type)throw new c("Name",e)}function p(e,n){if(void 0===n&&(n="Unexpected end of input"),void 0===e)throw Error(n);return e}function d(e,n){if(void 0===n&&(n="Unexpected end of input"),void 0===e)throw Error(n)}function m(e){if("number"!=typeof e||!isFinite(e))throw TypeError("Expected number, got: "+e+' type="'+typeof e+'"')}function h(e){!function(e){if(m(e),e<0)throw TypeError("Expected non negative number, got "+e)}(e),g(e)}function g(e){if(m(e),!Number.isInteger(e))throw TypeError("Expected integer, got "+e)}function y(e,n){if(m(e),e<n)throw TypeError("Expected parameter ("+e+") to be a number equal or grater than "+n)}function b(e){if("string"!=typeof e)throw TypeError("Expected string, got: "+e+' type="'+typeof e+'"')}function x(e){if(b(e),1!==e.length)throw TypeError("Expected char, got: "+e+' type="'+typeof e+'"')}function E(e){if("string"!=typeof e&&"number"!=typeof e)throw TypeError("Expected string or number, got: "+e+' type="'+typeof e+'"')}function w(e){if(!(e instanceof RegExp))throw TypeError("Expected RegExp, got: "+e+' type="'+typeof e+'"')}function A(e,n){var r=n.params.length;if("number"==typeof e){if(r!==e)throw Error('Wrong number of arguments to "'+n.name+'", expected '+e+", got "+r)}else{var t=e.min,a=e.max;if(void 0===t&&void 0===a)throw Error("Min or max must be specified");if("number"==typeof t&&r<t)throw Error('Wrong number of arguments to "'+n.name+'", expected at least '+t+", got "+r);if("number"==typeof a&&r>a)throw Error('Wrong number of arguments to "'+n.name+'", expected at most '+a+", got "+r)}}function N(e){var n=e.params.length;if(n%2!=0)throw Error("Wrong number of arguments, expected an even number, got "+n)}function j(e){return null!==e&&"object"==typeof e&&!!e[l]}function M(e){if(!j(e))throw Error("Expected lispish function, got "+JSON.stringify(e))}function O(e){if(!Array.isArray(e)||e.some((function(e){return"string"!=typeof e||1!==e.length})))throw Error("Expected an array of chars, got "+e)}function k(e){if(!q(e))throw TypeError("Expected a number, got: "+e+' type="'+typeof e+'"')}function S(e){if(!P(e))throw TypeError("Expected Arr, got: "+e+' type="'+typeof e+'"')}function T(e){if(!V(e))throw TypeError("Expected collection, got: "+e+' type="'+typeof e+'"')}function I(e){if(!_(e))throw TypeError("Expected string or array, got: "+e+' type="'+typeof e+'"')}function F(e){if(!R(e))throw TypeError("Expected object, got: "+e+' type="'+typeof e+'"')}function R(e){return!(null===e||"object"!=typeof e||Array.isArray(e)||e instanceof RegExp||j(e))}function P(e){return Array.isArray(e)}function _(e){return Array.isArray(e)||C(e)}function V(e){return _(e)||R(e)}function C(e){return"string"==typeof e}function q(e){return"number"==typeof e}function U(e){return Number.isInteger(e)}var B={boolean:0,number:1,string:2,array:3,object:4,regexp:5,unknown:6,null:7,undefined:8};function D(e){return void 0===e?"undefined":null===e?"null":"boolean"==typeof e?"boolean":"number"==typeof e?"number":"string"==typeof e?"string":P(e)?"array":R(e)?"object":function(e){return e instanceof RegExp}(e)?"regexp":"unknown"}function L(e,n){var r=D(e),t=D(n);if(r!==t)return Math.sign(B[r]-B[t]);switch(r){case"undefined":case"null":case"unknown":return 0;case"boolean":return e===n?0:!1===e?-1:1;case"number":return Math.sign(e-n);case"string":return(l=e)<(v=n)?-1:l>v?1:0;case"array":var a=e,u=n;if(a.length<u.length)return-1;if(a.length>u.length)return 1;for(var i=0;i<a.length;i+=1){var o=L(a[i],u[i]);if(0!==o)return o}return 0;case"object":var f=e,c=n;return Math.sign(Object.keys(f).length-Object.keys(c).length);case"regexp":var l,v;return(l=e.source)<(v=n.source)?-1:l>v?1:0}}function $(e,n){if(e===n)return!0;if("number"==typeof e&&"number"==typeof n)return Math.abs(e-n)<Number.EPSILON;if(P(e)&&P(n)){if(e.length!==n.length)return!1;for(var r=0;r<e.length;r+=1)if(!$(e[r],n[r]))return!1;return!0}if(e instanceof RegExp&&n instanceof RegExp)return e.toString()===n.toString();if("object"==typeof e&&null!==e&&"object"==typeof n&&null!==n){var t=e,a=n,u=Object.keys(t),i=Object.keys(a);if(u.length!==i.length)return!1;for(r=0;r<u.length;r+=1){var o=p(u[r]);if(!$(t[o],a[o]))return!1}return!0}return!1}var G={parse:function(e,n,r){var t;return t=function(e,n,r){for(var t,a,u=[],i=p(e[n]);"paren"!==i.type||")"!==i.value;){var o,f;n=(t=r(e,n))[0],o=t[1],n=(a=r(e,n))[0],f=a[1],u.push({test:o,form:f}),i=p(e[n])}return[n,u]}(e,n,r.parseToken),[(n=t[0])+1,{type:"SpecialExpression",name:"cond",conditions:t[1],params:[]}]},evaluate:function(e,n,r){for(var t=r.evaluateAstNode,a=0,u=e.conditions;a<u.length;a++){var i=u[a];if(t(i.test,n))return t(i.form,n)}}},z={true:{value:!0},false:{value:!1},null:{value:null},undefined:{value:void 0}},Y=Object.keys(z);function J(e,n,r){if("string"==typeof e){if(r.specialExpressions[e])throw Error("Cannot define variable "+e+", it's a special expression");if(r.normalExpressions[e])throw Error("Cannot define variable "+e+", it's a builtin function");if(z[e])throw Error("Cannot define variable "+e+", it's a reserved name");if(p(n[n.length-2])[e])throw Error('Name already defined "'+e+'"')}}function W(e){return function(n,r,t){var a,u=t.parseToken,i=t.parseArgument,o=t.parseBindings,l=void 0;if(("defn"===e||"defns"===e)&&(r=(a=u(n,r))[0],l=a[1],"defn"===e&&"Name"!==l.type))throw new c("Name",l);for(var v=function(e,n,r,t){var a,u=[],i=void 0,o=[],c=[],l={},v="mandatory",s=p(e[n]);if("paren"!==s.type||"["!==s.value)throw new f("[",s);for(s=p(e[n+=1]);"paren"!==s.type||"]"!==s.value;){if("bind"===v){n=(a=t(e,n))[0],u=a[1];break}var d=r(e,n),m=d[0],h=d[1];if(s=p(e[n=m]),"Modifier"===h.type)switch(h.value){case"&opt":if("rest"===v)throw Error("&opt cannot appear after &rest");if("optional"===v)throw Error("&opt can only appear once");v="optional";break;case"&rest":if("rest"===v)throw Error("&rest can only appear once");if("optional"===v&&0===c.length)throw Error("No optional arguments where spcified");v="rest";break;case"&bind":if("optional"===v&&0===c.length)throw Error("No optional arguments where spcified");if("rest"===v&&!i)throw Error("No rest argument was spcified");v="bind"}else{if(l[h.name])throw Error('Duplicate argument "'+h.name+'"');if(l[h.name]=!0,Object.getOwnPropertyDescriptor(h,"defaultValue")){if("optional"!==v)throw Error("Cannot specify default value if not an optional argument");c.push({name:h.name,defaultValue:h.defaultValue})}else switch(v){case"mandatory":o.push(h.name);break;case"optional":c.push({name:h.name,defaultValue:void 0});break;case"rest":if(void 0!==i)throw Error("Can only specify one rest argument");i=h.name}}}if("rest"===v&&void 0===i)throw Error("Missing rest argument name");if("optional"===v&&0===c.length)throw Error("No optional arguments where spcified");return[n+=1,{mandatoryArguments:o,optionalArguments:c,restArgument:i,bindings:u}]}(n,r,i,o),s=v[0],d=v[1],m=p(n[r=s]),h=[];"paren"!==m.type||")"!==m.value;){var g=u(n,r),y=g[0],b=g[1];h.push(b),m=p(n[r=y])}if(0===h.length)throw Error('Missing body in special expression "defn"');return r+=1,"defn"===e||"defns"===e?[r,{type:"SpecialExpression",name:e,functionName:l,params:[],arguments:d,body:h}]:[r,{type:"SpecialExpression",name:e,params:[],arguments:d,body:h}]}}function X(e){return function(n,r,t){var a,u=t.evaluateAstNode,i=t.builtin,o=function(e,n,r,t){if("defn"===e){var a=n.functionName.value;return b(a),a}if("defns"===e){var u=t(n.functionName,r);return b(u),u}}(e,n,r,u);J(o,r,i);for(var f={},c=0,v=n.arguments.bindings;c<v.length;c++){var s=v[c],d=s.value,m=u(d,r);f[s.name]={value:m}}var h=n.arguments.optionalArguments.map((function(e){var n=e.name,t=e.defaultValue;return t?{name:n,defaultValue:u(t,r)}:{name:n}})),g=((a={})[l]=!0,a.type="user-defined",a.name=o,a.arguments={mandatoryArguments:n.arguments.mandatoryArguments,restArgument:n.arguments.restArgument,optionalArguments:h},a.body=n.body,a.functionContext=f,a);if("fn"===e)return g;p(r[r.length-2],"Could not find global scope")[o]={value:g}}}var H={parse:W("defn"),evaluate:X("defn")},K={parse:W("defns"),evaluate:X("defns")},Z={parse:W("fn"),evaluate:X("fn")},Q={parse:function(e,n,r){var t=(0,r.parseTokens)(e,n);return[t[0]+1,{type:"SpecialExpression",name:"if",params:t[1]}]},evaluate:function(e,n,r){var t=r.evaluateAstNode,a=e.params,u=a[0],i=a[1],o=a[2];return t(v(u),n)?t(v(i),n):3===e.params.length?t(v(o),n):void 0},validate:function(e){return A({min:2,max:3},e)}},ee={parse:function(e,n,r){var t=(0,r.parseTokens)(e,n);return[t[0]+1,{type:"SpecialExpression",name:"if-not",params:t[1]}]},evaluate:function(e,n,r){var t=r.evaluateAstNode,a=e.params,u=a[0],i=a[1],o=a[2];return t(v(u),n)?3===e.params.length?t(v(o),n):void 0:t(v(i),n)},validate:function(e){return A({min:2,max:3},e)}},ne={parse:function(e,n,r){var t,a,u,i,o=r.parseBindings,f=r.parseTokens;if(n=(t=o(e,n))[0],1!==(u=t[1]).length)throw Error("Expected exactly one binding, got "+u.length);return n=(a=f(e,n))[0],i=a[1],[n+1,{type:"SpecialExpression",name:"if-let",binding:p(u[0]),params:i}]},evaluate:function(e,n,r){var t=r.evaluateAstNode,u={},i=t(e.binding.value,n);if(i){u[e.binding.name]={value:i};var o=a([u],n);return t(p(e.params[0]),o)}if(2===e.params.length)return t(p(e.params[1]),n)},validate:function(e){return A({min:1,max:2},e)}},re={parse:function(e,n,r){var t,a,u,i,o=r.parseBindings,f=r.parseTokens;if(n=(t=o(e,n))[0],1!==(u=t[1]).length)throw Error("Expected exactly one binding, got "+u.length);return n=(a=f(e,n))[0],i=a[1],[n+1,{type:"SpecialExpression",name:"when-let",binding:p(u[0]),params:i}]},evaluate:function(e,n,r){var t=r.evaluateAstNode,u={},i=t(e.binding.value,n);if(i){u[e.binding.name]={value:i};for(var o=a([u],n),f=void 0,c=0,l=e.params;c<l.length;c++){f=t(l[c],o)}return f}},validate:function(e){return A({min:0},e)}},te={parse:function(e,n,r){var t=(0,r.parseTokens)(e,n);return[t[0]+1,{type:"SpecialExpression",name:"when-not",params:t[1]}]},evaluate:function(e,n,r){var t=r.evaluateAstNode,a=e.params,u=a[0],i=a.slice(1);if(d(u),!t(u,n)){for(var o=void 0,f=0,c=i;f<c.length;f++){o=t(c[f],n)}return o}},validate:function(e){return A({min:1},e)}},ae={parse:function(e,n,r){var t,a,u,i,o=r.parseBindings,f=r.parseTokens;if(n=(t=o(e,n))[0],1!==(u=t[1]).length)throw Error("Expected exactly one binding, got "+u.length);return n=(a=f(e,n))[0],i=a[1],[n+1,{type:"SpecialExpression",name:"when-first",binding:p(u[0]),params:i}]},evaluate:function(e,n,r){var t=r.evaluateAstNode,u={},i=t(e.binding.value,n);if(!_(i))throw Error("Expected undefined or a sequence, got "+i);if(0!==i.length){var o=i[0];u[e.binding.name]={value:o};for(var f=a([u],n),c=void 0,l=0,v=e.params;l<v.length;l++){c=t(v[l],f)}return c}},validate:function(e){return A({min:0},e)}},ue={parse:function(e,n,r){var t,a,u,i=r.parseBindings,o=r.parseTokens;return n=(t=i(e,n))[0],u=t[1],[(n=(a=o(e,n))[0])+1,{type:"SpecialExpression",name:"let",params:a[1],bindings:u}]},evaluate:function(e,n,r){for(var t=r.evaluateAstNode,u={},i=0,o=e.bindings;i<o.length;i++){var f=o[i],c=t(f.value,n);u[f.name]={value:c}}for(var l,v=a([u],n),s=0,p=e.params;s<p.length;s++){l=t(p[s],v)}return l}},ie={parse:function(e,n,r){for(var t=r.parseToken,a={type:"SpecialExpression",name:"do",params:[]},u=p(e[n]);"paren"!==u.type||")"!==u.value;){var i=t(e,n),o=i[0],f=i[1];a.params.push(f),u=p(e[n=o])}return[n+1,a]},evaluate:function(e,n,r){for(var t,u=r.evaluateAstNode,i=a([{}],n),o=0,f=e.params;o<f.length;o++){t=u(f[o],i)}return t}},oe={parse:function(e,n,r){var t=(0,r.parseTokens)(e,n),a=t[0],u=t[1];return s(u[0]),[a+1,{type:"SpecialExpression",name:"def",params:u}]},evaluate:function(e,n,r){var t=r.evaluateAstNode,a=r.builtin,u=function(e){if(void 0===e||"Name"!==e.type)throw new c("Name",e);return e}(e.params[0]).value;J(u,n,a);var i=t(v(e.params[1]),n);return p(n[n.length-2])[u]={value:i},i},validate:function(e){return A(2,e)}},fe={parse:function(e,n,r){var t=(0,r.parseTokens)(e,n);return[t[0]+1,{type:"SpecialExpression",name:"defs",params:t[1]}]},evaluate:function(e,n,r){var t=r.evaluateAstNode,a=r.builtin,u=t(v(e.params[0]),n);b(u),J(u,n,a);var i=t(v(e.params[1]),n);return p(n[n.length-2])[u]={value:i},i},validate:function(e){return A(2,e)}},ce={parse:function(e,n,r){var t=(0,r.parseToken)(e,n),a=t[0],u=t[1],i=p(e[n=a]);if("paren"!==i.type||")"!==i.value)throw new f(")",i);return[n+=1,{type:"SpecialExpression",name:"throw",params:[],messageNode:u}]},evaluate:function(e,n,r){var t=function(e){if("string"!=typeof e||0===e.length)throw TypeError("Expected non empty string, got: "+e+' type="'+typeof e+'"');return e}((0,r.evaluateAstNode)(e.messageNode,n));throw new i(t)}},le={parse:function(e,n,r){var t,a,u,i,o=r.parseToken;n=(t=o(e,n))[0],i=t[1];var l,v,s=p(e[n]);if("paren"!==s.type||"("!==s.value)throw new f("(",s);if("paren"!==(s=p(e[n+=1])).type||"("!==s.value)throw new f("(",s);if(n=(a=o(e,n+=1))[0],"Name"!==(l=a[1]).type)throw new c("Name",l);if("paren"!==(s=p(e[n])).type||")"!==s.value)throw new f(")",s);if(n=(u=o(e,n+=1))[0],v=u[1],"paren"!==(s=p(e[n])).type||")"!==s.value)throw new f(")",s);if("paren"!==(s=p(e[n+=1])).type||")"!==s.value)throw new f(")",s);return[n+=1,{type:"SpecialExpression",name:"try",params:[],tryExpression:i,catchExpression:v,error:l}]},evaluate:function(e,n,r){var t,u=r.evaluateAstNode;try{return u(e.tryExpression,n)}catch(r){var i=((t={})[e.error.value]={value:r},t);return u(e.catchExpression,a([i],n))}}},ve={parse:function(e,n,r){var t=(0,r.parseTokens)(e,n);return[t[0]+1,{type:"SpecialExpression",name:"when",params:t[1]}]},evaluate:function(e,n,r){var t=r.evaluateAstNode,a=e.params,u=a[0],i=a.slice(1);if(d(u),t(u,n)){for(var o=void 0,f=0,c=i;f<c.length;f++){o=t(c[f],n)}return o}},validate:function(e){return A({min:1},e)}},se={parse:function(e,n,r){var t;return[(n=(t=(0,r.parseTokens)(e,n))[0])+1,{type:"SpecialExpression",name:"recur",params:t[1]}]},evaluate:function(e,n,r){var t=r.evaluateAstNode,a=e.params.map((function(e){return t(e,n)}));throw new u(a)}},pe={parse:function(e,n,r){var t,a,u,i=r.parseTokens;return n=(t=(0,r.parseBindings)(e,n))[0],u=t[1],[(n=(a=i(e,n))[0])+1,{type:"SpecialExpression",name:"loop",params:a[1],bindings:u}]},evaluate:function(e,n,r){for(var t=r.evaluateAstNode,i=e.bindings.reduce((function(e,r){return e[r.name]={value:t(r.value,n)},e}),{}),o=a([i],n),f=function(){var n=void 0;try{for(var r=0,a=e.params;r<a.length;r++){var f=a[r];n=t(f,o)}}catch(n){if(n instanceof u){var c=n.params;if(c.length!==e.bindings.length)throw Error("recur expected "+e.bindings.length+" parameters, got "+c.length);return e.bindings.forEach((function(e,n){p(i[e.name]).value=c[n]})),"continue"}throw n}return{value:n}};;){var c=f();if("object"==typeof c)return c.value}}},de={parse:function(e,n,r){var t=(0,r.parseToken)(e,n);return[t[0]+1,{type:"SpecialExpression",name:"time!",params:[t[1]]}]},evaluate:function(e,n,r){var t=r.evaluateAstNode,a=e.params[0];d(a);var u=Date.now(),i=t(a,n),o=Date.now()-u;return console.log("Elapsed time: "+o+" ms"),i},validate:function(e){return A(1,e)}},me={get:{evaluate:function(e){var n=e[0],r=e[1],t=e[2],a=3===e.length;if(T(n),P(n)){if(g(r),r<n.length)return n[r]}else{if(!R(n))return g(r),n[r];if(b(r),Object.getOwnPropertyDescriptor(n,r))return n[r]}if(a)return t},validate:function(e){return A({min:2,max:3},e)}},count:{evaluate:function(e){var n=e[0];return"string"==typeof n?n.length:(T(n),Array.isArray(n)?n.length:Object.keys(n).length)},validate:function(e){return A(1,e)}},"contains?":{evaluate:function(e){var n=e[0],r=e[1];return T(n),E(r),_(n)?!!Number.isInteger(r)&&(g(r),r>=0&&r<n.length):!!Object.getOwnPropertyDescriptor(n,r)},validate:function(e){return A(2,e)}},"has?":{evaluate:function(e){var n=e[0],r=e[1];return T(n),P(n)?n.includes(r):C(n)?!!C(r)&&n.split("").includes(r):Object.values(n).includes(r)},validate:function(e){return A(2,e)}},assoc:{evaluate:function(e){var n=e[0],r=e[1],u=e[2];if(T(n),E(r),Array.isArray(n)||"string"==typeof n){if(g(r),y(r,0),function(e,n){if(m(e),e>n)throw TypeError("Expected parameter ("+e+") to be a number equal or less than "+n)}(r,n.length),"string"==typeof n)return x(u),""+n.slice(0,r)+u+n.slice(r+1);var i=a([],n);return i[r]=u,i}b(r);var o=t({},n);return o[r]=u,o},validate:function(e){return A(3,e)}},concat:{evaluate:function(e){return T(e[0]),P(e[0])?e.reduce((function(e,n){return S(n),e.concat(n)}),[]):C(e[0])?e.reduce((function(e,n){return b(n),""+e+n}),""):e.reduce((function(e,n){return F(n),Object.assign(e,n)}),{})},validate:function(e){return A({min:1},e)}},"empty?":{evaluate:function(e){var n=e[0];return T(n),C(n)||Array.isArray(n)?0===n.length:0===Object.keys(n).length},validate:function(e){return A(1,e)}},"every?":{evaluate:function(e,n,r){var t=e[0],a=e[1],u=r.executeFunction;return M(t),T(a),Array.isArray(a)?a.every((function(e){return u(t,[e],n)})):C(a)?a.split("").every((function(e){return u(t,[e],n)})):Object.entries(a).every((function(e){return u(t,[e],n)}))},validate:function(e){return A(2,e)}},"any?":{evaluate:function(e,n,r){var t=e[0],a=e[1],u=r.executeFunction;return M(t),T(a),Array.isArray(a)?a.some((function(e){return u(t,[e],n)})):C(a)?a.split("").some((function(e){return u(t,[e],n)})):Object.entries(a).some((function(e){return u(t,[e],n)}))},validate:function(e){return A(2,e)}},"not-any?":{evaluate:function(e,n,r){var t=e[0],a=e[1],u=r.executeFunction;return M(t),T(a),Array.isArray(a)?!a.some((function(e){return u(t,[e],n)})):C(a)?!a.split("").some((function(e){return u(t,[e],n)})):!Object.entries(a).some((function(e){return u(t,[e],n)}))},validate:function(e){return A(2,e)}},"not-every?":{evaluate:function(e,n,r){var t=e[0],a=e[1],u=r.executeFunction;return M(t),T(a),Array.isArray(a)?!a.every((function(e){return u(t,[e],n)})):C(a)?!a.split("").every((function(e){return u(t,[e],n)})):!Object.entries(a).every((function(e){return u(t,[e],n)}))},validate:function(e){return A(2,e)}}},he=function(e,n,r){var t=r.executeFunction,a=e[0],u=e[1];M(a),I(u);var i=C(u),o=u.length;if(2===e.length)return P(u)?u.map((function(e){return t(a,[e],n)})):u.split("").map((function(e){var r=t(a,[e],n);return x(r),r})).join("");if(e.slice(2).forEach((function(e){if(i?b(e):S(e),o!==e.length)throw Error('All arguments to "map" must have the same length')})),i){for(var f="",c=function(r){var u=e.slice(1).map((function(e){return e[r]})),i=t(a,u,n);x(i),f+=i},l=0;l<o;l+=1)c(l);return f}f=[];var v=function(r){var u=e.slice(1).map((function(e){return e[r]}));f.push(t(a,u,n))};for(l=0;l<o;l+=1)v(l);return f},ge={cons:{evaluate:function(e){var n=e[0],r=e[1];return I(r),Array.isArray(r)?a([n],r):(x(n),""+n+r)},validate:function(e){return A(2,e)}},nth:{evaluate:function(e){var n=e[0],r=e[1];return I(n),g(r),n[r]},validate:function(e){return A(2,e)}},filter:{evaluate:function(e,n,r){var t=e[0],a=e[1],u=r.executeFunction;return M(t),I(a),Array.isArray(a)?a.filter((function(e){return u(t,[e],n)})):a.split("").filter((function(e){return u(t,[e],n)})).join("")},validate:function(e){return A(2,e)}},first:{evaluate:function(e){var n=e[0];return I(n),n[0]},validate:function(e){return A(1,e)}},last:{evaluate:function(e){var n=e[0];return I(n),n[n.length-1]},validate:function(e){return A(1,e)}},map:{evaluate:he,validate:function(e){return A({min:2},e)}},pop:{evaluate:function(e){var n=e[0];if(I(n),C(n))return n.substr(0,n.length-1);var r=a([],n);return r.pop(),r},validate:function(e){return A(1,e)}},position:{evaluate:function(e,n,r){var t,a=e[0],u=e[1],i=r.executeFunction;return M(a),I(u),C(u)?-1!==(t=u.split("").findIndex((function(e){return i(a,[e],n)})))?t:void 0:-1!==(t=u.findIndex((function(e){return i(a,[e],n)})))?t:void 0},validate:function(e){return A(2,e)}},"index-of":{evaluate:function(e){var n,r=e[0],t=e[1];return I(r),C(r)?(b(t),-1!==(n=r.indexOf(t))?n:void 0):-1!==(n=r.indexOf(t))?n:void 0},validate:function(e){return A(2,e)}},push:{evaluate:function(e){var n=e[0],r=e.slice(1);return I(n),C(n)?(O(r),a([n],r).join("")):a(a([],n),r)},validate:function(e){return A({min:2},e)}},reduce:{evaluate:function(e,n,r){var t=r.executeFunction,a=e[0];if(M(a),2===e.length){var u=e[1];if(I(u),0===u.length)return t(a,[],n);if(1===u.length)return u[0];if(C(u)){var i=u.split("");return i.slice(1).reduce((function(e,r){return t(a,[e,r],n)}),i[0])}return u.slice(1).reduce((function(e,r){return t(a,[e,r],n)}),u[0])}var o=e[1],f=e[2];return I(f),C(f)?(b(o),0===f.length?o:f.split("").reduce((function(e,r){return t(a,[e,r],n)}),o)):0===f.length?o:f.reduce((function(e,r){return t(a,[e,r],n)}),o)},validate:function(e){return A({min:2,max:3},e)}},"reduce-right":{evaluate:function(e,n,r){var t=r.executeFunction,a=e[0];if(M(a),2===e.length){if(I(i=e[1]),0===i.length)return t(a,[],n);if(1===i.length)return i[0];if(C(i)){var u=i.split("");return u.slice(0,u.length-1).reduceRight((function(e,r){return t(a,[e,r],n)}),u[u.length-1])}return i.slice(0,i.length-1).reduceRight((function(e,r){return t(a,[e,r],n)}),i[i.length-1])}var i,o=e[1];return I(i=e[2]),C(i)?0===i.length?o:i.split("").reduceRight((function(e,r){return t(a,[e,r],n)}),o):0===i.length?o:i.reduceRight((function(e,r){return t(a,[e,r],n)}),o)},validate:function(e){return A({min:2,max:3},e)}},rest:{evaluate:function(e){var n=e[0];return I(n),Array.isArray(n)?n.length<=1?[]:n.slice(1):n.substr(1)},validate:function(e){return A(1,e)}},nthrest:{evaluate:function(e){var n=e[0],r=e[1];I(n),m(r);var t=Math.max(Math.ceil(r),0);return Array.isArray(n)?n.slice(t):n.substr(t)},validate:function(e){return A(2,e)}},next:{evaluate:function(e){var n=e[0];if(I(n),Array.isArray(n)){if(n.length<=1)return;return n.slice(1)}if(!(n.length<=1))return n.substr(1)},validate:function(e){return A(1,e)}},nthnext:{evaluate:function(e){var n=e[0],r=e[1];I(n),m(r);var t=Math.max(Math.ceil(r),0);if(!(n.length<=r))return Array.isArray(n)?n.slice(t):n.substr(t)},validate:function(e){return A(2,e)}},reverse:{evaluate:function(e){var n=e[0];return I(n),Array.isArray(n)?a([],n).reverse():n.split("").reverse().join("")},validate:function(e){return A(1,e)}},second:{evaluate:function(e){var n=e[0];return I(n),n[1]},validate:function(e){return A(1,e)}},shift:{evaluate:function(e){var n=e[0];if(I(n),C(n))return n.substr(1);var r=a([],n);return r.shift(),r},validate:function(e){return A(1,e)}},slice:{evaluate:function(e){var n=e[0],r=e[1],t=e[2];return I(n),1===e.length?n:(g(r),2===e.length?n.slice(r):(g(t),n.slice(r,t)))},validate:function(e){return A({min:1,max:3},e)}},some:{evaluate:function(e,n,r){var t=e[0],a=e[1],u=r.executeFunction;if(M(t),I(a),0!==a.length)return C(a)?a.split("").find((function(e){return u(t,[e],n)})):a.find((function(e){return u(t,[e],n)}))},validate:function(e){return A(2,e)}},sort:{evaluate:function(e,n,r){var t=r.executeFunction,u=1===e.length,i=u?e[0]:e[1],o=u?null:e[0];if(I(i),C(i)){var f=i.split("");return u?f.sort(L):(M(o),f.sort((function(e,r){var a=t(o,[e,r],n);return m(a),a}))),f.join("")}var c=a([],i);return u?c.sort(L):c.sort((function(e,r){M(o);var a=t(o,[e,r],n);return m(a),a})),c},validate:function(e){return A({min:1,max:2},e)}},take:{evaluate:function(e){var n=e[0],r=e[1];k(n),I(r);var t=Math.max(Math.ceil(n),0);return r.slice(0,t)},validate:function(e){return A(2,e)}},"take-last":{evaluate:function(e){var n=e[0],r=e[1];I(r),k(n);var t=Math.max(Math.ceil(n),0),a=r.length-t;return r.slice(a)},validate:function(e){return A(2,e)}},"take-while":{evaluate:function(e,n,r){var t=e[0],a=e[1],u=r.executeFunction;I(a),M(t);for(var i=[],o=0,f=a;o<f.length;o++){var c=f[o];if(!u(t,[c],n))break;i.push(c)}return C(a)?i.join(""):i},validate:function(e){return A(2,e)}},drop:{evaluate:function(e){var n=e[0],r=e[1];k(n);var t=Math.max(Math.ceil(n),0);return I(r),r.slice(t)},validate:function(e){return A(2,e)}},"drop-last":{evaluate:function(e){var n=e[0],r=e[1];I(r),k(n);var t=Math.max(Math.ceil(n),0),a=r.length-t;return r.slice(0,a)},validate:function(e){return A(2,e)}},"drop-while":{evaluate:function(e,n,r){var t=e[0],a=e[1],u=r.executeFunction;if(I(a),M(t),Array.isArray(a)){var i=a.findIndex((function(e){return!u(t,[e],n)}));return a.slice(i)}var o=a.split(""),f=o.findIndex((function(e){return!u(t,[e],n)}));return o.slice(f).join("")},validate:function(e){return A(2,e)}},unshift:{evaluate:function(e){var n=e[0],r=e.slice(1);if(I(n),C(n))return O(r),a(a([],r),[n]).join("");var t=a([],n);return t.unshift.apply(t,r),t},validate:function(e){return A({min:2},e)}},"random-sample":{evaluate:function(e){var n=e[0],r=e[1];return m(n),I(r),C(r)?r.split("").filter((function(){return Math.random()<n})).join(""):r.filter((function(){return Math.random()<n}))},validate:function(e){return A(2,e)}},"rand-nth":{evaluate:function(e){var n=e[0];if(I(n),0!==n.length){var r=Math.floor(Math.random()*n.length);return C(n)?n.split("")[r]:n[r]}},validate:function(e){return A(1,e)}},shuffle:{evaluate:function(e){var n=e[0];I(n);for(var r,t,u=C(n)?a([],n.split("")):a([],n),i=u.length;i;)i-=1,t=Math.floor(Math.random()*i),r=u[i],u[i]=u[t],u[t]=r;return C(n)?u.join(""):u},validate:function(e){return A(1,e)}},distinct:{evaluate:function(e){var n=e[0];return I(n),Array.isArray(n)?Array.from(new Set(n)):Array.from(new Set(n.split(""))).join("")},validate:function(e){return A(1,e)}},remove:{evaluate:function(e,n,r){var t=e[0],a=e[1],u=r.executeFunction;return M(t),I(a),Array.isArray(a)?a.filter((function(e){return!u(t,[e],n)})):a.split("").filter((function(e){return!u(t,[e],n)})).join("")},validate:function(e){return A(2,e)}},"split-at":{evaluate:function(e){var n=e[0],r=e[1];m(n);var t=Math.max(0,Math.ceil(n));return I(r),[r.slice(0,t),r.slice(t)]},validate:function(e){return A(2,e)}},"split-with":{evaluate:function(e,n,r){var t=e[0],a=e[1],u=r.executeFunction;M(t),I(a);var i=Array.isArray(a),o=(i?a:a.split("")).findIndex((function(e){return!u(t,[e],n)}));return-1===o?[a,i?[]:""]:[a.slice(0,o),a.slice(o)]},validate:function(e){return A(2,e)}}},ye={array:{evaluate:function(e){return e}},range:{evaluate:function(e){var n,r,t,a=e[0],u=e[1],i=e[2];m(a),1===e.length?(n=0,t=(r=a)>=0?1:-1):2===e.length?(m(u),t=(r=u)>=(n=a)?1:-1):(m(u),m(i),t=i,(r=u)>(n=a)?function(e){if(m(e),e<=0)throw TypeError("Expected positive number, got "+e)}(t):r<n?function(e){if(m(e),e>=0)throw TypeError("Expected negative number, got "+e)}(t):function(e){if(m(e),0===e)throw TypeError("Expected non zero value")}(t));for(var o=[],f=n;t<0?f>r:f<r;f+=t)o.push(f);return o},validate:function(e){return A({min:1,max:3},e)}},repeat:{evaluate:function(e){var n=e[0],r=e[1];h(n);for(var t=[],a=0;a<n;a+=1)t.push(r);return t},validate:function(e){return A(2,e)}},flatten:{evaluate:function(e){var n=e[0];return P(n)?n.flat(Number.POSITIVE_INFINITY):[]},validate:function(e){return A(1,e)}},mapcat:{evaluate:function(e,n,r){e.slice(1).forEach((function(e){S(e)}));var t=he(e,n,r);return S(t),t.flat(1)},validate:function(e){return A({min:2},e)}}},be={inc:{evaluate:function(e){var n=e[0];return k(n),n+1},validate:function(e){return A(1,e)}},dec:{evaluate:function(e){var n=e[0];return k(n),n-1},validate:function(e){return A(1,e)}},"+":{evaluate:function(e){return e.reduce((function(e,n){return k(n),e+n}),0)}},"*":{evaluate:function(e){return e.reduce((function(e,n){return k(n),e*n}),1)}},"/":{evaluate:function(e){if(0===e.length)return 1;var n=e[0],r=e.slice(1);return k(n),0===r.length?(k(n),1/n):r.reduce((function(e,n){return k(n),e/n}),n)}},"-":{evaluate:function(e){var n=e[0],r=e.slice(1);return n?(k(n),0===r.length?-n:r.reduce((function(e,n){return k(n),e-n}),n)):0}},quot:{evaluate:function(e){var n=e[0],r=e[1];return k(n),k(r),Math.trunc(n/r)},validate:function(e){return A(2,e)}},mod:{evaluate:function(e){var n=e[0],r=e[1];return k(n),k(r),n-r*Math.floor(n/r)},validate:function(e){return A(2,e)}},rem:{evaluate:function(e){var n=e[0],r=e[1];return k(n),k(r),n-r*Math.trunc(n/r)},validate:function(e){return A(2,e)}},sqrt:{evaluate:function(e){var n=e[0];return k(n),Math.sqrt(n)},validate:function(e){return A(1,e)}},cbrt:{evaluate:function(e){var n=e[0];return k(n),Math.cbrt(n)},validate:function(e){return A(1,e)}},pow:{evaluate:function(e){var n=e[0],r=e[1];return k(n),k(r),Math.pow(n,r)},validate:function(e){return A(2,e)}},round:{evaluate:function(e){var n=e[0],r=e[1];if(k(n),1===e.length||0===r)return Math.round(n);h(r);var t=Math.pow(10,r);return Math.round(n*t)/t},validate:function(e){return A({min:1,max:2},e)}},trunc:{evaluate:function(e){var n=e[0];return k(n),Math.trunc(n)},validate:function(e){return A(1,e)}},floor:{evaluate:function(e){var n=e[0];return k(n),Math.floor(n)},validate:function(e){return A(1,e)}},ceil:{evaluate:function(e){var n=e[0];return k(n),Math.ceil(n)},validate:function(e){return A(1,e)}},rand:{evaluate:function(e){var n=1===e.length?e[0]:1;return k(n),Math.random()*n},validate:function(e){return A({min:0,max:1},e)}},"rand-int":{evaluate:function(e){var n=e[0];return k(n),Math.floor(Math.random()*Math.abs(n))*Math.sign(n)},validate:function(e){return A(1,e)}},min:{evaluate:function(e){var n=e[0],r=e.slice(1);return k(n),0===r.length?n:r.reduce((function(e,n){return k(n),Math.min(e,n)}),n)},validate:function(e){return A({min:1},e)}},max:{evaluate:function(e){var n=e[0],r=e.slice(1);return k(n),0===r.length?n:r.reduce((function(e,n){return k(n),Math.max(e,n)}),n)},validate:function(e){return A({min:1},e)}},abs:{evaluate:function(e){var n=e[0];return k(n),Math.abs(n)},validate:function(e){return A(1,e)}},sign:{evaluate:function(e){var n=e[0];return k(n),Math.sign(n)},validate:function(e){return A(1,e)}},"max-safe-integer":{evaluate:function(){return Number.MAX_SAFE_INTEGER},validate:function(e){return A(0,e)}},"min-safe-integer":{evaluate:function(){return Number.MIN_SAFE_INTEGER},validate:function(e){return A(0,e)}},"max-value":{evaluate:function(){return Number.MAX_VALUE},validate:function(e){return A(0,e)}},"min-value":{evaluate:function(){return Number.MIN_VALUE},validate:function(e){return A(0,e)}},epsilon:{evaluate:function(){return Number.EPSILON},validate:function(e){return A(0,e)}},infinity:{evaluate:function(){return Number.POSITIVE_INFINITY},validate:function(e){return A(0,e)}},"-infinity":{evaluate:function(){return Number.NEGATIVE_INFINITY},validate:function(e){return A(0,e)}},nan:{evaluate:function(){return Number.NaN},validate:function(e){return A(0,e)}},e:{evaluate:function(){return Math.E},validate:function(e){return A(0,e)}},pi:{evaluate:function(){return Math.PI},validate:function(e){return A(0,e)}},exp:{evaluate:function(e){var n=e[0];return k(n),Math.exp(n)},validate:function(e){return A(1,e)}},log:{evaluate:function(e){var n=e[0];return k(n),Math.log(n)},validate:function(e){return A(1,e)}},log2:{evaluate:function(e){var n=e[0];return k(n),Math.log2(n)},validate:function(e){return A(1,e)}},log10:{evaluate:function(e){var n=e[0];return k(n),Math.log10(n)},validate:function(e){return A(1,e)}},sin:{evaluate:function(e){var n=e[0];return k(n),Math.sin(n)},validate:function(e){return A(1,e)}},asin:{evaluate:function(e){var n=e[0];return k(n),Math.asin(n)},validate:function(e){return A(1,e)}},sinh:{evaluate:function(e){var n=e[0];return k(n),Math.sinh(n)},validate:function(e){return A(1,e)}},asinh:{evaluate:function(e){var n=e[0];return k(n),Math.asinh(n)},validate:function(e){return A(1,e)}},cos:{evaluate:function(e){var n=e[0];return k(n),Math.cos(n)},validate:function(e){return A(1,e)}},acos:{evaluate:function(e){var n=e[0];return k(n),Math.acos(n)},validate:function(e){return A(1,e)}},cosh:{evaluate:function(e){var n=e[0];return k(n),Math.cosh(n)},validate:function(e){return A(1,e)}},acosh:{evaluate:function(e){var n=e[0];return k(n),Math.acosh(n)},validate:function(e){return A(1,e)}},tan:{evaluate:function(e){var n=e[0];return k(n),Math.tan(n)},validate:function(e){return A(1,e)}},atan:{evaluate:function(e){var n=e[0];return k(n),Math.atan(n)},validate:function(e){return A(1,e)}},tanh:{evaluate:function(e){var n=e[0];return k(n),Math.tanh(n)},validate:function(e){return A(1,e)}},atanh:{evaluate:function(e){var n=e[0];return k(n),Math.atanh(n)},validate:function(e){return A(1,e)}}},xe=/[[.]/;function Ee(e,n){for(var r=0,t=we(n);r<t.length;r++){var a=t[r];try{e=e[a]}catch(e){return}}return e}function we(e){if(!e)return[];var n=xe.exec(e);if(!n)return[e];if(n.index>0)return a([e.substring(0,n.index)],we(e.substring(n.index)));if("."===e[0]){if(e.length<2)throw Error("Ill formed path: "+e);return we(e.substring(1))}var r=function(e){var n=Ae.exec(e)||Ne.exec(e);if(n){return[n[0].length,n[1]]}var r=je.exec(e);if(r){return[r[0].length,Number(r[1])]}throw Error("Ill formed path: "+e)}(e),t=r[0],u=r[1];if(e.length>t&&"."!==e[t]&&"["!==e[t])throw Error("Ill formed path: "+e);return a([u],we(e.substring(t)))}var Ae=/^\[\s*'(.*)'\s*\]/,Ne=/^\[\s*"(.*)"\s*\]/,je=/^\[\s*(\d+)\s*\]/;var Me={"not=":{evaluate:function(e){for(var n=0;n<e.length-1;n+=1)for(var r=n+1;r<e.length;r+=1)if(e[n]===e[r])return!1;return!0},validate:function(e){return A({min:1},e)}},"=":{evaluate:function(e){for(var n=e[0],r=0,t=e.slice(1);r<t.length;r++){if(t[r]!==n)return!1}return!0},validate:function(e){return A({min:1},e)}},"equal?":{evaluate:function(e){return $(e[0],e[1])},validate:function(e){return A({min:1},e)}},">":{evaluate:function(e){for(var n=e[0],r=0,t=e.slice(1);r<t.length;r++){var a=t[r];if(L(n,a)<=0)return!1;n=a}return!0},validate:function(e){return A({min:1},e)}},"<":{evaluate:function(e){for(var n=e[0],r=0,t=e.slice(1);r<t.length;r++){var a=t[r];if(L(n,a)>=0)return!1;n=a}return!0},validate:function(e){return A({min:1},e)}},">=":{evaluate:function(e){for(var n=e[0],r=0,t=e.slice(1);r<t.length;r++){var a=t[r];if(L(n,a)<0)return!1;n=a}return!0},validate:function(e){return A({min:1},e)}},"<=":{evaluate:function(e){for(var n=e[0],r=0,t=e.slice(1);r<t.length;r++){var a=t[r];if(L(n,a)>0)return!1;n=a}return!0},validate:function(e){return A({min:1},e)}},"get-path":{evaluate:function(e){var n=e[0],r=e[1];return function(e){if((null===e||"object"!=typeof e||Array.isArray(e)||e instanceof RegExp||j(e))&&!Array.isArray(e))throw TypeError("Expected object or array, got: "+e+' type="'+typeof e+'"')}(n),b(r),Ee(n,r)},validate:function(e){return A(2,e)}},not:{evaluate:function(e){return!e[0]},validate:function(e){return A(1,e)}},"inst-ms":{evaluate:function(){return Date.now()},validate:function(e){return A(0,e)}},"write!":{evaluate:function(e){if(console.log.apply(console,e),e.length>0)return e[e.length-1]}},"debug!":{evaluate:function(e,n){0!==e.length?console.warn("*** LISPISH DEBUG ***\n\n"+JSON.stringify(e[0],null,2)):console.warn("*** LISPISH DEBUG ***\n\n"+function(e){return a([],e).reverse().reduce((function(e,n,r){return e+"Context "+r+(0===r?" - Import context":1===r?" - Global context":"")+"\n"+function(e){if(0===Object.keys(e).length)return"  <empty>\n";var n=Math.max.apply(Math,Object.keys(e).map((function(e){return e.length})));return Object.entries(e).reduce((function(e,r){return e+"  "+(""+r[0]).padEnd(n+2," ")+function(e){var n=e.value,r=n.name;if(j(n))return r?"<"+n.type+" function "+r+">":"<"+n.type+" function λ>";return JSON.stringify(e.value)}(r[1])+"\n"}),"")}(n)+"\n"}),"")}(n))},validate:function(e){return A({max:1},e)}},boolean:{evaluate:function(e){return!!e[0]},validate:function(e){return A(1,e)}},compare:{evaluate:function(e){return L(e[0],e[1])},validate:function(e){return A(2,e)}},assert:{evaluate:function(e){var n=e[0],r=2===e.length?e[1]:""+n;if(b(r),!n)throw new o(r);return n},validate:function(e){return A({min:1,max:2},e)}},"lispish-version":{evaluate:function(){return"0.1.49"},validate:function(e){return A(0,e)}}};var Oe={object:{evaluate:function(e){for(var n={},r=0;r<e.length;r+=2){var t=e[r],a=e[r+1];b(t),n[t]=a}return n},validate:function(e){return N(e)}},keys:{evaluate:function(e){var n=e[0];return F(n),Object.keys(n)},validate:function(e){return A(1,e)}},vals:{evaluate:function(e){var n=e[0];return F(n),Object.values(n)},validate:function(e){return A(1,e)}},entries:{evaluate:function(e){var n=e[0];return F(n),Object.entries(n)},validate:function(e){return A(1,e)}},find:{evaluate:function(e){var n=e[0],r=e[1];if(F(n),b(r),function(e,n){return!!V(e)&&(C(e)||P(e)?!!U(n)&&n>=0&&n<e.length:!!Object.getOwnPropertyDescriptor(e,n))}(n,r))return[r,n[r]]},validate:function(e){return A(2,e)}},dissoc:{evaluate:function(e){var n=e[0],r=e[1];F(n),b(r);var t=n[r];return delete n[r],t},validate:function(e){return A(2,e)}},merge:{evaluate:function(e){var n=e[0],r=e.slice(1);return F(n),r.reduce((function(e,n){return F(n),t(t({},e),n)}),t({},n))},validate:function(e){return A({min:1},e)}}},ke={"function?":{evaluate:function(e){return j(e[0])},validate:function(e){return A(1,e)}},"string?":{evaluate:function(e){return"string"==typeof e[0]},validate:function(e){return A(1,e)}},"number?":{evaluate:function(e){return"number"==typeof e[0]},validate:function(e){return A(1,e)}},"integer?":{evaluate:function(e){var n=e[0];return"number"==typeof n&&Number.isInteger(n)},validate:function(e){return A(1,e)}},"boolean?":{evaluate:function(e){return"boolean"==typeof e[0]},validate:function(e){return A(1,e)}},"undefined?":{evaluate:function(e){return void 0===e[0]},validate:function(e){return A(1,e)}},"null?":{evaluate:function(e){return null===e[0]},validate:function(e){return A(1,e)}},"zero?":{evaluate:function(e){var n=e[0];return m(n),0===n},validate:function(e){return A(1,e)}},"pos?":{evaluate:function(e){var n=e[0];return m(n),n>0},validate:function(e){return A(1,e)}},"neg?":{evaluate:function(e){var n=e[0];return m(n),n<0},validate:function(e){return A(1,e)}},"even?":{evaluate:function(e){var n=e[0];return m(n),n%2==0},validate:function(e){return A(1,e)}},"odd?":{evaluate:function(e){var n=e[0];return m(n),Number.isInteger(n)&&n%2!=0},validate:function(e){return A(1,e)}},"array?":{evaluate:function(e){return P(e[0])},validate:function(e){return A(1,e)}},"coll?":{evaluate:function(e){return V(e[0])},validate:function(e){return A(1,e)}},"seq?":{evaluate:function(e){return _(e[0])},validate:function(e){return A(1,e)}},"object?":{evaluate:function(e){return R(e[0])},validate:function(e){return A(1,e)}},"regexp?":{evaluate:function(e){var n=e[0];return null!==n&&!Array.isArray(n)&&"object"==typeof n&&n instanceof RegExp},validate:function(e){return A(1,e)}},"finite?":{evaluate:function(e){var n=e[0];return k(n),Number.isFinite(n)},validate:function(e){return A(1,e)}},"nan?":{evaluate:function(e){var n=e[0];return k(n),Number.isNaN(n)},validate:function(e){return A(1,e)}},"positive-infinity?":{evaluate:function(e){var n=e[0];return k(n),n===Number.POSITIVE_INFINITY},validate:function(e){return A(1,e)}},"negative-infinity?":{evaluate:function(e){var n=e[0];return k(n),n===Number.NEGATIVE_INFINITY},validate:function(e){return A(1,e)}},"true?":{evaluate:function(e){return!0===e[0]},validate:function(e){return A(1,e)}},"false?":{evaluate:function(e){return!1===e[0]},validate:function(e){return A(1,e)}}},Se={regexp:{evaluate:function(e){var n=e[0],r=e[1];return b(n),1===e.length?new RegExp(n):(b(r),new RegExp(n,r))},validate:function(e){return A({min:1,max:2},e)}},match:{evaluate:function(e){var n=e[0],r=e[1];w(n),b(r);var t=n.exec(r);if(t)return a([],t)},validate:function(e){return A(2,e)}},replace:{evaluate:function(e){var n=e[0],r=e[1],t=e[2];return b(n),w(r),b(t),n.replace(r,t)},validate:function(e){return A(3,e)}}},Te={subs:{evaluate:function(e){var n=e[0],r=e[1],t=e[2];return b(n),h(r),void 0===t?n.substring(r):(y(t,r),n.substring(r,t))},validate:function(e){return A({min:2,max:3},e)}},"string-repeat":{evaluate:function(e){var n=e[0],r=e[1];return b(n),h(r),n.repeat(r)},validate:function(e){return A(2,e)}},str:{evaluate:function(e){return e.reduce((function(e,n){return e+(void 0===n?"":null===n?"null":R(n)||Array.isArray(n)?JSON.stringify(n):""+n)}),"")}},"string-to-number":{evaluate:function(e){var n=e[0];b(n);var r=Number(n);if(Number.isNaN(r))throw Error("Could not convert '"+n+"' to a number");return r},validate:function(e){return A(1,e)}},"number-to-string":{evaluate:function(e){var n=e[0],r=e[1];if(m(n),1===e.length)return""+n;if(m(r),2!==r&&8!==r&&10!==r&&16!==r)throw Error('Expected "number-to-string" base argument to be 2, 8, 10 or 16, got: '+r);return 10===r?""+n:(h(n),Number(n).toString(r))},validate:function(e){return A({min:1,max:2},e)}},"lower-case":{evaluate:function(e){var n=e[0];return b(n),n.toLowerCase()},validate:function(e){return A(1,e)}},"upper-case":{evaluate:function(e){var n=e[0];return b(n),n.toUpperCase()},validate:function(e){return A(1,e)}},trim:{evaluate:function(e){var n=e[0];return b(n),n.trim()},validate:function(e){return A(1,e)}},"trim-left":{evaluate:function(e){var n=e[0];return b(n),n.replace(/^\s+/,"")},validate:function(e){return A(1,e)}},"trim-right":{evaluate:function(e){var n=e[0];return b(n),n.replace(/\s+$/,"")},validate:function(e){return A(1,e)}},join:{evaluate:function(e){var n=e[0],r=e[1];return S(n),n.forEach((function(e){return b(e)})),b(r),n.join(r)},validate:function(e){return A(2,e)}},split:{evaluate:function(e){var n=e[0],r=e[1],t=e[2];return b(n),function(e){if(!(e instanceof RegExp||"string"==typeof e))throw TypeError("Expected RegExp or string, got: "+e+' type="'+typeof e+'"')}(r),void 0!==t&&h(t),n.split(r,t)},validate:function(e){return A({min:2,max:3},e)}},"pad-left":{evaluate:function(e){var n=e[0],r=e[1],t=e[2];return b(n),g(r),void 0!==t&&b(t),n.padStart(r,t)},validate:function(e){return A({min:2,max:3},e)}},"pad-right":{evaluate:function(e){var n=e[0],r=e[1],t=e[2];return b(n),g(r),void 0!==t&&b(t),n.padEnd(r,t)},validate:function(e){return A({min:2,max:3},e)}},template:{evaluate:function(e){var n=e[0],r=e.slice(1);b(n);var t=n.split("||||");if(1===t.length)return function(e){if(!Array.isArray(e)||e.some((function(e){return"string"!=typeof e})))throw Error("Expected an array of strings, got "+e)}(r),Fe(t[0],r);if(2===t.length){var u=r[0];h(u);var i=a([""+u],r.slice(1));return Fe(1===u?t[0]:t[1],i)}throw Error('Invalid template string, only one "||||" separator allowed')},validate:function(e){return A({min:1,max:10},e)}}},Ie=/\$\$/g;function Fe(e,n){for(var r=0;r<9;r+=1){var t=new RegExp("(?<=^|[^$]|\\$\\$)\\$"+(r+1),"g");if(t.test(e)){var a=n[r];b(a),e=e.replace(t,a)}}return e.replace(Ie,"$")}var Re={apply:{evaluate:function(e,n,r){var t=e[0],u=e.slice(1),i=r.executeFunction;M(t);var o=u[u.length-1];return S(o),i(t,a(a([],u.slice(0,-1)),o),n)},validate:function(e){return A({min:2},e)}},identity:{evaluate:function(e){return e[0]},validate:function(e){return A(1,e)}},partial:{evaluate:function(e){var n,r=e[0],t=e.slice(1);return(n={})[l]=!0,n.type="partial",n.fn=r,n.params=t,n},validate:function(e){return A({min:1},e)}},comp:{evaluate:function(e){var n;if(e.length>1){var r=e[e.length-1];P(r)&&(e=a(a([],e.slice(0,-1)),r))}return(n={})[l]=!0,n.type="comp",n.fns=e,n}},constantly:{evaluate:function(e){var n,r=e[0];return(n={})[l]=!0,n.type="constantly",n.value=r,n},validate:function(e){return A(1,e)}},juxt:{evaluate:function(e){var n;return(n={})[l]=!0,n.type="juxt",n.fns=e,n},validate:function(e){return A({min:1},e)}},complement:{evaluate:function(e){var n,r=e[0];return(n={})[l]=!0,n.type="complement",n.fn=r,n},validate:function(e){return A(1,e)}},"every-pred":{evaluate:function(e){var n;return(n={})[l]=!0,n.type="every-pred",n.fns=e,n},validate:function(e){return A({min:1},e)}},"some-pred":{evaluate:function(e){var n;return(n={})[l]=!0,n.type="some-pred",n.fns=e,n},validate:function(e){return A({min:1},e)}}},Pe=t(t(t(t(t(t(t(t(t(t(t({},{"bit-shift-left":{evaluate:function(e){var n=e[0],r=e[1];return g(n),h(r),n<<r},validate:function(e){return A(2,e)}},"bit-shift-right":{evaluate:function(e){var n=e[0],r=e[1];return g(n),h(r),n>>r},validate:function(e){return A(2,e)}},"bit-not":{evaluate:function(e){var n=e[0];return g(n),~n},validate:function(e){return A(1,e)}},"bit-and":{evaluate:function(e){var n=e[0],r=e.slice(1);return g(n),r.reduce((function(e,n){return g(n),e&n}),n)},validate:function(e){return A({min:2},e)}},"bit-and-not":{evaluate:function(e){var n=e[0],r=e.slice(1);return g(n),r.reduce((function(e,n){return g(n),e&~n}),n)},validate:function(e){return A({min:2},e)}},"bit-or":{evaluate:function(e){var n=e[0],r=e.slice(1);return g(n),r.reduce((function(e,n){return g(n),e|n}),n)},validate:function(e){return A({min:2},e)}},"bit-xor":{evaluate:function(e){var n=e[0],r=e.slice(1);return g(n),r.reduce((function(e,n){return g(n),e^n}),n)},validate:function(e){return A({min:2},e)}},"bit-flip":{evaluate:function(e){var n=e[0],r=e[1];return g(n),h(r),n^1<<r},validate:function(e){return A(2,e)}},"bit-set":{evaluate:function(e){var n=e[0],r=e[1];return g(n),h(r),n|1<<r},validate:function(e){return A(2,e)}},"bit-clear":{evaluate:function(e){var n=e[0],r=e[1];return g(n),h(r),n&~(1<<r)},validate:function(e){return A(2,e)}},"bit-test":{evaluate:function(e){var n=e[0],r=e[1];return g(n),h(r),!!(n&1<<r)},validate:function(e){return A(2,e)}}}),me),ye),ge),be),Me),Oe),ke),Se),Te),Re),_e={def:oe,defs:fe,and:{parse:function(e,n,r){var t=(0,r.parseTokens)(e,n);return[t[0]+1,{type:"SpecialExpression",name:"and",params:t[1]}]},evaluate:function(e,n,r){for(var t=r.evaluateAstNode,a=!0,u=0,i=e.params;u<i.length;u++){if(!(a=t(i[u],n)))break}return a}},cond:G,defn:H,defns:K,if:Q,"if-not":ee,"if-let":ne,"when-let":re,"when-not":te,"when-first":ae,fn:Z,let:ue,or:{parse:function(e,n,r){var t=(0,r.parseTokens)(e,n);return[t[0]+1,{type:"SpecialExpression",name:"or",params:t[1]}]},evaluate:function(e,n,r){for(var t=r.evaluateAstNode,a=!1,u=0,i=e.params;u<i.length;u++){if(a=t(i[u],n))break}return a}},do:ie,throw:ce,try:le,when:ve,recur:se,loop:pe,"time!":de};Object.keys(_e).forEach((function(e){if(Pe[e])throw Error("Expression "+e+" is defined as both a normal expression and a special expression")}));var Ve={normalExpressions:Pe,specialExpressions:_e},Ce=Object.keys(Pe),qe=Object.keys(_e);function Ue(e,n,r){for(var t,a=[n,r],u=0,i=e.body;u<i.length;u++){var o=i[u];t=Be(o,a)}return t}var Be=function(e,n){switch(e.type){case"Number":case"String":return function(e){return e.value}(e);case"Name":return function(e,n){for(var r,t=e.value,a=0,u=n;a<u.length;a++){var i=u[a][t];if(i)return i.value}if(Ve.normalExpressions[t]){return(r={})[l]=!0,r.type="builtin",r.builtin=t,r}throw Error("Undefined identifier "+t)}(e,n);case"ReservedName":return function(e){return p(z[e.value],e.value+" is not a reserved name").value}(e);case"NormalExpression":return function(e,n){var r,t=e.params.map((function(e){return Be(e,n)}));if(function(e){return"string"==typeof e.name}(e)){for(var a=0,u=n;a<u.length;a++){var i=null===(r=u[a][e.name])||void 0===r?void 0:r.value;try{return De(i,t,n)}catch(e){continue}}return function(e,n,r){return(0,p(Ve.normalExpressions[e.name],e.name+" is not a function").evaluate)(n,r,{executeFunction:De})}(e,t,n)}i=Be(e.expression,n);return De(i,t,n)}(e,n);case"SpecialExpression":return function(e,n){return(0,p(Ve.specialExpressions[e.name],e.name+" is not a built in special expression").evaluate)(e,n,{evaluateAstNode:Be,builtin:Ve})}(e,n)}};var De=function(e,n,r){if(j(e))return Le(e,n,r);if(Array.isArray(e))return function(e,n){if(1!==n.length)throw Error("Array as function requires one non negative integer parameter");var r=n[0];return h(r),e[r]}(e,n);if(R(e))return function(e,n){if(1!==n.length)throw Error("Object as function requires one string parameter");var r=n[0];return b(r),e[r]}(e,n);if(C(e))return function(e,n){if(1!==n.length)throw Error("String as function requires one Obj parameter");var r=n[0];if(R(r))return r[e];if(U(r))return e[r];throw Error("string as function expects Obj or integer parameter, got "+r)}(e,n);if(q(e))return function(e,n){if(g(e),1!==n.length)throw Error("String as function requires one Arr parameter");var r=n[0];return I(r),r[e]}(e,n);throw Error("Expected function, got "+e)},Le=function(e,n,r){var i,o;switch(e.type){case"user-defined":for(var f=e.arguments,c=f.mandatoryArguments.length,l=f.optionalArguments.length,v=f.restArgument?null:c+l;;){var s=t({},e.functionContext);if(n.length<f.mandatoryArguments.length)throw Error("Function "+(null!==(i=e.name)&&void 0!==i?i:"(fn)")+" requires at least "+f.mandatoryArguments.length+" arguments. Got "+n.length);if(null!==v&&n.length>v)throw Error('Function "'+(null!==(o=e.name)&&void 0!==o?o:"λ")+'" requires at most '+v+" arguments. Got "+n.length);for(var d=Math.max(n.length,f.mandatoryArguments.length+f.optionalArguments.length),m=[],h=0;h<d;h+=1)if(h<c){var g=n[h];s[p(f.mandatoryArguments[h],"")]={value:g}}else if(h<c+l){var y=p(f.optionalArguments[h-c],"");g=h<n.length?n[h]:void 0!==y.defaultValue?y.defaultValue:void 0;s[y.name]={value:g}}else m.push(n[h]);f.restArgument&&(s[f.restArgument]={value:m});try{for(var b=void 0,x=0,E=e.body;x<E.length;x++){var w=E[x];b=Be(w,a([s],r))}return b}catch(e){if(e instanceof u){n=e.params;continue}throw e}}case"partial":return De(e.fn,a(a([],e.params),n),r);case"comp":var A=e.fns;if(0===A.length){if(1!==n.length)throw Error("(comp) expects one argument, got "+n.length);return n[0]}return A.reduceRight((function(e,n){return[De(n,e,r)]}),n)[0];case"constantly":return e.value;case"juxt":return e.fns.map((function(e){return De(e,n,r)}));case"complement":return!De(e.fn,n,r);case"every-pred":for(var N=0,j=e.fns;N<j.length;N++)for(var M=j[N],O=0,k=n;O<k.length;O++){g=k[O];if(!(b=De(M,[g],r)))return!1}return!0;case"some-pred":for(var S=0,T=e.fns;S<T.length;S++){M=T[S];for(var I=0,F=n;I<F.length;I++){g=F[I];if(b=De(M,[g],r))return!0}}return!1;default:return p(Pe[e.builtin],e.builtin+" is not a function").evaluate(n,r,{executeFunction:De})}};var $e=function(e,n){for(var r,t,a=p(e[n]),u=[];"paren"!==a.type||")"!==a.value&&"]"!==a.value;)n=(r=Ke(e,n))[0],t=r[1],u.push(t),a=p(e[n]);return[n,u]},Ge=function(e,n){var r=p(e[n+=1]);return"name"===r.type&&Ve.specialExpressions[r.value]?He(e,n):Xe(e,n)},ze=/^%([1-9][0-9]?$)/,Ye=function(e,n){var r=p(e[n]);if("name"===r.type)return[n+1,{type:"Argument",name:r.value}];if("paren"===r.type&&"("===r.value){if("name"!==(r=p(e[n+=1])).type)throw new f("name",r);var t=r.value,a=Ke(e,n+=1),u=a[0],i=a[1];if("paren"!==(r=p(e[u])).type||")"!==r.value)throw new f(")",r);return[u+1,{type:"Argument",name:t,defaultValue:i}]}if("modifier"===r.type)return[n+1,{type:"Modifier",value:r.value}];throw new f('"(", name or modifier',r)},Je=function(e,n){var r,t=p(e[n]);if("paren"!==t.type||"["!==t.value)throw new f("[",t);t=p(e[n+=1]);for(var a,u=[];"paren"!==t.type||"]"!==t.value;)n=(r=We(e,n))[0],a=r[1],u.push(a),t=p(e[n]);return[n+=1,u]};function We(e,n){var r,t=p(e[n]);if("name"!==t.type)throw Error("Expected name node in binding, got "+t.type+" value="+t.value);var a=t.value;return t=p(e[n+=1]),[n=(r=Ke(e,n))[0],{type:"Binding",name:a,value:r[1]}]}var Xe=function(e,n){var r,t,a,u=Ke(e,n),i=u[0],o=u[1];if(n=(r=$e(e,i))[0],a=r[1],n+=1,function(e){return"NormalExpression"===e.type||"SpecialExpression"===e.type||"Number"===e.type||"String"===e.type}(o))return[n,{type:"NormalExpression",expression:o,params:a}];s(o);var f={type:"NormalExpression",name:o.value,params:a},c=Ve.normalExpressions[f.name];return c&&(null===(t=c.validate)||void 0===t||t.call(c,f)),[n,f]},He=function(e,n){var r=p(e[n]).value;n+=1;var t=p(Ve.specialExpressions[r],r+" is not a built in special expression"),a=t.parse,u=t.validate,i=a(e,n,{parseExpression:Ge,parseTokens:$e,parseToken:Ke,parseBindings:Je,parseArgument:Ye}),o=i[0],f=i[1];return null==u||u(f),[o,f]},Ke=function(e,n){var r=p(e[n]),t=void 0;switch(r.type){case"number":t=function(e,n){var r=p(e[n]);return[n+1,{type:"Number",value:Number(r.value)}]}(e,n);break;case"string":t=function(e,n){return[n+1,{type:"String",value:p(e[n]).value}]}(e,n);break;case"name":t=function(e,n){return[n+1,{type:"Name",value:p(e[n]).value}]}(e,n);break;case"reservedName":t=function(e,n){return[n+1,{type:"ReservedName",value:p(e[n]).value}]}(e,n);break;case"paren":"("===r.value?t=Ge(e,n):"["===r.value?t=function(e,n){for(var r,t,a=p(e[n+=1]),u=[];"paren"!==a.type||"]"!==a.value;)n=(r=Ke(e,n))[0],t=r[1],u.push(t),a=p(e[n]);return[n+=1,{type:"NormalExpression",name:"array",params:u}]}(e,n):"{"===r.value&&(t=function(e,n){for(var r,t,a=p(e[n+=1]),u=[];"paren"!==a.type||"}"!==a.value;)n=(r=Ke(e,n))[0],t=r[1],u.push(t),a=p(e[n]);n+=1;var i={type:"NormalExpression",name:"object",params:u};return N(i),[n,i]}(e,n));break;case"regexpShorthand":t=function(e,n){return[n+1,{type:"NormalExpression",name:"regexp",params:[{type:"String",value:p(e[n]).value}]}]}(e,n);break;case"fnShorthand":t=function(e,n){for(var r=Xe(e,n+=2),t=r[0],a=r[1],u=0,i=n+1;i<t-1;i+=1){var o=p(e[i]);if("name"===o.type){var f=ze.exec(o.value);if(f&&(u=Math.max(u,Number(f[1])))>20)throw Error("Can't specify more than 20 arguments")}if("fnShorthand"===o.type)throw Error("Nested shortcut functions are not allowed")}for(var c=[],l=1;l<=u;l+=1)c.push("%"+l);return[t,{type:"SpecialExpression",name:"fn",params:[],arguments:{bindings:[],mandatoryArguments:c,optionalArguments:[]},body:[a]}]}(e,n)}if(!t)throw SyntaxError("Unrecognized token: "+r.type+" value="+r.value);return t};var Ze=/[%0-9a-zA-Z_^?=!$%<>.+*/-]/,Qe=/\s|,/,en=function(e,n){if('"'!==e[n])return[0,void 0];for(var r="",t=1,a=e[n+t],u=!1;'"'!==a||u;){if(void 0===a)throw new SyntaxError("Unclosed string at position "+n);u?(u=!1,'"'===a||"\\"===a||(r+="\\"),r+=a):"\\"===a?u=!0:r+=a,a=e[n+(t+=1)]}return[t+1,{type:"string",value:r}]},nn=/\s|[)\]},]/,rn=/[0-9]/,tn=/[0-7]/,an=/[0-9a-fA-F]/,un=/[0-1]/,on=/[0-9.-]/;function fn(e,n,r,t){return n===r[t]?[1,{type:e,value:n}]:[0,void 0]}var cn=[function(e,n){if(";"===e[n]){for(var r=1;"\n"!==e[n+r]&&n+r<e.length;)r+=1;return"\n"===e[n+r]&&n+r<e.length&&(r+=1),[r,void 0]}return[0,void 0]},function(e,n){var r;return Qe.test(null!==(r=e[n])&&void 0!==r?r:"")?[1,void 0]:[0,void 0]},function(e,n){return fn("paren","(",e,n)},function(e,n){return fn("paren",")",e,n)},function(e,n){return fn("paren","[",e,n)},function(e,n){return fn("paren","]",e,n)},function(e,n){return fn("paren","{",e,n)},function(e,n){return fn("paren","}",e,n)},en,function(e,n){var r="decimal",t=e[n];if(void 0===t)return[0,void 0];var a,u="."===t;if(!on.test(t))return[0,void 0];for(a=n+1;a<e.length;a+=1){var i=p(e[a]);if(nn.test(i))break;if(a===n+1&&"0"===t){if("b"===i||"B"===i){r="binary";continue}if("o"===i||"O"===i){r="octal";continue}if("x"===i||"X"===i){r="hex";continue}}if("decimal"===r&&u){if(!rn.test(i))return[0,void 0]}else if("binary"===r){if(!un.test(i))return[0,void 0]}else if("octal"===r){if(!tn.test(i))return[0,void 0]}else if("hex"===r){if(!an.test(i))return[0,void 0]}else{if("."===i){u=!0;continue}if(!rn.test(i))return[0,void 0]}}var o=a-n,f=e.substring(n,a);return"decimal"!==r&&o<=2||"."===f||"-"===f?[0,void 0]:[o,{type:"number",value:f}]},function(e,n){for(var r=0,t=Object.keys(z);r<t.length;r++){var a=t[r],u=a.length,i=e[n+u];if((!i||!Ze.test(i))&&e.substr(n,u)===a)return[u,{type:"reservedName",value:a}]}return[0,void 0]},function(e,n){return function(e,n,r,t){var a=r[t],u=0,i="";if(!a||!n.test(a))return[0,void 0];for(;a&&n.test(a);)i+=a,a=r[t+(u+=1)];return[u,{type:e,value:i}]}("name",Ze,e,n)},function(e,n){return"&rest"===e.substr(n,5)?[5,{type:"modifier",value:"&rest"}]:"&opt"===e.substr(n,4)?[4,{type:"modifier",value:"&opt"}]:"&bind"===e.substr(n,5)?[5,{type:"modifier",value:"&bind"}]:[0,void 0]},function(e,n){if("#"!==e[n])return[0,void 0];var r=en(e,n+1),t=r[0],a=r[1];return a?[t+1,{type:"regexpShorthand",value:a.value}]:[0,void 0]},function(e,n){return"#("!==e.slice(n,n+2)?[0,void 0]:[1,{type:"fnShorthand",value:"#"}]}];var ln=function(){function e(){this.importScope={}}return e.prototype.tokenize=function(e){return function(e){for(var n=[],r=0,t=!1;r<e.length;){t=!1;for(var a=0,u=cn;a<u.length;a++){var i=(0,u[a])(e,r),o=i[0],f=i[1];if(o>0&&(t=!0,r+=o,f)){n.push(f);break}}if(!t)throw new SyntaxError("Unrecognized character at position "+r+": '"+e[r]+"'")}return n}(e)},e.prototype.parse=function(e){return function(e){for(var n,r,t={type:"Program",body:[]},a=0;a<e.length;)a=(n=Ke(e,a))[0],r=n[1],t.body.push(r);return t}(e)},e.prototype.evaluate=function(e,n){void 0===n&&(n={});var r=n.globalContext||{};return n.vars&&Object.entries(n.vars).forEach((function(e){var n=e[0],t=e[1];r[n]={value:t}})),Ue(e,r,this.importScope)},e.prototype.run=function(e,n){var r=this.tokenize(e),t=this.parse(r);return this.evaluate(t,n)},e.prototype.import=function(e){var n=this.tokenize(e),r={};Ue(this.parse(n),r,{});for(var t=Object.keys(this.importScope),a=0,u=Object.keys(r);a<u.length;a++){var i=u[a];if(t.includes(i))throw Error('Import faild, imported function/variable already exists: "'+i+'"');J(i,[{},{}],Ve)}Object.assign(this.importScope,r)},e}();return e.Lispish=ln,e.isLispishFunction=j,e.normalExpressionKeys=Ce,e.reservedNames=Y,e.specialExpressionKeys=qe,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
//# sourceMappingURL=lispish.iife.js.map
