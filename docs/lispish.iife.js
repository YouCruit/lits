var Lispish=function(e){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},t(e,n)};function n(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var r=function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},r.apply(this,arguments)};function a(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e}var u=function(e){function t(n){var r=e.call(this,"recur, params: "+n)||this;return Object.setPrototypeOf(r,t.prototype),r.name="RecurSignal",r.params=n,r}return n(t,e),t}(Error),i=function(e){function t(n){var r=e.call(this,n)||this;return Object.setPrototypeOf(r,t.prototype),r.name="UserDefinedError",r}return n(t,e),t}(Error),o=function(e){function t(n){var r=e.call(this,n)||this;return Object.setPrototypeOf(r,t.prototype),r.name="AssertionError",r}return n(t,e),t}(Error),l=function(e){function t(n,r){var a=e.call(this,'Expected a "'+n+'" token, got Token['+r.type+':"'+r.value+'"]')||this;return Object.setPrototypeOf(a,t.prototype),a.name="UnexpectedTokenError",a}return n(t,e),t}(Error),f=function(e){function t(n,r){var a=e.call(this,"Expected a "+n+" node, got "+(r?"a "+r.type+" node":"undefined"))||this;return Object.setPrototypeOf(a,t.prototype),a.name="UnexpectedNodeTypeError",a}return n(t,e),t}(Error),c=Symbol("function");function v(e){if(void 0===e)throw Error("Expected an AST node, got undefined");return e}function s(e){if(void 0===e||"Name"!==e.type)throw new f("Name",e)}function p(e,t){if(void 0===t&&(t="Unexpected end of input"),void 0===e)throw Error(t);return e}function d(e){if(void 0===e)throw Error("Expected non undefined value, got "+e);return e}function h(e){if(void 0===e)throw Error("Expected non undefined value, got "+e)}function m(e){if("number"!=typeof e||!isFinite(e))throw TypeError("Expected number, got: "+e+' type="'+typeof e+'"')}function g(e){!function(e){if(m(e),e<0)throw TypeError("Expected non negative number, got "+e)}(e),y(e)}function y(e){if(m(e),!Number.isInteger(e))throw TypeError("Expected integer, got "+e)}function b(e,t){if(m(e),e<t)throw TypeError("Expected parameter ("+e+") to be a number equal or grater than "+t)}function E(e){return"string"==typeof e}function x(e){if(!E(e))throw TypeError("Expected string, got: "+e+' type="'+typeof e+'"')}function w(e){if(!E(e))throw TypeError("Expected string, got: "+e+' type="'+typeof e+'"');return e}function A(e){if(!function(e){return E(e)&&1===e.length}(e))throw TypeError("Expected char, got: "+e+' type="'+typeof e+'"')}function N(e){return A(e),e}function j(e){if("string"!=typeof e&&"number"!=typeof e)throw TypeError("Expected string or number, got: "+e+' type="'+typeof e+'"')}function M(e){if(!(e instanceof RegExp))throw TypeError("Expected RegExp, got: "+e+' type="'+typeof e+'"')}function S(e,t){var n=t.params.length;if("number"==typeof e){if(n!==e)throw Error('Wrong number of arguments to "'+t.name+'", expected '+e+", got "+n)}else{var r=e.min,a=e.max;if(void 0===r&&void 0===a)throw Error("Min or max must be specified");if("number"==typeof r&&n<r)throw Error('Wrong number of arguments to "'+t.name+'", expected at least '+r+", got "+n);if("number"==typeof a&&n>a)throw Error('Wrong number of arguments to "'+t.name+'", expected at most '+a+", got "+n)}}function k(e){var t=e.params.length;if(t%2!=0)throw Error("Wrong number of arguments, expected an even number, got "+t)}function O(e){return null!==e&&"object"==typeof e&&!!e[c]}function T(e){if(!O(e))throw Error("Expected lispish function, got "+JSON.stringify(e))}function I(e){if(!Array.isArray(e)||e.some((function(e){return"string"!=typeof e})))throw Error("Expected an array of strings, got "+e)}function F(e){if(!Array.isArray(e)||e.some((function(e){return"string"!=typeof e||1!==e.length})))throw Error("Expected an array of chars, got "+e)}function _(e){if(!L(e))throw TypeError("Expected a number, got: "+e+' type="'+typeof e+'"')}function P(e){if(!U(e))throw TypeError("Expected Arr, got: "+e+' type="'+typeof e+'"')}function C(e){if(!D(e))throw TypeError("Expected collection, got: "+e+' type="'+typeof e+'"')}function z(e){if(!function(e){return void 0!==e}(e))throw TypeError("Expected Any, got: "+e+' type="'+typeof e+'"')}function R(e){if(!B(e))throw TypeError("Expected string or array, got: "+e+' type="'+typeof e+'"')}function q(e){if(!V(e))throw TypeError("Expected object, got: "+e+' type="'+typeof e+'"')}function V(e){return!(null===e||"object"!=typeof e||Array.isArray(e)||e instanceof RegExp||O(e))}function U(e){return Array.isArray(e)}function B(e){return Array.isArray(e)||E(e)}function D(e){return B(e)||V(e)}function L(e){return"number"==typeof e}function $(e){return Number.isInteger(e)}function G(e,t){return!!D(e)&&(E(e)||U(e)?!!$(t)&&(t>=0&&t<e.length):!!Object.getOwnPropertyDescriptor(e,t))}var Y={boolean:0,number:1,string:2,array:3,object:4,regexp:5,unknown:6,null:7};function J(e){return null===e?"null":"boolean"==typeof e?"boolean":"number"==typeof e?"number":"string"==typeof e?"string":U(e)?"array":V(e)?"object":function(e){return e instanceof RegExp}(e)?"regexp":"unknown"}function W(e,t){var n=J(e),r=J(t);if(n!==r)return Math.sign(Y[n]-Y[r]);switch(n){case"null":case"unknown":return 0;case"boolean":return e===t?0:!1===e?-1:1;case"number":return Math.sign(e-t);case"string":return(c=e)<(v=t)?-1:c>v?1:0;case"array":var a=e,u=t;if(a.length<u.length)return-1;if(a.length>u.length)return 1;for(var i=0;i<a.length;i+=1){var o=W(a[i],u[i]);if(0!==o)return o}return 0;case"object":var l=e,f=t;return Math.sign(Object.keys(l).length-Object.keys(f).length);case"regexp":var c,v;return(c=e.source)<(v=t.source)?-1:c>v?1:0}}function X(e,t){if(e===t)return!0;if("number"==typeof e&&"number"==typeof t)return Math.abs(e-t)<Number.EPSILON;if(U(e)&&U(t)){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n+=1)if(!X(p(e[n]),p(t[n])))return!1;return!0}if(e instanceof RegExp&&t instanceof RegExp)return e.toString()===t.toString();if("object"==typeof e&&null!==e&&"object"==typeof t&&null!==t){var r=e,a=t,u=Object.keys(r),i=Object.keys(a);if(u.length!==i.length)return!1;for(n=0;n<u.length;n+=1){var o=w(u[n]);if(!X(K(r[o]),K(a[o])))return!1}return!0}return!1}function H(e){return Math.max(0,Math.ceil(e))}function K(e){return null!=e?e:null}var Z={parse:function(e,t,n){var r;return r=function(e,t,n){for(var r,a,u=[],i=d(e[t]);"paren"!==i.type||")"!==i.value;){var o,l;t=(r=n(e,t))[0],o=r[1],t=(a=n(e,t))[0],l=a[1],u.push({test:o,form:l}),i=d(e[t])}return[t,u]}(e,t,n.parseToken),[(t=r[0])+1,{type:"SpecialExpression",name:"cond",conditions:r[1],params:[]}]},evaluate:function(e,t,n){for(var r=n.evaluateAstNode,a=0,u=e.conditions;a<u.length;a++){var i=u[a];if(r(i.test,t))return r(i.form,t)}return null}},Q={true:{value:!0},false:{value:!1},nil:{value:null}},ee=Object.keys(Q);function te(e,t,n){if("string"==typeof e){if(n.specialExpressions[e])throw Error("Cannot define variable "+e+", it's a special expression");if(n.normalExpressions[e])throw Error("Cannot define variable "+e+", it's a builtin function");if(Q[e])throw Error("Cannot define variable "+e+", it's a reserved name");if(d(t[t.length-2])[e])throw Error('Name already defined "'+e+'"')}}function ne(e){return function(t,n,r){var a,u=r.parseToken,i=r.parseArgument,o=r.parseBindings,c=void 0;if(("defn"===e||"defns"===e)&&(n=(a=u(t,n))[0],c=a[1],"defn"===e&&"Name"!==c.type))throw new f("Name",c);for(var v=function(e,t,n,r){var a,u=[],i=void 0,o=[],f=[],c={},v="mandatory",s=d(e[t]);if("paren"!==s.type||"["!==s.value)throw new l("[",s);for(s=d(e[t+=1]);"paren"!==s.type||"]"!==s.value;){if("bind"===v){t=(a=r(e,t))[0],u=a[1];break}var p=n(e,t),h=p[0],m=p[1];if(s=d(e[t=h]),"Modifier"===m.type)switch(m.value){case"&opt":if("rest"===v)throw Error("&opt cannot appear after &rest");if("optional"===v)throw Error("&opt can only appear once");v="optional";break;case"&rest":if("rest"===v)throw Error("&rest can only appear once");if("optional"===v&&0===f.length)throw Error("No optional arguments where spcified");v="rest";break;case"&bind":if("optional"===v&&0===f.length)throw Error("No optional arguments where spcified");if("rest"===v&&!i)throw Error("No rest argument was spcified");v="bind"}else{if(c[m.name])throw Error('Duplicate argument "'+m.name+'"');if(c[m.name]=!0,Object.getOwnPropertyDescriptor(m,"defaultValue")){if("optional"!==v)throw Error("Cannot specify default value if not an optional argument");f.push({name:m.name,defaultValue:m.defaultValue})}else switch(v){case"mandatory":o.push(m.name);break;case"optional":f.push({name:m.name,defaultValue:void 0});break;case"rest":if(void 0!==i)throw Error("Can only specify one rest argument");i=m.name}}}if("rest"===v&&void 0===i)throw Error("Missing rest argument name");if("optional"===v&&0===f.length)throw Error("No optional arguments where spcified");return[t+=1,{mandatoryArguments:o,optionalArguments:f,restArgument:i,bindings:u}]}(t,n,i,o),s=v[0],p=v[1],h=d(t[n=s]),m=[];"paren"!==h.type||")"!==h.value;){var g=u(t,n),y=g[0],b=g[1];m.push(b),h=d(t[n=y])}if(0===m.length)throw Error('Missing body in special expression "defn"');return n+=1,"defn"===e||"defns"===e?[n,{type:"SpecialExpression",name:e,functionName:c,params:[],arguments:p,body:m}]:[n,{type:"SpecialExpression",name:e,params:[],arguments:p,body:m}]}}function re(e){return function(t,n,r){var a,u=r.evaluateAstNode,i=r.builtin,o=function(e,t,n,r){if("defn"===e){var a=t.functionName.value;return x(a),a}if("defns"===e){var u=r(t.functionName,n);return x(u),u}}(e,t,n,u);te(o,n,i);for(var l={},f=0,v=t.arguments.bindings;f<v.length;f++){var s=v[f],p=s.value,h=u(p,n);l[s.name]={value:h}}var m=t.arguments.optionalArguments.map((function(e){var t=e.name,r=e.defaultValue;return r?{name:t,defaultValue:u(r,n)}:{name:t}})),g=((a={})[c]=!0,a.type="user-defined",a.name=o,a.arguments={mandatoryArguments:t.arguments.mandatoryArguments,restArgument:t.arguments.restArgument,optionalArguments:m},a.body=t.body,a.functionContext=l,a);return"fn"===e?g:(d(n[n.length-2])[o]={value:g},null)}}var ae={parse:ne("defn"),evaluate:re("defn")},ue={parse:ne("defns"),evaluate:re("defns")},ie={parse:ne("fn"),evaluate:re("fn")},oe={parse:function(e,t,n){var r=(0,n.parseTokens)(e,t);return[r[0]+1,{type:"SpecialExpression",name:"if",params:r[1]}]},evaluate:function(e,t,n){var r=n.evaluateAstNode,a=e.params,u=a[0],i=a[1],o=a[2];return r(v(u),t)?r(v(i),t):3===e.params.length?r(v(o),t):null},validate:function(e){return S({min:2,max:3},e)}},le={parse:function(e,t,n){var r=(0,n.parseTokens)(e,t);return[r[0]+1,{type:"SpecialExpression",name:"if-not",params:r[1]}]},evaluate:function(e,t,n){var r=n.evaluateAstNode,a=e.params,u=a[0],i=a[1],o=a[2];return r(v(u),t)?3===e.params.length?r(v(o),t):null:r(v(i),t)},validate:function(e){return S({min:2,max:3},e)}},fe={parse:function(e,t,n){var r,a,u,i,o=n.parseBindings,l=n.parseTokens;if(t=(r=o(e,t))[0],1!==(u=r[1]).length)throw Error("Expected exactly one binding, got "+u.length);return t=(a=l(e,t))[0],i=a[1],[t+1,{type:"SpecialExpression",name:"if-let",binding:d(u[0]),params:i}]},evaluate:function(e,t,n){var r=n.evaluateAstNode,u={},i=r(e.binding.value,t);if(i){u[e.binding.name]={value:i};var o=a([u],t);return r(d(e.params[0]),o)}return 2===e.params.length?r(d(e.params[1]),t):null},validate:function(e){return S({min:1,max:2},e)}},ce={parse:function(e,t,n){var r,a,u,i,o=n.parseBindings,l=n.parseTokens;if(t=(r=o(e,t))[0],1!==(u=r[1]).length)throw Error("Expected exactly one binding, got "+u.length);return t=(a=l(e,t))[0],i=a[1],[t+1,{type:"SpecialExpression",name:"when-let",binding:d(u[0]),params:i}]},evaluate:function(e,t,n){var r=n.evaluateAstNode,u={},i=r(e.binding.value,t);if(!i)return null;u[e.binding.name]={value:i};for(var o=a([u],t),l=null,f=0,c=e.params;f<c.length;f++){l=r(c[f],o)}return l},validate:function(e){return S({min:0},e)}},ve={parse:function(e,t,n){var r=(0,n.parseTokens)(e,t);return[r[0]+1,{type:"SpecialExpression",name:"when-not",params:r[1]}]},evaluate:function(e,t,n){var r=n.evaluateAstNode,a=e.params,u=a[0],i=a.slice(1);if(h(u),r(u,t))return null;for(var o=null,l=0,f=i;l<f.length;l++){o=r(f[l],t)}return o},validate:function(e){return S({min:1},e)}},se={parse:function(e,t,n){var r,a,u,i,o=n.parseBindings,l=n.parseTokens;if(t=(r=o(e,t))[0],1!==(u=r[1]).length)throw Error("Expected exactly one binding, got "+u.length);return t=(a=l(e,t))[0],i=a[1],[t+1,{type:"SpecialExpression",name:"when-first",binding:d(u[0]),params:i}]},evaluate:function(e,t,n){var r=n.evaluateAstNode,u={},i=r(e.binding.value,t);if(!B(i))throw Error("Expected undefined or a sequence, got "+i);if(0===i.length)return null;var o=K(i[0]);u[e.binding.name]={value:o};for(var l=a([u],t),f=null,c=0,v=e.params;c<v.length;c++){f=r(v[c],l)}return f},validate:function(e){return S({min:0},e)}},pe={parse:function(e,t,n){var r,a,u,i=n.parseBindings,o=n.parseTokens;return t=(r=i(e,t))[0],u=r[1],[(t=(a=o(e,t))[0])+1,{type:"SpecialExpression",name:"let",params:a[1],bindings:u}]},evaluate:function(e,t,n){for(var r=n.evaluateAstNode,u={},i=0,o=e.bindings;i<o.length;i++){var l=o[i],f=r(l.value,t);u[l.name]={value:f}}for(var c=a([u],t),v=null,s=0,p=e.params;s<p.length;s++){v=r(p[s],c)}return v}},de={parse:function(e,t,n){for(var r=n.parseToken,a={type:"SpecialExpression",name:"do",params:[]},u=d(e[t]);"paren"!==u.type||")"!==u.value;){var i=r(e,t),o=i[0],l=i[1];a.params.push(l),u=d(e[t=o])}return[t+1,a]},evaluate:function(e,t,n){for(var r=n.evaluateAstNode,u=a([{}],t),i=null,o=0,l=e.params;o<l.length;o++){i=r(l[o],u)}return i}},he={parse:function(e,t,n){var r=(0,n.parseTokens)(e,t),a=r[0],u=r[1];return s(u[0]),[a+1,{type:"SpecialExpression",name:"def",params:u}]},evaluate:function(e,t,n){var r=n.evaluateAstNode,a=n.builtin,u=function(e){if(void 0===e||"Name"!==e.type)throw new f("Name",e);return e}(e.params[0]).value;te(u,t,a);var i=r(v(e.params[1]),t);return d(t[t.length-2])[u]={value:i},i},validate:function(e){return S(2,e)}},me={parse:function(e,t,n){var r=(0,n.parseTokens)(e,t);return[r[0]+1,{type:"SpecialExpression",name:"defs",params:r[1]}]},evaluate:function(e,t,n){var r=n.evaluateAstNode,a=n.builtin,u=r(v(e.params[0]),t);x(u),te(u,t,a);var i=r(v(e.params[1]),t);return d(t[t.length-2])[u]={value:i},i},validate:function(e){return S(2,e)}},ge={parse:function(e,t,n){var r=(0,n.parseToken)(e,t),a=r[0],u=r[1],i=d(e[t=a]);if("paren"!==i.type||")"!==i.value)throw new l(")",i);return[t+=1,{type:"SpecialExpression",name:"throw",params:[],messageNode:u}]},evaluate:function(e,t,n){var r=function(e){if("string"!=typeof e||0===e.length)throw TypeError("Expected non empty string, got: "+e+' type="'+typeof e+'"');return e}((0,n.evaluateAstNode)(e.messageNode,t));throw new i(r)}},ye={parse:function(e,t,n){var r,a,u,i,o=n.parseToken;t=(r=o(e,t))[0],i=r[1];var c,v,s=d(e[t]);if("paren"!==s.type||"("!==s.value)throw new l("(",s);if("paren"!==(s=d(e[t+=1])).type||"("!==s.value)throw new l("(",s);if(t=(a=o(e,t+=1))[0],"Name"!==(c=a[1]).type)throw new f("Name",c);if("paren"!==(s=d(e[t])).type||")"!==s.value)throw new l(")",s);if(t=(u=o(e,t+=1))[0],v=u[1],"paren"!==(s=d(e[t])).type||")"!==s.value)throw new l(")",s);if("paren"!==(s=d(e[t+=1])).type||")"!==s.value)throw new l(")",s);return[t+=1,{type:"SpecialExpression",name:"try",params:[],tryExpression:i,catchExpression:v,error:c}]},evaluate:function(e,t,n){var r,u=n.evaluateAstNode;try{return u(e.tryExpression,t)}catch(n){var i=((r={})[e.error.value]={value:d(n)},r);return u(e.catchExpression,a([i],t))}}},be={parse:function(e,t,n){var r=(0,n.parseTokens)(e,t);return[r[0]+1,{type:"SpecialExpression",name:"when",params:r[1]}]},evaluate:function(e,t,n){var r=n.evaluateAstNode,a=e.params,u=a[0],i=a.slice(1);if(h(u),!r(u,t))return null;for(var o=null,l=0,f=i;l<f.length;l++){o=r(f[l],t)}return o},validate:function(e){return S({min:1},e)}},Ee={parse:function(e,t,n){var r;return[(t=(r=(0,n.parseTokens)(e,t))[0])+1,{type:"SpecialExpression",name:"recur",params:r[1]}]},evaluate:function(e,t,n){var r=n.evaluateAstNode,a=e.params.map((function(e){return r(e,t)}));throw new u(a)}},xe={parse:function(e,t,n){var r,a,u,i=n.parseTokens;return t=(r=(0,n.parseBindings)(e,t))[0],u=r[1],[(t=(a=i(e,t))[0])+1,{type:"SpecialExpression",name:"loop",params:a[1],bindings:u}]},evaluate:function(e,t,n){for(var r=n.evaluateAstNode,i=e.bindings.reduce((function(e,n){return e[n.name]={value:r(n.value,t)},e}),{}),o=a([i],t),l=function(){var t=null;try{for(var n=0,a=e.params;n<a.length;n++){var l=a[n];t=r(l,o)}}catch(t){if(t instanceof u){var f=t.params;if(f.length!==e.bindings.length)throw Error("recur expected "+e.bindings.length+" parameters, got "+f.length);return e.bindings.forEach((function(e,t){d(i[e.name]).value=p(f[t])})),"continue"}throw t}return{value:t}};;){var f=l();if("object"==typeof f)return f.value}}},we={parse:function(e,t,n){var r=(0,n.parseToken)(e,t);return[r[0]+1,{type:"SpecialExpression",name:"time!",params:[r[1]]}]},evaluate:function(e,t,n){var r=n.evaluateAstNode,a=e.params[0];h(a);var u=Date.now(),i=r(a,t),o=Date.now()-u;return console.log("Elapsed time: "+o+" ms"),i},validate:function(e){return S(1,e)}},Ae={get:{evaluate:function(e){var t=e[0],n=e[1],r=e[2],a=3===e.length;if(C(t),U(t)){if(y(n),n<t.length)return K(t[n])}else{if(!V(t))return y(n),K(t[n]);if(x(n),Object.getOwnPropertyDescriptor(t,n))return K(t[n])}return a?(z(r),r):null},validate:function(e){return S({min:2,max:3},e)}},count:{evaluate:function(e){var t=e[0];return"string"==typeof t?t.length:(C(t),Array.isArray(t)?t.length:Object.keys(t).length)},validate:function(e){return S(1,e)}},"contains?":{evaluate:function(e){var t=e[0],n=e[1];return C(t),j(n),B(t)?!!Number.isInteger(n)&&(y(n),n>=0&&n<t.length):!!Object.getOwnPropertyDescriptor(t,n)},validate:function(e){return S(2,e)}},"has?":{evaluate:function(e){var t=e[0],n=e[1];return C(t),U(t)?t.includes(n):E(t)?!!E(n)&&t.split("").includes(n):Object.values(t).includes(n)},validate:function(e){return S(2,e)}},assoc:{evaluate:function(e){var t=e[0],n=e[1],u=e[2];if(C(t),j(n),Array.isArray(t)||"string"==typeof t){if(y(n),b(n,0),function(e,t){if(m(e),e>t)throw TypeError("Expected parameter ("+e+") to be a number equal or less than "+t)}(n,t.length),"string"==typeof t)return A(u),""+t.slice(0,n)+u+t.slice(n+1);var i=a([],t);return i[n]=u,i}x(n);var o=r({},t);return o[n]=u,o},validate:function(e){return S(3,e)}},concat:{evaluate:function(e){return C(e[0]),U(e[0])?e.reduce((function(e,t){return P(t),e.concat(t)}),[]):E(e[0])?e.reduce((function(e,t){return x(t),""+e+t}),""):e.reduce((function(e,t){return q(t),Object.assign(e,t)}),{})},validate:function(e){return S({min:1},e)}},"empty?":{evaluate:function(e){var t=e[0];return C(t),E(t)||Array.isArray(t)?0===t.length:0===Object.keys(t).length},validate:function(e){return S(1,e)}},"every?":{evaluate:function(e,t,n){var r=e[0],a=e[1],u=n.executeFunction;return T(r),C(a),Array.isArray(a)?a.every((function(e){return u(r,[e],t)})):E(a)?a.split("").every((function(e){return u(r,[e],t)})):Object.entries(a).every((function(e){return u(r,[e],t)}))},validate:function(e){return S(2,e)}},"any?":{evaluate:function(e,t,n){var r=e[0],a=e[1],u=n.executeFunction;return T(r),C(a),Array.isArray(a)?a.some((function(e){return u(r,[e],t)})):E(a)?a.split("").some((function(e){return u(r,[e],t)})):Object.entries(a).some((function(e){return u(r,[e],t)}))},validate:function(e){return S(2,e)}},"not-any?":{evaluate:function(e,t,n){var r=e[0],a=e[1],u=n.executeFunction;return T(r),C(a),Array.isArray(a)?!a.some((function(e){return u(r,[e],t)})):E(a)?!a.split("").some((function(e){return u(r,[e],t)})):!Object.entries(a).some((function(e){return u(r,[e],t)}))},validate:function(e){return S(2,e)}},"not-every?":{evaluate:function(e,t,n){var r=e[0],a=e[1],u=n.executeFunction;return T(r),C(a),Array.isArray(a)?!a.every((function(e){return u(r,[e],t)})):E(a)?!a.split("").every((function(e){return u(r,[e],t)})):!Object.entries(a).every((function(e){return u(r,[e],t)}))},validate:function(e){return S(2,e)}},update:{evaluate:function(e,t,n){var u=e[0],i=e[1],o=e[2],l=e.slice(3),f=n.executeFunction;if(C(u),j(i),T(o),V(u))return x(i),(v=r({},u))[i]=f(o,a([v[i]],l),t),v;_(i);var c=H(i);if(function(e,t){if(e>t)throw Error("Expected number less than or equal to "+t+"'")}(c,u.length),Array.isArray(u)){var v=u.map((function(e,n){return c===n?f(o,a([e],l),t):e}));return c===u.length&&(v[c]=f(o,a([void 0],l),t)),v}v=u.split("").map((function(e,n){return c===n?N(f(o,a([e],l),t)):e}));return c===u.length&&(v[c]=N(f(o,a([void 0],l),t))),v.join("")},validate:function(e){return S({min:3},e)}}},Ne=function(e,t,n){var r=n.executeFunction,a=e[0],u=e[1];T(a),R(u);var i=E(u),o=u.length;if(2===e.length)return U(u)?u.map((function(e){return r(a,[e],t)})):u.split("").map((function(e){var n=r(a,[e],t);return A(n),n})).join("");if(e.slice(2).forEach((function(e){if(i?x(e):P(e),o!==e.length)throw Error('All arguments to "map" must have the same length')})),i){for(var l="",f=function(n){var u=e.slice(1).map((function(e){return e[n]})),i=r(a,u,t);A(i),l+=i},c=0;c<o;c+=1)f(c);return l}l=[];var v=function(n){var u=e.slice(1).map((function(e){return K(e[n])}));l.push(r(a,u,t))};for(c=0;c<o;c+=1)v(c);return l},je={cons:{evaluate:function(e){var t=e[0],n=e[1];return z(t),R(n),Array.isArray(n)?a([t],n):(A(t),""+t+n)},validate:function(e){return S(2,e)}},nth:{evaluate:function(e){var t=e[0],n=e[1];return R(t),y(n),K(t[n])},validate:function(e){return S(2,e)}},filter:{evaluate:function(e,t,n){var r=e[0],a=e[1],u=n.executeFunction;return T(r),R(a),Array.isArray(a)?a.filter((function(e){return u(r,[e],t)})):a.split("").filter((function(e){return u(r,[e],t)})).join("")},validate:function(e){return S(2,e)}},first:{evaluate:function(e){var t=e[0];return R(t),K(t[0])},validate:function(e){return S(1,e)}},last:{evaluate:function(e){var t=e[0];return R(t),K(t[t.length-1])},validate:function(e){return S(1,e)}},map:{evaluate:Ne,validate:function(e){return S({min:2},e)}},pop:{evaluate:function(e){var t=e[0];if(R(t),E(t))return t.substr(0,t.length-1);var n=a([],t);return n.pop(),n},validate:function(e){return S(1,e)}},position:{evaluate:function(e,t,n){var r,a=e[0],u=e[1],i=n.executeFunction;return T(a),R(u),E(u)?-1!==(r=u.split("").findIndex((function(e){return i(a,[e],t)})))?r:null:-1!==(r=u.findIndex((function(e){return i(a,[e],t)})))?r:null},validate:function(e){return S(2,e)}},"index-of":{evaluate:function(e){var t,n=e[0],r=e[1];return z(r),R(n),E(n)?(x(r),-1!==(t=n.indexOf(r))?t:null):-1!==(t=n.indexOf(r))?t:null},validate:function(e){return S(2,e)}},push:{evaluate:function(e){var t=e[0],n=e.slice(1);return R(t),E(t)?(F(n),a([t],n).join("")):a(a([],t),n)},validate:function(e){return S({min:2},e)}},reduce:{evaluate:function(e,t,n){var r=n.executeFunction,a=e[0];if(T(a),2===e.length){var u=e[1];if(R(u),0===u.length)return r(a,[],t);if(1===u.length)return K(u[0]);if(E(u)){var i=u.split("");return i.slice(1).reduce((function(e,n){return r(a,[e,n],t)}),p(i[0]))}return u.slice(1).reduce((function(e,n){return r(a,[e,n],t)}),K(u[0]))}var o=e[1],l=e[2];return z(o),R(l),E(l)?(x(o),0===l.length?o:l.split("").reduce((function(e,n){return r(a,[e,n],t)}),o)):0===l.length?o:l.reduce((function(e,n){return r(a,[e,n],t)}),o)},validate:function(e){return S({min:2,max:3},e)}},"reduce-right":{evaluate:function(e,t,n){var r=n.executeFunction,a=e[0];if(T(a),2===e.length){if(R(o=e[1]),0===o.length)return r(a,[],t);if(1===o.length)return K(o[0]);if(E(o)){var u=o.split("");return u.slice(0,u.length-1).reduceRight((function(e,n){var u=r(a,[e,n],t);return x(u),u}),u[u.length-1])}return o.slice(0,o.length-1).reduceRight((function(e,n){return r(a,[e,n],t)}),p(o[o.length-1]))}var i=e[1],o=e[2];return z(i),R(o),E(o)?0===o.length?i:o.split("").reduceRight((function(e,n){return r(a,[e,n],t)}),i):0===o.length?i:o.reduceRight((function(e,n){return r(a,[e,n],t)}),i)},validate:function(e){return S({min:2,max:3},e)}},rest:{evaluate:function(e){var t=e[0];return R(t),Array.isArray(t)?t.length<=1?[]:t.slice(1):t.substr(1)},validate:function(e){return S(1,e)}},nthrest:{evaluate:function(e){var t=e[0],n=e[1];R(t),m(n);var r=Math.max(Math.ceil(n),0);return Array.isArray(t)?t.slice(r):t.substr(r)},validate:function(e){return S(2,e)}},next:{evaluate:function(e){var t=e[0];return R(t),Array.isArray(t)?t.length<=1?null:t.slice(1):t.length<=1?null:t.substr(1)},validate:function(e){return S(1,e)}},nthnext:{evaluate:function(e){var t=e[0],n=e[1];R(t),m(n);var r=Math.max(Math.ceil(n),0);return t.length<=n?null:Array.isArray(t)?t.slice(r):t.substr(r)},validate:function(e){return S(2,e)}},reverse:{evaluate:function(e){var t=e[0];return R(t),Array.isArray(t)?a([],t).reverse():t.split("").reverse().join("")},validate:function(e){return S(1,e)}},second:{evaluate:function(e){var t=e[0];return R(t),K(t[1])},validate:function(e){return S(1,e)}},shift:{evaluate:function(e){var t=e[0];if(R(t),E(t))return t.substr(1);var n=a([],t);return n.shift(),n},validate:function(e){return S(1,e)}},slice:{evaluate:function(e){var t=e[0],n=e[1],r=e[2];return R(t),1===e.length?t:(y(n),2===e.length?t.slice(n):(y(r),t.slice(n,r)))},validate:function(e){return S({min:1,max:3},e)}},some:{evaluate:function(e,t,n){var r,a=e[0],u=e[1],i=n.executeFunction;return T(a),R(u),0===u.length?null:E(u)?null!==(r=u.split("").find((function(e){return i(a,[e],t)})))&&void 0!==r?r:null:K(u.find((function(e){return i(a,[e],t)})))},validate:function(e){return S(2,e)}},sort:{evaluate:function(e,t,n){var r=n.executeFunction,u=1===e.length,i=u?e[0]:e[1],o=u?null:e[0];if(R(i),E(i)){var l=i.split("");return u?l.sort(W):(T(o),l.sort((function(e,n){var a=r(o,[e,n],t);return m(a),a}))),l.join("")}var f=a([],i);return u?f.sort(W):f.sort((function(e,n){T(o);var a=r(o,[e,n],t);return m(a),a})),f},validate:function(e){return S({min:1,max:2},e)}},take:{evaluate:function(e){var t=e[0],n=e[1];_(t),R(n);var r=Math.max(Math.ceil(t),0);return n.slice(0,r)},validate:function(e){return S(2,e)}},"take-last":{evaluate:function(e){var t=e[0],n=e[1];R(n),_(t);var r=Math.max(Math.ceil(t),0),a=n.length-r;return n.slice(a)},validate:function(e){return S(2,e)}},"take-while":{evaluate:function(e,t,n){var r=e[0],a=e[1],u=n.executeFunction;R(a),T(r);for(var i=[],o=0,l=a;o<l.length;o++){var f=l[o];if(!u(r,[f],t))break;i.push(f)}return E(a)?i.join(""):i},validate:function(e){return S(2,e)}},drop:{evaluate:function(e){var t=e[0],n=e[1];_(t);var r=Math.max(Math.ceil(t),0);return R(n),n.slice(r)},validate:function(e){return S(2,e)}},"drop-last":{evaluate:function(e){var t=e[0],n=e[1];R(n),_(t);var r=Math.max(Math.ceil(t),0),a=n.length-r;return n.slice(0,a)},validate:function(e){return S(2,e)}},"drop-while":{evaluate:function(e,t,n){var r=e[0],a=e[1],u=n.executeFunction;if(R(a),T(r),Array.isArray(a)){var i=a.findIndex((function(e){return!u(r,[e],t)}));return a.slice(i)}var o=a.split(""),l=o.findIndex((function(e){return!u(r,[e],t)}));return o.slice(l).join("")},validate:function(e){return S(2,e)}},unshift:{evaluate:function(e){var t=e[0],n=e.slice(1);if(R(t),E(t))return F(n),a(a([],n),[t]).join("");var r=a([],t);return r.unshift.apply(r,n),r},validate:function(e){return S({min:2},e)}},"random-sample!":{evaluate:function(e){var t=e[0],n=e[1];return m(t),R(n),E(n)?n.split("").filter((function(){return Math.random()<t})).join(""):n.filter((function(){return Math.random()<t}))},validate:function(e){return S(2,e)}},"rand-nth!":{evaluate:function(e){var t=e[0];if(R(t),0===t.length)return null;var n=Math.floor(Math.random()*t.length);return E(t)?K(t.split("")[n]):K(t[n])},validate:function(e){return S(1,e)}},shuffle:{evaluate:function(e){var t=e[0];R(t);for(var n,r,u=E(t)?a([],t.split("")):a([],t),i=u.length;i;)i-=1,r=Math.floor(Math.random()*i),n=K(u[i]),u[i]=K(u[r]),u[r]=n;return E(t)?u.join(""):u},validate:function(e){return S(1,e)}},distinct:{evaluate:function(e){var t=e[0];return R(t),Array.isArray(t)?Array.from(new Set(t)):Array.from(new Set(t.split(""))).join("")},validate:function(e){return S(1,e)}},remove:{evaluate:function(e,t,n){var r=e[0],a=e[1],u=n.executeFunction;return T(r),R(a),Array.isArray(a)?a.filter((function(e){return!u(r,[e],t)})):a.split("").filter((function(e){return!u(r,[e],t)})).join("")},validate:function(e){return S(2,e)}},"split-at":{evaluate:function(e){var t=e[0],n=e[1];m(t);var r=H(t);return R(n),[n.slice(0,r),n.slice(r)]},validate:function(e){return S(2,e)}},"split-with":{evaluate:function(e,t,n){var r=e[0],a=e[1],u=n.executeFunction;T(r),R(a);var i=Array.isArray(a),o=(i?a:a.split("")).findIndex((function(e){return!u(r,[e],t)}));return-1===o?[a,i?[]:""]:[a.slice(0,o),a.slice(o)]},validate:function(e){return S(2,e)}}},Me={array:{evaluate:function(e){return e}},range:{evaluate:function(e){var t,n,r,a=e[0],u=e[1],i=e[2];m(a),1===e.length?(t=0,r=(n=a)>=0?1:-1):2===e.length?(m(u),r=(n=u)>=(t=a)?1:-1):(m(u),m(i),r=i,(n=u)>(t=a)?function(e){if(m(e),e<=0)throw TypeError("Expected positive number, got "+e)}(r):n<t?function(e){if(m(e),e>=0)throw TypeError("Expected negative number, got "+e)}(r):function(e){if(m(e),0===e)throw TypeError("Expected non zero value")}(r));for(var o=[],l=t;r<0?l>n:l<n;l+=r)o.push(l);return o},validate:function(e){return S({min:1,max:3},e)}},repeat:{evaluate:function(e){var t=e[0],n=e[1];g(t);for(var r=[],a=0;a<t;a+=1)r.push(n);return r},validate:function(e){return S(2,e)}},flatten:{evaluate:function(e){var t=e[0];return U(t)?t.flat(Number.POSITIVE_INFINITY):[]},validate:function(e){return S(1,e)}},mapcat:{evaluate:function(e,t,n){e.slice(1).forEach((function(e){P(e)}));var r=Ne(e,t,n);return P(r),r.flat(1)},validate:function(e){return S({min:2},e)}}},Se={inc:{evaluate:function(e){var t=e[0];return _(t),t+1},validate:function(e){return S(1,e)}},dec:{evaluate:function(e){var t=e[0];return _(t),t-1},validate:function(e){return S(1,e)}},"+":{evaluate:function(e){return e.reduce((function(e,t){return _(t),e+t}),0)}},"*":{evaluate:function(e){return e.reduce((function(e,t){return _(t),e*t}),1)}},"/":{evaluate:function(e){if(0===e.length)return 1;var t=e[0],n=e.slice(1);return _(t),0===n.length?(_(t),1/t):n.reduce((function(e,t){return _(t),e/t}),t)}},"-":{evaluate:function(e){var t=e[0],n=e.slice(1);return t?(_(t),0===n.length?-t:n.reduce((function(e,t){return _(t),e-t}),t)):0}},quot:{evaluate:function(e){var t=e[0],n=e[1];return _(t),_(n),Math.trunc(t/n)},validate:function(e){return S(2,e)}},mod:{evaluate:function(e){var t=e[0],n=e[1];return _(t),_(n),t-n*Math.floor(t/n)},validate:function(e){return S(2,e)}},rem:{evaluate:function(e){var t=e[0],n=e[1];return _(t),_(n),t-n*Math.trunc(t/n)},validate:function(e){return S(2,e)}},sqrt:{evaluate:function(e){var t=e[0];return _(t),Math.sqrt(t)},validate:function(e){return S(1,e)}},cbrt:{evaluate:function(e){var t=e[0];return _(t),Math.cbrt(t)},validate:function(e){return S(1,e)}},pow:{evaluate:function(e){var t=e[0],n=e[1];return _(t),_(n),Math.pow(t,n)},validate:function(e){return S(2,e)}},round:{evaluate:function(e){var t=e[0],n=e[1];if(_(t),1===e.length||0===n)return Math.round(t);g(n);var r=Math.pow(10,n);return Math.round(t*r)/r},validate:function(e){return S({min:1,max:2},e)}},trunc:{evaluate:function(e){var t=e[0];return _(t),Math.trunc(t)},validate:function(e){return S(1,e)}},floor:{evaluate:function(e){var t=e[0];return _(t),Math.floor(t)},validate:function(e){return S(1,e)}},ceil:{evaluate:function(e){var t=e[0];return _(t),Math.ceil(t)},validate:function(e){return S(1,e)}},"rand!":{evaluate:function(e){var t=1===e.length?e[0]:1;return _(t),Math.random()*t},validate:function(e){return S({min:0,max:1},e)}},"rand-int!":{evaluate:function(e){var t=e[0];return _(t),Math.floor(Math.random()*Math.abs(t))*Math.sign(t)},validate:function(e){return S(1,e)}},min:{evaluate:function(e){var t=e[0],n=e.slice(1);return _(t),0===n.length?t:n.reduce((function(e,t){return _(t),Math.min(e,t)}),t)},validate:function(e){return S({min:1},e)}},max:{evaluate:function(e){var t=e[0],n=e.slice(1);return _(t),0===n.length?t:n.reduce((function(e,t){return _(t),Math.max(e,t)}),t)},validate:function(e){return S({min:1},e)}},abs:{evaluate:function(e){var t=e[0];return _(t),Math.abs(t)},validate:function(e){return S(1,e)}},sign:{evaluate:function(e){var t=e[0];return _(t),Math.sign(t)},validate:function(e){return S(1,e)}},"max-safe-integer":{evaluate:function(){return Number.MAX_SAFE_INTEGER},validate:function(e){return S(0,e)}},"min-safe-integer":{evaluate:function(){return Number.MIN_SAFE_INTEGER},validate:function(e){return S(0,e)}},"max-value":{evaluate:function(){return Number.MAX_VALUE},validate:function(e){return S(0,e)}},"min-value":{evaluate:function(){return Number.MIN_VALUE},validate:function(e){return S(0,e)}},epsilon:{evaluate:function(){return Number.EPSILON},validate:function(e){return S(0,e)}},infinity:{evaluate:function(){return Number.POSITIVE_INFINITY},validate:function(e){return S(0,e)}},"-infinity":{evaluate:function(){return Number.NEGATIVE_INFINITY},validate:function(e){return S(0,e)}},nan:{evaluate:function(){return Number.NaN},validate:function(e){return S(0,e)}},e:{evaluate:function(){return Math.E},validate:function(e){return S(0,e)}},pi:{evaluate:function(){return Math.PI},validate:function(e){return S(0,e)}},exp:{evaluate:function(e){var t=e[0];return _(t),Math.exp(t)},validate:function(e){return S(1,e)}},log:{evaluate:function(e){var t=e[0];return _(t),Math.log(t)},validate:function(e){return S(1,e)}},log2:{evaluate:function(e){var t=e[0];return _(t),Math.log2(t)},validate:function(e){return S(1,e)}},log10:{evaluate:function(e){var t=e[0];return _(t),Math.log10(t)},validate:function(e){return S(1,e)}},sin:{evaluate:function(e){var t=e[0];return _(t),Math.sin(t)},validate:function(e){return S(1,e)}},asin:{evaluate:function(e){var t=e[0];return _(t),Math.asin(t)},validate:function(e){return S(1,e)}},sinh:{evaluate:function(e){var t=e[0];return _(t),Math.sinh(t)},validate:function(e){return S(1,e)}},asinh:{evaluate:function(e){var t=e[0];return _(t),Math.asinh(t)},validate:function(e){return S(1,e)}},cos:{evaluate:function(e){var t=e[0];return _(t),Math.cos(t)},validate:function(e){return S(1,e)}},acos:{evaluate:function(e){var t=e[0];return _(t),Math.acos(t)},validate:function(e){return S(1,e)}},cosh:{evaluate:function(e){var t=e[0];return _(t),Math.cosh(t)},validate:function(e){return S(1,e)}},acosh:{evaluate:function(e){var t=e[0];return _(t),Math.acosh(t)},validate:function(e){return S(1,e)}},tan:{evaluate:function(e){var t=e[0];return _(t),Math.tan(t)},validate:function(e){return S(1,e)}},atan:{evaluate:function(e){var t=e[0];return _(t),Math.atan(t)},validate:function(e){return S(1,e)}},tanh:{evaluate:function(e){var t=e[0];return _(t),Math.tanh(t)},validate:function(e){return S(1,e)}},atanh:{evaluate:function(e){var t=e[0];return _(t),Math.atanh(t)},validate:function(e){return S(1,e)}}},ke=/[[.]/;function Oe(e,t){for(var n=0,r=Te(t);n<r.length;n++){var a=r[n];try{e=K(e[a])}catch(e){return null}}return e}function Te(e){if(!e)return[];var t=ke.exec(e);if(!t)return[e];if(t.index>0)return a([e.substring(0,t.index)],Te(e.substring(t.index)));if("."===e[0]){if(e.length<2)throw Error("Ill formed path: "+e);return Te(e.substring(1))}var n=function(e){var t=Ie.exec(e)||Fe.exec(e);if(t){return[t[0].length,t[1]]}var n=_e.exec(e);if(n){return[n[0].length,Number(n[1])]}throw Error("Ill formed path: "+e)}(e),r=n[0],u=n[1];if(e.length>r&&"."!==e[r]&&"["!==e[r])throw Error("Ill formed path: "+e);return a([u],Te(e.substring(r)))}var Ie=/^\[\s*'(.*)'\s*\]/,Fe=/^\[\s*"(.*)"\s*\]/,_e=/^\[\s*(\d+)\s*\]/;var Pe={"not=":{evaluate:function(e){for(var t=0;t<e.length-1;t+=1)for(var n=t+1;n<e.length;n+=1)if(e[t]===e[n])return!1;return!0},validate:function(e){return S({min:1},e)}},"=":{evaluate:function(e){for(var t=e[0],n=0,r=e.slice(1);n<r.length;n++){if(r[n]!==t)return!1}return!0},validate:function(e){return S({min:1},e)}},"equal?":{evaluate:function(e){var t=e[0],n=e[1];return X(p(t),p(n))},validate:function(e){return S({min:1},e)}},">":{evaluate:function(e){for(var t=e[0],n=0,r=e.slice(1);n<r.length;n++){var a=r[n];if(W(t,a)<=0)return!1;t=a}return!0},validate:function(e){return S({min:1},e)}},"<":{evaluate:function(e){for(var t=e[0],n=0,r=e.slice(1);n<r.length;n++){var a=r[n];if(W(t,a)>=0)return!1;t=a}return!0},validate:function(e){return S({min:1},e)}},">=":{evaluate:function(e){for(var t=e[0],n=0,r=e.slice(1);n<r.length;n++){var a=r[n];if(W(t,a)<0)return!1;t=a}return!0},validate:function(e){return S({min:1},e)}},"<=":{evaluate:function(e){for(var t=e[0],n=0,r=e.slice(1);n<r.length;n++){var a=r[n];if(W(t,a)>0)return!1;t=a}return!0},validate:function(e){return S({min:1},e)}},"get-path":{evaluate:function(e){var t=e[0],n=e[1];return function(e){if((null===e||"object"!=typeof e||Array.isArray(e)||e instanceof RegExp||O(e))&&!Array.isArray(e))throw TypeError("Expected object or array, got: "+e+' type="'+typeof e+'"')}(t),x(n),Oe(t,n)},validate:function(e){return S(2,e)}},not:{evaluate:function(e){return!e[0]},validate:function(e){return S(1,e)}},"inst-ms":{evaluate:function(){return Date.now()},validate:function(e){return S(0,e)}},"write!":{evaluate:function(e){return console.log.apply(console,e),e.length>0?p(e[e.length-1]):null}},"debug!":{evaluate:function(e,t){return 0===e.length?(console.warn("*** LISPISH DEBUG ***\n"+function(e){return a([],e).reverse().reduce((function(e,t,n){return e+"Context "+n+(0===n?" - Import context":1===n?" - Global context":"")+"\n"+function(e){if(0===Object.keys(e).length)return"  <empty>\n";var t=Math.max.apply(Math,Object.keys(e).map((function(e){return e.length})));return Object.entries(e).reduce((function(e,n){return e+"  "+(""+n[0]).padEnd(t+2," ")+function(e){var t=e.value,n=t.name;if(O(t))return n?"<"+t.type+" function "+n+">":"<"+t.type+" function λ>";return JSON.stringify(e.value)}(n[1])+"\n"}),"")}(t)+"\n"}),"")}(t)+"\n"),null):(console.warn("*** LISPISH DEBUG ***\n"+JSON.stringify(e[0],null,2)+"\n"),p(e[0]))},validate:function(e){return S({max:1},e)}},boolean:{evaluate:function(e){return!!e[0]},validate:function(e){return S(1,e)}},compare:{evaluate:function(e){return W(e[0],e[1])},validate:function(e){return S(2,e)}},assert:{evaluate:function(e){var t=e[0],n=2===e.length?e[1]:""+t;if(x(n),!t)throw new o(n);return p(t)},validate:function(e){return S({min:1,max:2},e)}},"lispish-version":{evaluate:function(){return"0.1.55"},validate:function(e){return S(0,e)}}};var Ce={object:{evaluate:function(e){for(var t={},n=0;n<e.length;n+=2){var r=e[n],a=e[n+1];x(r),t[r]=a}return t},validate:function(e){return k(e)}},keys:{evaluate:function(e){var t=e[0];return q(t),Object.keys(t)},validate:function(e){return S(1,e)}},vals:{evaluate:function(e){var t=e[0];return q(t),Object.values(t)},validate:function(e){return S(1,e)}},entries:{evaluate:function(e){var t=e[0];return q(t),Object.entries(t)},validate:function(e){return S(1,e)}},find:{evaluate:function(e){var t=e[0],n=e[1];return q(t),x(n),G(t,n)?[n,t[n]]:null},validate:function(e){return S(2,e)}},dissoc:{evaluate:function(e){var t=e[0],n=e[1];q(t),x(n);var r=K(t[n]);return delete t[n],r},validate:function(e){return S(2,e)}},merge:{evaluate:function(e){var t=e[0],n=e.slice(1);return q(t),n.reduce((function(e,t){return q(t),r(r({},e),t)}),r({},t))},validate:function(e){return S({min:1},e)}},zipmap:{evaluate:function(e){var t=e[0],n=e[1];I(t),P(n);for(var r=Math.min(t.length,n.length),a={},u=0;u<r;u+=1){a[d(t[u])]=K(n[u])}return a},validate:function(e){return S(2,e)}},"select-keys":{evaluate:function(e){var t=e[0],n=e[1];return I(n),q(t),n.reduce((function(e,n){return G(t,n)&&(e[n]=K(t[n])),e}),{})},validate:function(e){return S(2,e)}}},ze={"function?":{evaluate:function(e){return O(e[0])},validate:function(e){return S(1,e)}},"string?":{evaluate:function(e){return"string"==typeof e[0]},validate:function(e){return S(1,e)}},"number?":{evaluate:function(e){return"number"==typeof e[0]},validate:function(e){return S(1,e)}},"integer?":{evaluate:function(e){var t=e[0];return"number"==typeof t&&Number.isInteger(t)},validate:function(e){return S(1,e)}},"boolean?":{evaluate:function(e){return"boolean"==typeof e[0]},validate:function(e){return S(1,e)}},"nil?":{evaluate:function(e){var t=e[0];return null==t},validate:function(e){return S(1,e)}},"zero?":{evaluate:function(e){var t=e[0];return m(t),0===t},validate:function(e){return S(1,e)}},"pos?":{evaluate:function(e){var t=e[0];return m(t),t>0},validate:function(e){return S(1,e)}},"neg?":{evaluate:function(e){var t=e[0];return m(t),t<0},validate:function(e){return S(1,e)}},"even?":{evaluate:function(e){var t=e[0];return m(t),t%2==0},validate:function(e){return S(1,e)}},"odd?":{evaluate:function(e){var t=e[0];return m(t),Number.isInteger(t)&&t%2!=0},validate:function(e){return S(1,e)}},"array?":{evaluate:function(e){return U(e[0])},validate:function(e){return S(1,e)}},"coll?":{evaluate:function(e){return D(e[0])},validate:function(e){return S(1,e)}},"seq?":{evaluate:function(e){return B(e[0])},validate:function(e){return S(1,e)}},"object?":{evaluate:function(e){return V(e[0])},validate:function(e){return S(1,e)}},"regexp?":{evaluate:function(e){var t=e[0];return null!==t&&!Array.isArray(t)&&"object"==typeof t&&t instanceof RegExp},validate:function(e){return S(1,e)}},"finite?":{evaluate:function(e){var t=e[0];return _(t),Number.isFinite(t)},validate:function(e){return S(1,e)}},"nan?":{evaluate:function(e){var t=e[0];return _(t),Number.isNaN(t)},validate:function(e){return S(1,e)}},"positive-infinity?":{evaluate:function(e){var t=e[0];return _(t),t===Number.POSITIVE_INFINITY},validate:function(e){return S(1,e)}},"negative-infinity?":{evaluate:function(e){var t=e[0];return _(t),t===Number.NEGATIVE_INFINITY},validate:function(e){return S(1,e)}},"true?":{evaluate:function(e){return!0===e[0]},validate:function(e){return S(1,e)}},"false?":{evaluate:function(e){return!1===e[0]},validate:function(e){return S(1,e)}}},Re={regexp:{evaluate:function(e){var t=e[0],n=e[1];return x(t),1===e.length?new RegExp(t):(x(n),new RegExp(t,n))},validate:function(e){return S({min:1,max:2},e)}},match:{evaluate:function(e){var t=e[0],n=e[1];M(t),x(n);var r=t.exec(n);return r?a([],r):null},validate:function(e){return S(2,e)}},replace:{evaluate:function(e){var t=e[0],n=e[1],r=e[2];return x(t),M(n),x(r),t.replace(n,r)},validate:function(e){return S(3,e)}}},qe={subs:{evaluate:function(e){var t=e[0],n=e[1],r=e[2];return x(t),g(n),void 0===r?t.substring(n):(b(r,n),t.substring(n,r))},validate:function(e){return S({min:2,max:3},e)}},"string-repeat":{evaluate:function(e){var t=e[0],n=e[1];return x(t),g(n),t.repeat(n)},validate:function(e){return S(2,e)}},str:{evaluate:function(e){return e.reduce((function(e,t){return e+(null==t?"":V(t)||Array.isArray(t)?JSON.stringify(t):""+t)}),"")}},"string-to-number":{evaluate:function(e){var t=e[0];x(t);var n=Number(t);if(Number.isNaN(n))throw Error("Could not convert '"+t+"' to a number");return n},validate:function(e){return S(1,e)}},"number-to-string":{evaluate:function(e){var t=e[0],n=e[1];if(m(t),1===e.length)return""+t;if(m(n),2!==n&&8!==n&&10!==n&&16!==n)throw Error('Expected "number-to-string" base argument to be 2, 8, 10 or 16, got: '+n);return 10===n?""+t:(g(t),Number(t).toString(n))},validate:function(e){return S({min:1,max:2},e)}},"from-char-code":{evaluate:function(e){var t=e[0];m(t);var n=H(t);return String.fromCodePoint(n)},validate:function(e){return S(1,e)}},"to-char-code":{evaluate:function(e){var t=e[0];return function(e){if(x(e),0===e.length)throw TypeError("Expected non empty string, got: "+e+' type="'+typeof e+'"')}(t),d(t.codePointAt(0))},validate:function(e){return S(1,e)}},"lower-case":{evaluate:function(e){var t=e[0];return x(t),t.toLowerCase()},validate:function(e){return S(1,e)}},"upper-case":{evaluate:function(e){var t=e[0];return x(t),t.toUpperCase()},validate:function(e){return S(1,e)}},trim:{evaluate:function(e){var t=e[0];return x(t),t.trim()},validate:function(e){return S(1,e)}},"trim-left":{evaluate:function(e){var t=e[0];return x(t),t.replace(/^\s+/,"")},validate:function(e){return S(1,e)}},"trim-right":{evaluate:function(e){var t=e[0];return x(t),t.replace(/\s+$/,"")},validate:function(e){return S(1,e)}},join:{evaluate:function(e){var t=e[0],n=e[1];return P(t),t.forEach((function(e){return x(e)})),x(n),t.join(n)},validate:function(e){return S(2,e)}},split:{evaluate:function(e){var t=e[0],n=e[1],r=e[2];return x(t),function(e){if(!(e instanceof RegExp||"string"==typeof e))throw TypeError("Expected RegExp or string, got: "+e+' type="'+typeof e+'"')}(n),void 0!==r&&g(r),t.split(n,r)},validate:function(e){return S({min:2,max:3},e)}},"pad-left":{evaluate:function(e){var t=e[0],n=e[1],r=e[2];return x(t),y(n),void 0!==r&&x(r),t.padStart(n,r)},validate:function(e){return S({min:2,max:3},e)}},"pad-right":{evaluate:function(e){var t=e[0],n=e[1],r=e[2];return x(t),y(n),void 0!==r&&x(r),t.padEnd(n,r)},validate:function(e){return S({min:2,max:3},e)}},template:{evaluate:function(e){var t=e[0],n=e.slice(1);x(t);var r=t.split("||||");if(1===r.length)return I(n),Ue(r[0],n);if(2===r.length){var u=n[0];g(u);var i=a([""+u],n.slice(1));return Ue(1===u?r[0]:r[1],i)}throw Error('Invalid template string, only one "||||" separator allowed')},validate:function(e){return S({min:1,max:10},e)}}},Ve=/\$\$/g;function Ue(e,t){for(var n=0;n<9;n+=1){var r=new RegExp("(?<=^|[^$]|\\$\\$)\\$"+(n+1),"g");if(r.test(e)){var a=t[n];x(a),e=e.replace(r,a)}}return e.replace(Ve,"$")}var Be={apply:{evaluate:function(e,t,n){var r=e[0],u=e.slice(1),i=n.executeFunction;T(r);var o=u[u.length-1];return P(o),i(r,a(a([],u.slice(0,-1)),o),t)},validate:function(e){return S({min:2},e)}},identity:{evaluate:function(e){return K(e[0])},validate:function(e){return S(1,e)}},partial:{evaluate:function(e){var t,n=e[0],r=e.slice(1);return(t={})[c]=!0,t.type="partial",t.fn=K(n),t.params=r,t},validate:function(e){return S({min:1},e)}},comp:{evaluate:function(e){var t;if(e.length>1){var n=e[e.length-1];U(n)&&(e=a(a([],e.slice(0,-1)),n))}return(t={})[c]=!0,t.type="comp",t.fns=e,t}},constantly:{evaluate:function(e){var t,n=e[0];return(t={})[c]=!0,t.type="constantly",t.value=K(n),t},validate:function(e){return S(1,e)}},juxt:{evaluate:function(e){var t;return(t={})[c]=!0,t.type="juxt",t.fns=e,t},validate:function(e){return S({min:1},e)}},complement:{evaluate:function(e){var t,n=e[0];return(t={})[c]=!0,t.type="complement",t.fn=K(n),t},validate:function(e){return S(1,e)}},"every-pred":{evaluate:function(e){var t;return(t={})[c]=!0,t.type="every-pred",t.fns=e,t},validate:function(e){return S({min:1},e)}},"some-pred":{evaluate:function(e){var t;return(t={})[c]=!0,t.type="some-pred",t.fns=e,t},validate:function(e){return S({min:1},e)}}},De=r(r(r(r(r(r(r(r(r(r(r({},{"bit-shift-left":{evaluate:function(e){var t=e[0],n=e[1];return y(t),g(n),t<<n},validate:function(e){return S(2,e)}},"bit-shift-right":{evaluate:function(e){var t=e[0],n=e[1];return y(t),g(n),t>>n},validate:function(e){return S(2,e)}},"bit-not":{evaluate:function(e){var t=e[0];return y(t),~t},validate:function(e){return S(1,e)}},"bit-and":{evaluate:function(e){var t=e[0],n=e.slice(1);return y(t),n.reduce((function(e,t){return y(t),e&t}),t)},validate:function(e){return S({min:2},e)}},"bit-and-not":{evaluate:function(e){var t=e[0],n=e.slice(1);return y(t),n.reduce((function(e,t){return y(t),e&~t}),t)},validate:function(e){return S({min:2},e)}},"bit-or":{evaluate:function(e){var t=e[0],n=e.slice(1);return y(t),n.reduce((function(e,t){return y(t),e|t}),t)},validate:function(e){return S({min:2},e)}},"bit-xor":{evaluate:function(e){var t=e[0],n=e.slice(1);return y(t),n.reduce((function(e,t){return y(t),e^t}),t)},validate:function(e){return S({min:2},e)}},"bit-flip":{evaluate:function(e){var t=e[0],n=e[1];return y(t),g(n),t^1<<n},validate:function(e){return S(2,e)}},"bit-set":{evaluate:function(e){var t=e[0],n=e[1];return y(t),g(n),t|1<<n},validate:function(e){return S(2,e)}},"bit-clear":{evaluate:function(e){var t=e[0],n=e[1];return y(t),g(n),t&~(1<<n)},validate:function(e){return S(2,e)}},"bit-test":{evaluate:function(e){var t=e[0],n=e[1];return y(t),g(n),!!(t&1<<n)},validate:function(e){return S(2,e)}}}),Ae),Me),je),Se),Pe),Ce),ze),Re),qe),Be),Le={def:he,defs:me,and:{parse:function(e,t,n){var r=(0,n.parseTokens)(e,t);return[r[0]+1,{type:"SpecialExpression",name:"and",params:r[1]}]},evaluate:function(e,t,n){for(var r=n.evaluateAstNode,a=!0,u=0,i=e.params;u<i.length;u++){if(!(a=r(i[u],t)))break}return a}},cond:Z,defn:ae,defns:ue,if:oe,"if-not":le,"if-let":fe,"when-let":ce,"when-not":ve,"when-first":se,fn:ie,let:pe,or:{parse:function(e,t,n){var r=(0,n.parseTokens)(e,t);return[r[0]+1,{type:"SpecialExpression",name:"or",params:r[1]}]},evaluate:function(e,t,n){for(var r=n.evaluateAstNode,a=!1,u=0,i=e.params;u<i.length;u++){if(a=r(i[u],t))break}return a}},do:de,throw:ge,try:ye,when:be,recur:Ee,loop:xe,"time!":we};Object.keys(Le).forEach((function(e){if(De[e])throw Error("Expression "+e+" is defined as both a normal expression and a special expression")}));var $e={normalExpressions:De,specialExpressions:Le},Ge=Object.keys(De),Ye=Object.keys(Le),Je={"user-defined":function(e,t,n,i){for(var o,l,f,c=i.evaluateAstNode,v=e.arguments,s=v.mandatoryArguments.length,p=v.optionalArguments.length,h=v.restArgument?null:s+p;;){var m=r({},e.functionContext);if(t.length<v.mandatoryArguments.length)throw Error("Function "+(null!==(o=e.name)&&void 0!==o?o:"(fn)")+" requires at least "+v.mandatoryArguments.length+" arguments. Got "+t.length);if(null!==h&&t.length>h)throw Error('Function "'+(null!==(l=e.name)&&void 0!==l?l:"λ")+'" requires at most '+h+" arguments. Got "+t.length);for(var g=Math.max(t.length,v.mandatoryArguments.length+v.optionalArguments.length),y=[],b=0;b<g;b+=1)if(b<s){var E=K(t[b]);m[w(v.mandatoryArguments[b])]={value:E}}else if(b<s+p){var x=d(v.optionalArguments[b-s]);E=b<t.length?K(t[b]):null!==(f=x.defaultValue)&&void 0!==f?f:null;m[x.name]={value:E}}else y.push(K(t[b]));v.restArgument&&(m[v.restArgument]={value:y});try{for(var A=null,N=0,j=e.body;N<j.length;N++){A=c(j[N],a([m],n))}return A}catch(e){if(e instanceof u){t=e.params;continue}throw e}}},partial:function(e,t,n,r){return(0,r.executeFunction)(e.fn,a(a([],e.params),t),n)},comp:function(e,t,n,r){var a=r.executeFunction,u=e.fns;if(0===u.length){if(1!==t.length)throw Error("(comp) expects one argument, got "+t.length);return p(t[0])}return p(u.reduceRight((function(e,t){return[a(K(t),e,n)]}),t)[0])},constantly:function(e){return e.value},juxt:function(e,t,n,r){var a=r.executeFunction;return e.fns.map((function(e){return a(K(e),t,n)}))},complement:function(e,t,n,r){return!(0,r.executeFunction)(e.fn,t,n)},"every-pred":function(e,t,n,r){for(var a=r.executeFunction,u=0,i=e.fns;u<i.length;u++)for(var o=i[u],l=0,f=t;l<f.length;l++){var c=f[l];if(!a(K(o),[c],n))return!1}return!0},"some-pred":function(e,t,n,r){for(var a=r.executeFunction,u=0,i=e.fns;u<i.length;u++)for(var o=i[u],l=0,f=t;l<f.length;l++){var c=f[l];if(a(K(o),[c],n))return!0}return!1},builtin:function(e,t,n,r){var a=r.executeFunction;return d(De[e.name]).evaluate(t,n,{executeFunction:a})}};function We(e,t,n){for(var r,a=[t,n],u=0,i=e.body;u<i.length;u++){var o=i[u];r=Xe(o,a)}return r}var Xe=function(e,t){switch(e.type){case"Number":case"String":return function(e){return e.value}(e);case"Name":return function(e,t){for(var n,r=e.value,a=0,u=t;a<u.length;a++){var i=u[a][r];if(i)return i.value}if($e.normalExpressions[r]){return(n={})[c]=!0,n.type="builtin",n.name=r,n}throw Error("Undefined identifier "+r)}(e,t);case"ReservedName":return function(e){return d(Q[e.value]).value}(e);case"NormalExpression":return function(e,t){var n,r=e.params.map((function(e){return Xe(e,t)}));if(function(e){return"string"==typeof e.name}(e)){for(var a=0,u=t;a<u.length;a++){if(void 0!==(i=null===(n=u[a][e.name])||void 0===n?void 0:n.value))try{return He(i,r,t)}catch(e){continue}}return function(e,t,n){return(0,d($e.normalExpressions[e.name]).evaluate)(t,n,{executeFunction:He})}(e,r,t)}var i=Xe(e.expression,t);return He(i,r,t)}(e,t);case"SpecialExpression":return function(e,t){return(0,d($e.specialExpressions[e.name]).evaluate)(e,t,{evaluateAstNode:Xe,builtin:$e})}(e,t);default:throw Error(e.type+"-node cannot be evaluated")}};var He=function(e,t,n){if(O(e))return Je[e.type](e,t,n,{evaluateAstNode:Xe,executeFunction:He});if(Array.isArray(e))return function(e,t){if(1!==t.length)throw Error("Array as function requires one non negative integer parameter");var n=t[0];return g(n),K(e[n])}(e,t);if(V(e))return function(e,t){if(1!==t.length)throw Error("Object as function requires one string parameter");var n=t[0];return x(n),K(e[n])}(e,t);if(E(e))return function(e,t){if(1!==t.length)throw Error("String as function requires one Obj parameter");var n=K(t[0]);if(V(n))return K(n[e]);if($(n))return K(e[n]);throw Error("string as function expects Obj or integer parameter, got "+n)}(e,t);if(L(e))return function(e,t){if(y(e),1!==t.length)throw Error("String as function requires one Arr parameter");var n=t[0];return R(n),K(n[e])}(e,t);throw Error("Expected function, got "+e)};var Ke=function(e,t){for(var n,r,a=d(e[t]),u=[];"paren"!==a.type||")"!==a.value&&"]"!==a.value;)t=(n=ut(e,t))[0],r=n[1],u.push(r),a=d(e[t]);return[t,u]},Ze=function(e,t){var n=d(e[t+=1]);return"name"===n.type&&$e.specialExpressions[n.value]?at(e,t):rt(e,t)},Qe=/^%([1-9][0-9]?$)/,et=function(e,t){var n=d(e[t]);if("name"===n.type)return[t+1,{type:"Argument",name:n.value}];if("paren"===n.type&&"("===n.value){if("name"!==(n=d(e[t+=1])).type)throw new l("name",n);var r=n.value,a=ut(e,t+=1),u=a[0],i=a[1];if("paren"!==(n=d(e[u])).type||")"!==n.value)throw new l(")",n);return[u+1,{type:"Argument",name:r,defaultValue:i}]}if("modifier"===n.type)return[t+1,{type:"Modifier",value:n.value}];throw new l('"(", name or modifier',n)},tt=function(e,t){var n,r=d(e[t]);if("paren"!==r.type||"["!==r.value)throw new l("[",r);r=d(e[t+=1]);for(var a,u=[];"paren"!==r.type||"]"!==r.value;)t=(n=nt(e,t))[0],a=n[1],u.push(a),r=d(e[t]);return[t+=1,u]};function nt(e,t){var n,r=d(e[t]);if("name"!==r.type)throw Error("Expected name node in binding, got "+r.type+" value="+r.value);var a=r.value;return r=d(e[t+=1]),[t=(n=ut(e,t))[0],{type:"Binding",name:a,value:n[1]}]}var rt=function(e,t){var n,r,a,u=ut(e,t),i=u[0],o=u[1];if(t=(n=Ke(e,i))[0],a=n[1],t+=1,function(e){return"NormalExpression"===e.type||"SpecialExpression"===e.type||"Number"===e.type||"String"===e.type}(o))return[t,{type:"NormalExpression",expression:o,params:a}];s(o);var l={type:"NormalExpression",name:o.value,params:a},f=$e.normalExpressions[l.name];return f&&(null===(r=f.validate)||void 0===r||r.call(f,l)),[t,l]},at=function(e,t){var n=d(e[t]).value;t+=1;var r=d($e.specialExpressions[n]),a=r.parse,u=r.validate,i=a(e,t,{parseExpression:Ze,parseTokens:Ke,parseToken:ut,parseBindings:tt,parseArgument:et}),o=i[0],l=i[1];return null==u||u(l),[o,l]},ut=function(e,t){var n=d(e[t]),r=void 0;switch(n.type){case"number":r=function(e,t){var n=d(e[t]);return[t+1,{type:"Number",value:Number(n.value)}]}(e,t);break;case"string":r=function(e,t){return[t+1,{type:"String",value:d(e[t]).value}]}(e,t);break;case"name":r=function(e,t){return[t+1,{type:"Name",value:d(e[t]).value}]}(e,t);break;case"reservedName":r=function(e,t){return[t+1,{type:"ReservedName",value:d(e[t]).value}]}(e,t);break;case"paren":"("===n.value?r=Ze(e,t):"["===n.value?r=function(e,t){for(var n,r,a=d(e[t+=1]),u=[];"paren"!==a.type||"]"!==a.value;)t=(n=ut(e,t))[0],r=n[1],u.push(r),a=d(e[t]);return[t+=1,{type:"NormalExpression",name:"array",params:u}]}(e,t):"{"===n.value&&(r=function(e,t){for(var n,r,a=d(e[t+=1]),u=[];"paren"!==a.type||"}"!==a.value;)t=(n=ut(e,t))[0],r=n[1],u.push(r),a=d(e[t]);t+=1;var i={type:"NormalExpression",name:"object",params:u};return k(i),[t,i]}(e,t));break;case"regexpShorthand":r=function(e,t){return[t+1,{type:"NormalExpression",name:"regexp",params:[{type:"String",value:d(e[t]).value}]}]}(e,t);break;case"fnShorthand":r=function(e,t){for(var n=rt(e,t+=2),r=n[0],a=n[1],u=0,i=t+1;i<r-1;i+=1){var o=d(e[i]);if("name"===o.type){var l=Qe.exec(o.value);if(l&&(u=Math.max(u,Number(l[1])))>20)throw Error("Can't specify more than 20 arguments")}if("fnShorthand"===o.type)throw Error("Nested shortcut functions are not allowed")}for(var f=[],c=1;c<=u;c+=1)f.push("%"+c);return[r,{type:"SpecialExpression",name:"fn",params:[],arguments:{bindings:[],mandatoryArguments:f,optionalArguments:[]},body:[a]}]}(e,t)}if(!r)throw SyntaxError("Unrecognized token: "+n.type+" value="+n.value);return r};var it=/[@%0-9a-zA-Z_^?=!$%<>.+*/-]/,ot=/\s|,/,lt=function(e,t){if('"'!==e[t])return[0,void 0];for(var n="",r=1,a=e[t+r],u=!1;'"'!==a||u;){if(void 0===a)throw new SyntaxError("Unclosed string at position "+t);u?(u=!1,'"'===a||"\\"===a||(n+="\\"),n+=a):"\\"===a?u=!0:n+=a,a=e[t+(r+=1)]}return[r+1,{type:"string",value:n}]},ft=/\s|[)\]},]/,ct=/[0-9]/,vt=/[0-7]/,st=/[0-9a-fA-F]/,pt=/[0-1]/,dt=/[0-9.-]/;function ht(e,t,n,r){return t===n[r]?[1,{type:e,value:t}]:[0,void 0]}var mt=[function(e,t){if(";"===e[t]){for(var n=1;"\n"!==e[t+n]&&t+n<e.length;)n+=1;return"\n"===e[t+n]&&t+n<e.length&&(n+=1),[n,void 0]}return[0,void 0]},function(e,t){var n;return ot.test(null!==(n=e[t])&&void 0!==n?n:"")?[1,void 0]:[0,void 0]},function(e,t){return ht("paren","(",e,t)},function(e,t){return ht("paren",")",e,t)},function(e,t){return ht("paren","[",e,t)},function(e,t){return ht("paren","]",e,t)},function(e,t){return ht("paren","{",e,t)},function(e,t){return ht("paren","}",e,t)},lt,function(e,t){var n="decimal",r=e[t];if(void 0===r)return[0,void 0];var a,u="."===r;if(!dt.test(r))return[0,void 0];for(a=t+1;a<e.length;a+=1){var i=d(e[a]);if(ft.test(i))break;if(a===t+1&&"0"===r){if("b"===i||"B"===i){n="binary";continue}if("o"===i||"O"===i){n="octal";continue}if("x"===i||"X"===i){n="hex";continue}}if("decimal"===n&&u){if(!ct.test(i))return[0,void 0]}else if("binary"===n){if(!pt.test(i))return[0,void 0]}else if("octal"===n){if(!vt.test(i))return[0,void 0]}else if("hex"===n){if(!st.test(i))return[0,void 0]}else{if("."===i){u=!0;continue}if(!ct.test(i))return[0,void 0]}}var o=a-t,l=e.substring(t,a);return"decimal"!==n&&o<=2||"."===l||"-"===l?[0,void 0]:[o,{type:"number",value:l}]},function(e,t){for(var n=0,r=Object.keys(Q);n<r.length;n++){var a=r[n],u=a.length,i=e[t+u];if((!i||!it.test(i))&&e.substr(t,u)===a)return[u,{type:"reservedName",value:a}]}return[0,void 0]},function(e,t){return function(e,t,n,r){var a=n[r],u=0,i="";if(!a||!t.test(a))return[0,void 0];for(;a&&t.test(a);)i+=a,a=n[r+(u+=1)];return[u,{type:e,value:i}]}("name",it,e,t)},function(e,t){return"&rest"===e.substr(t,5)?[5,{type:"modifier",value:"&rest"}]:"&opt"===e.substr(t,4)?[4,{type:"modifier",value:"&opt"}]:"&bind"===e.substr(t,5)?[5,{type:"modifier",value:"&bind"}]:[0,void 0]},function(e,t){if("#"!==e[t])return[0,void 0];var n=lt(e,t+1),r=n[0],a=n[1];return a?[r+1,{type:"regexpShorthand",value:a.value}]:[0,void 0]},function(e,t){return"#("!==e.slice(t,t+2)?[0,void 0]:[1,{type:"fnShorthand",value:"#"}]}];var gt=function(){function e(e){if(this.cache={},this.firstEntry=void 0,this.lastEntry=void 0,this._size=0,this.maxSize=H(e),this.maxSize<1)throw Error("1 is the minimum maxSize, got "+e)}return Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),e.prototype.get=function(e){var t;return null===(t=this.cache[e])||void 0===t?void 0:t.value},e.prototype.clear=function(){this.cache={},this.firstEntry=void 0,this.lastEntry=void 0,this._size=0},e.prototype.has=function(e){return!!this.cache[e]},e.prototype.set=function(e,t){if(this.has(e))throw Error("AstCache - key already present: "+e);var n={value:t,nextEntry:void 0,key:e};for(this.cache[e]=n,this._size+=1,this.lastEntry&&(this.lastEntry.nextEntry=n),this.lastEntry=n,this.firstEntry||(this.firstEntry=this.lastEntry);this.size>this.maxSize;)this.dropFirstEntry()},e.prototype.dropFirstEntry=function(){var e=d(this.firstEntry);delete this.cache[e.key],this._size-=1,this.firstEntry=e.nextEntry},e}(),yt=function(){function e(e){void 0===e&&(e={}),this.importScope={},e.astCacheSize&&e.astCacheSize>0?this.astCache=new gt(e.astCacheSize):this.astCache=null}return e.prototype.run=function(e,t){var n=this.generateAst(e);return this.evaluate(n,t)},e.prototype.import=function(e){var t=this.tokenize(e),n={};We(this.parse(t),n,{});for(var r=Object.keys(this.importScope),a=0,u=Object.keys(n);a<u.length;a++){var i=u[a];if(r.includes(i))throw Error('Import faild, imported function/variable already exists: "'+i+'"');te(i,[{},{}],$e)}Object.assign(this.importScope,n)},e.prototype.tokenize=function(e){return function(e){for(var t=[],n=0,r=!1;n<e.length;){r=!1;for(var a=0,u=mt;a<u.length;a++){var i=(0,u[a])(e,n),o=i[0],l=i[1];if(o>0&&(r=!0,n+=o,l)){t.push(l);break}}if(!r)throw new SyntaxError("Unrecognized character at position "+n+": '"+e[n]+"'")}return t}(e)},e.prototype.parse=function(e){return function(e){for(var t,n,r={type:"Program",body:[]},a=0;a<e.length;)a=(t=ut(e,a))[0],n=t[1],r.body.push(n);return r}(e)},e.prototype.evaluate=function(e,t){void 0===t&&(t={});var n=t.globalContext||{};return t.vars&&Object.entries(t.vars).forEach((function(e){var t=e[0],r=e[1];n[t]={value:K(r)}})),We(e,n,this.importScope)},e.prototype.generateAst=function(e){var t;if(this.astCache){var n=this.astCache.get(e);if(n)return n}var r=this.tokenize(e),a=this.parse(r);return null===(t=this.astCache)||void 0===t||t.set(e,a),a},e}();return e.Lispish=yt,e.isLispishFunction=O,e.normalExpressionKeys=Ge,e.reservedNames=ee,e.specialExpressionKeys=Ye,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
//# sourceMappingURL=lispish.iife.js.map
